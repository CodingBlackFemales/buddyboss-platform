window.bp=window.bp||{},function(e,i){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Media={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=i("body");this.current_page=1,this.current_page_existing_media=1,this.current_page_albums=1,this.current_tab=!(e.hasClass("single-topic")||e.hasClass("single-forum"))&&"bp-dropzone-content",this.sort_by="",this.order_by="",this.currentTargetParent=BP_Nouveau.media.current_folder,this.moveToIdPopup=BP_Nouveau.media.move_to_id_popup,this.moveToTypePopup=BP_Nouveau.media.current_type,this.privacySelectorSelect="",this.privacySelectorSpan="",this.currentAlbum=BP_Nouveau.media.current_album,void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1);var t=document.getElementsByClassName("forum-post-document-template").length?document.getElementsByClassName("forum-post-document-template")[0].innerHTML:"";this.documentOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:t,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation};var a=document.getElementsByClassName("forum-post-video-template").length?document.getElementsByClassName("forum-post-video-template")[0].innerHTML:"";if(this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:a,dictCancelUploadConfirmation:BP_Nouveau.video.dictCancelUploadConfirmation},i("#bp-media-uploader").hasClass("bp-media-document-uploader")){var o=document.getElementsByClassName("forum-post-document-template").length?document.getElementsByClassName("forum-post-document-template")[0].innerHTML:"";this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:o,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation}}else{var d=document.getElementsByClassName("forum-post-media-template").length?document.getElementsByClassName("forum-post-media-template")[0].innerHTML:"";this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:d,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2}}void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.options,BP_Nouveau.media.dropzone_options),this.dropzone_obj=[],this.dropzone_media=[],this.album_id=void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,this.current_folder=void 0!==BP_Nouveau.media.current_folder&&BP_Nouveau.media.current_folder,this.current_group_id=void 0!==BP_Nouveau.media.current_group_id&&BP_Nouveau.media.current_group_id,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,this.bbp_is_reply_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_reply_edit&&window.BP_Forums_Nouveau.media.bbp_is_reply_edit,this.bbp_is_topic_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_topic_edit&&window.BP_Forums_Nouveau.media.bbp_is_topic_edit,this.bbp_is_forum_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_forum_edit&&window.BP_Forums_Nouveau.media.bbp_is_forum_edit,this.bbp_reply_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_media?window.BP_Forums_Nouveau.media.reply_edit_media:[],this.bbp_reply_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_document?window.BP_Forums_Nouveau.media.reply_edit_document:[],this.bbp_reply_edit_video=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_video?window.BP_Forums_Nouveau.media.reply_edit_video:[],this.bbp_topic_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_media?window.BP_Forums_Nouveau.media.topic_edit_media:[],this.bbp_topic_edit_video=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_video?window.BP_Forums_Nouveau.media.topic_edit_video:[],this.bbp_topic_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_document?window.BP_Forums_Nouveau.media.topic_edit_document:[],this.bbp_forum_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_media?window.BP_Forums_Nouveau.media.forum_edit_media:[],this.bbp_forum_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_document?window.BP_Forums_Nouveau.media.forum_edit_document:[],this.bbp_forum_edit_video=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_video?window.BP_Forums_Nouveau.media.forum_edit_video:[],this.bbp_reply_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_gif_data?window.BP_Forums_Nouveau.media.reply_edit_gif_data:[],this.bbp_topic_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_gif_data?window.BP_Forums_Nouveau.media.topic_edit_gif_data:[],this.bbp_forum_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_gif_data?window.BP_Forums_Nouveau.media.forum_edit_gif_data:[],this.giphy=null,this.gif_offset=0,this.gif_q=null,this.gif_limit=20,this.gif_requests=[],this.gif_data=[],this.gif_container_key=!1,this.reply_topic_allow_delete_media=!1,this.reply_topic_display_post="edit",bp.Nouveau.Media.documentCodeMirror(),i(window).on("scroll resize",function(){bp.Nouveau.Media.documentCodeMirror()})},addListeners:function(){var e=i(".bp-nouveau"),t=i(".bp-existing-media-wrap");e.on("click","#bp-add-media",this.openUploader.bind(this)),e.on("click","#bp-add-document",this.openDocumentUploader.bind(this)),e.on("click","#bp-media-submit",this.submitMedia.bind(this)),e.on("click","#bp-media-document-submit",this.submitDocumentMedia.bind(this)),e.on("click","#bp-media-uploader-close",this.closeUploader.bind(this)),e.on("click","#bb-delete-media",this.deleteMedia.bind(this)),e.on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this)),i('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request),e.on("click","#bb-create-album",this.openCreateAlbumModal.bind(this)),i(document).on("click","#bb-create-folder",this.openCreateFolderModal.bind(this)),i(document).on("click","#bb-create-folder-child",this.openCreateFolderChildModal.bind(this)),i(document).on("click","#bp-edit-folder-open",this.openEditFolderChildModal.bind(this)),i(document).on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this)),i(document).on("click","#bp-media-create-folder-submit",this.saveFolder.bind(this)),i(document).on("click","#bp-media-create-child-folder-submit",this.saveChildFolder.bind(this)),e.on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this)),i(document).on("click","#bp-media-create-folder-close",this.closeCreateFolderModal.bind(this)),i(document).on("click","#bp-media-edit-folder-close",this.closeEditFolderModal.bind(this)),i(document).on("click",".open-popup .errorPopup",this.closeErrorPopup.bind(this)),e.on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),i("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this)),i('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this)),i(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this)),t.on("click","li.load-more",this.appendMedia.bind(this)),e.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this)),t.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this)),e.on("click","#bp-edit-album-title",this.editAlbumTitle.bind(this)),i(document).on("click","#bp-edit-folder-title",this.editFolderTitle.bind(this)),e.on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this)),e.on("click","#bp-save-album-title",this.saveAlbum.bind(this)),i(document).on("click","#bp-save-folder-title",this.saveFolder.bind(this)),e.on("change","#bp-media-single-album select#bb-album-privacy",this.saveAlbum.bind(this)),e.on("change","#media-stream select#bb-folder-privacy",this.savePrivacy.bind(this)),e.on("click","#bb-delete-album",this.deleteAlbum.bind(this)),i(document).on("click","#bb-delete-folder",this.deleteFolder.bind(this)),i(document).on("click","ul.document-nav li",this.resetPageDocumentDirectory.bind(this)),i(document).on("click","ul.document-nav li a",this.resetPageDocumentDirectory.bind(this)),i(document).on("click","#forums-media-button",this.openForumsUploader.bind(this)),i(document).on("click","#forums-document-button",this.openForumsDocumentUploader.bind(this)),i(document).on("click","#forums-video-button",this.openForumsVideoUploader.bind(this)),i(document).on("click","#forums-gif-button",this.toggleGifSelector.bind(this)),i(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keydown",".search-query-input",this.searchGif.bind(this)),i(document).on("click",".bbpress-forums-activity #whats-new-toolbar .found-media-item",this.selectGif.bind(this)),i(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),i(document).find("form #whats-new-toolbar .gif-search-results, .forum form #whats-new-toolbar .gif-search-results").scroll(this.loadMoreGif.bind(this)),i(".buddypress.groups.messages").length||i(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),i(document).find("form #whats-new-attachments .forums-attached-gif-container .gif-search-results, .forum form #whats-new-attachments .forums-attached-gif-container .gif-search-results").scroll(this.loadMoreGif.bind(this)),i(document).find("form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this)),i(document).on("click",".gif-image-container",this.playVideo.bind(this)),i(document).on("click",".directory.document  .media-folder_action__anchor, .directory.document  .media-folder_action__anchor li a, .bb-media-container .media-folder_action__anchor, .bb-media-container  .media-folder_action__list li a",this.fileActionButton.bind(this)),i(document).on("click",".bb-activity-media-elem .copy_download_file_url a, .media-folder_action__list .copy_download_file_url a, .media .bb-photo-thumb .copy_download_file_url a",this.copyDownloadLink.bind(this)),i(document).on("click",".bb-activity-media-elem.media-activity .media-action-wrap .media-action_more, #media-stream.media .bb-photo-thumb .media-action-wrap .media-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_list li a",this.fileActivityActionButton.bind(this)),i(document).click(this.toggleFileActivityActionButton),i(document).on("click",".bb-activity-media-elem.document-activity .document-expand .document-expand-anchor, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_collapse",this.toggleCodePreview.bind(this)),i(document).on("click",".activity .bp-document-move-activity, #media-stream .bp-document-move-activity",this.moveDocumentIntoFolder.bind(this)),i(document).on("click",'.bp-nouveau [data-bp-list="document"] .pager .dt-more-container.load-more',this.injectDocuments.bind(this)),i(document).on("click",'.bp-nouveau [data-bp-list="document"] .data-head',this.sortDocuments.bind(this)),i(document).on("click",".modal-container .bb-field-steps-actions",this.documentPopupNavigate.bind(this)),i(document).on("click",".bp-media-document-uploader .modal-container .bb-field-uploader-actions",this.uploadDocumentNavigate.bind(this)),i(document).on("click",".bp-media-photo-uploader .modal-container .bb-field-uploader-actions",this.uploadMediaNavigate.bind(this)),i(document).on("click",".modal-container #bp-media-edit-child-folder-submit",this.renameChildFolder.bind(this)),i(document).on("click",".activity .bp-media-move-activity, #media-stream .bp-media-move-activity",this.moveMediaIntoAlbum.bind(this));var a=i("#bb-media-model-container .activity-list, #media-stream");i('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-document-move, .ac-folder-move",this.openDocumentMove.bind(this)),i('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream, .group-media #media-stream').on("click",".ac-media-move",this.openMediaMove.bind(this)),i('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-document-close-button, .ac-folder-close-button",this.closeDocumentMove.bind(this)),i('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-media-close-button",this.closeMediaMove.bind(this)),a.on("click",".ac-document-rename",this.renameDocument.bind(this)),a.on("click",".ac-document-privacy",this.editPrivacyDocument.bind(this)),a.on("keyup",".media-folder_name_edit",this.renameDocumentSubmit.bind(this)),a.on("click",".name_edit_cancel, .name_edit_save",this.renameDocumentSubmit.bind(this)),i(document).on("click",".document-file-delete",this.deleteDocument.bind(this)),i(document).on("click",".media-file-delete",this.deleteMedia.bind(this)),i(document).on("click",".bp-folder-move",this.folderMove.bind(this)),i(document).on("click",".bp-document-open-create-popup-folder",this.createFolderInPopup.bind(this)),i(document).on("click",".bp-media-open-create-popup-folder",this.createAlbumInPopup.bind(this)),i(document).on("click",".close-create-popup-folder",this.closeCreateFolderInPopup.bind(this)),i(document).on("click",".close-create-popup-album",this.closeCreateAlbumInPopup.bind(this)),i(document).on("click",".bp-document-create-popup-folder-submit",this.submitCreateFolderInPopup.bind(this)),i(document).on("click",".bp-media-create-popup-album-submit",this.submitCreateAlbumInPopup.bind(this));var o=i(".buddypress.groups.messages"),d=i(".buddypress.groups.messages form#send_group_message_form #whats-new-toolbar"),s=i(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container .gif-search-results"),n=i(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container");if(o.on("click","#bp-group-messages-media-button",this.openGroupMessagesUploader.bind(this)),o.on("click","#bp-group-messages-document-button",this.openGroupMessagesDocumentUploader.bind(this)),o.on("click","#bp-group-messages-video-button",this.openGroupMessagesVideoUploader.bind(this)),o.on("click","#bp-group-messages-gif-button",this.toggleGroupMessagesGifSelector.bind(this)),d.on("keyup",".search-query-input",this.searchGroupMessagesGif.bind(this)),d.on("click",".found-media-item",this.selectGroupMessagesGif.bind(this)),s.scroll(this.loadMoreGroupMessagesGif.bind(this)),i(".groups.messages form#send_group_message_form #whats-new-toolbar .bp-group-messages-attached-gif-container .gif-search-results").scroll(this.loadMoreGroupMessagesGif.bind(this)),n.on("click",".gif-image-remove",this.removeGroupMessagesSelectedGif.bind(this)),i(".bp-existing-media-wrap").on("scroll",this.loadExistingMedia.bind(this)),document.addEventListener("keyup",this.closePopup.bind(this)),document.addEventListener("keyup",this.submitPopup.bind(this)),i(window).bind("beforeunload",this.beforeunloadWindow.bind(this)),_.isUndefined(BP_Nouveau.media.gif_api_key)||(window.addEventListener("scroll",this.autoPlayGifVideos,!1),window.addEventListener("resize",this.autoPlayGifVideos,!1),document.addEventListener("keydown",_.bind(this.closePickersOnEsc,this)),i(document).on("click",_.bind(this.closePickersOnClick,this))),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&i("#forums-media-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&i("#forums-document-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_video.length||this.bbp_topic_edit_video.length||this.bbp_forum_edit_video.length)&&i("#forums-video-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)){this.editGifPreview();var r=jQuery("#forums-gif-button").addClass("active").closest("form");r.find("#forums-document-button")&&r.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),r.find("#forums-media-button")&&r.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),r.find("#forums-video-button")&&r.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable")}"#openEditFolder"==window.location.hash&&i("#bp-media-edit-child-folder").length&&(history.pushState(null,null,window.location.href.split("#")[0]),i("#bp-media-edit-child-folder").show()),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(bp.Nouveau.Media.reply_topic_allow_delete_media=!0)},loadExistingMedia:function(){i(window).scroll()},resetPageDocumentDirectory:function(e){e.preventDefault(),this.current_page=1},submitCreateFolderInPopup:function(e){e.preventDefault();var t=i(e.currentTarget).closest(".open-popup"),a=i(t).find(".bp-document-create-popup-folder-submit"),o=t.find(".bb-folder-selected-id").val(),d=i.trim(i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder-title").val()),s=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder-title"),n=Boolean(/[\\/?%*:|"<>]+/g.exec(s.val()));if(""===i.trim(s.val())||n)return s.addClass("error"),!1;s.removeClass("error"),""===o&&(o=0),this.currentTargetParent=o;var r=this.currentTargetParent,l=0,c="",p="",m=0;if("group"===this.moveToTypePopup?(c="grouponly",l=this.moveToIdPopup):(c=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder #bb-folder-privacy").val(),p=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder #bb-folder-privacy")),""===d)return alert(BP_Nouveau.media.create_folder_error_title),!1;a.addClass("loading"),setTimeout(function(){var e={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:d,privacy:c,parent:r,group_id:l};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,async:!1,success:function(e){if(e.success){i(".document-data-table-head").length&&parseInt(r)===parseInt(BP_Nouveau.media.current_folder)&&(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"),jQuery(window).scroll()),t.find(".location-folder-list-wrap .location-folder-list").remove(),t.find(".location-folder-list-wrap").append(e.data.tree_view);var o="#"+i(t).attr("id");bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(o,e.data.folder_id),m=e.data.folder_id,""===e.data.tree_view?(t.find(".location-folder-list-wrap").hide(),t.find(".location-folder-list-wrap-main span.no-folder-exists").show()):(t.find(".location-folder-list-wrap-main span.no-folder-exists").hide(),t.find(".location-folder-list-wrap").show()),t.find("ul.location-folder-list span#"+m).trigger("click"),t.find(".bb-model-footer").show(),t.find(".bb-model-footer, #bp-media-document-prev").show(),t.find(".bb-field-wrap-search").show(),t.find(".bp-document-open-create-popup-folder").show(),t.find(".location-folder-list-wrap-main").show(),t.find(".create-popup-folder-wrap").hide(),t.find(".bb-folder-selected-id").val(),t.find(".bb-folder-selected-id").val(m),t.find(".bb-model-header").children().show(),t.find(".bb-model-header p").hide(),s.val(""),""!==p&&p.val("public"),i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){e>0&&i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>i(t).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||i('<span class="more_options">...</span>').insertAfter(i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),a.removeClass("loading"),setTimeout(function(){var e=t.find("ul.location-folder-list span#"+m);e.trigger("click");var a=i(t).find("#bb-document-privacy");0!==Number(e.data("id"))?(a.find("option").removeAttr("selected"),a.val(e.parent().data("privacy")),a.prop("disabled",!0)):(a.find("option").removeAttr("selected"),a.val("public"),a.prop("disabled",!1))},200)}}}),this.currentTargetParent=m,t.find(".location-folder-list li.is_active").show().children("span, i").show().siblings("ul").hide(),t.find(".location-folder-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide(),t.find(".location-folder-list li span.selected").removeClass("selected"),t.find(".location-folder-list li.is_active").children("span").addClass("selected")},0)},submitCreateAlbumInPopup:function(e){e.preventDefault();var t=this,a=i(e.currentTarget).closest(".open-popup"),o=i(a).find(".bp-media-create-popup-album-submit"),d=a.find(".bb-album-selected-id").val();""===d&&(d=0),this.currentTargetParent=d;var s=this.currentTargetParent,n=0,r=i.trim(i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album-title").val()),l=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album-title"),c="",p="",m=0;if("group"===this.moveToTypePopup?(c="grouponly",n=this.moveToIdPopup):(c=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy").val(),p=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy")),""===r)return alert(BP_Nouveau.media.create_album_error_title),!1;o.addClass("loading"),setTimeout(function(){var e={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:r,privacy:c,parent:s,group_id:n};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,async:!1,success:function(e){e.success&&(a.find(".location-album-list-wrap .location-album-list").remove(),a.find(".location-album-list-wrap").append(e.data.tree_view),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(a,e.data.album_id),m=e.data.album_id,""===e.data.tree_view?(a.find(".location-album-list-wrap").hide(),a.find(".location-album-list-wrap-main span.no-album-exists").show()):(a.find(".location-album-list-wrap-main span.no-album-exists").hide(),a.find(".location-album-list-wrap").show()),a.find("ul.location-album-list span#"+m).trigger("click"),a.find(".bb-model-footer").show(),a.find(".bb-field-wrap-search").show(),a.find(".bp-media-open-create-popup-album").show(),a.find(".location-album-list-wrap-main").show(),a.find(".create-popup-album-wrap").hide(),a.find(".bb-field-steps-2 #bp-media-prev").show(),a.find(".bb-album-selected-id").val(),a.find(".bb-album-selected-id").val(m),a.find(".bb-model-header").children().show(),a.find(".bb-model-header p").hide(),l.val(""),""!==p&&p.val("public"),i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){e>0&&i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>i(a).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||i('<span class="more_options">...</span>').insertAfter(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),t.updateAlbumNavCount()),o.removeClass("loading")}}),this.currentTargetParent=m,a.find(".location-album-list li.is_active").show().children("span, i").show().siblings("ul").hide(),a.find(".location-album-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide(),a.find(".location-album-list li span.selected").removeClass("selected"),a.find(".location-album-list li.is_active").children("span").addClass("selected")},0)},closeCreateFolderInPopup:function(e){e.preventDefault(),i(".modal-container .bb-model-footer").show(),i(".bb-field-wrap-search").show(),i(".bp-document-open-create-popup-folder").show(),i(".location-folder-list-wrap-main").show(),i("#bp-media-document-prev").show(),i(".create-popup-folder-wrap").hide(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().show(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header p").hide()},closeCreateAlbumInPopup:function(e){e.preventDefault(),i(".modal-container .bb-model-footer").show(),i(".bb-field-wrap-search").show(),i(".bp-document-open-create-popup-folder").show(),i(".modal-container:visible .bp-video-open-create-popup-album").show(),i(".location-album-list-wrap-main").show(),i(".bb-field-steps-2 #bp-media-prev").show(),i(".bb-field-steps-2 #bp-video-next").show(),i(".create-popup-album-wrap").hide(),i(".bp-media-create-popup-album-submit.loading").removeClass("loading"),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().show(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header p").hide()},createFolderInPopup:function(e){e.preventDefault();var t=parseInt(i(document).find(".open-popup .bb-folder-selected-id").val()),a=i(document).find(".open-popup .bb-folder-create-from").val();t>0?i(document).find(".open-popup .privacy-field-wrap-hide-show").hide():i(document).find(".open-popup .privacy-field-wrap-hide-show").show(),"group"===a?i(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide():t>0?i(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide():i(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").show(),i(".modal-container .bb-model-footer, .modal-container #bp-media-document-prev").hide(),i(".bb-field-wrap-search").hide(),i(".bp-document-open-create-popup-folder").hide(),i(".location-folder-list-wrap-main").hide(),i(".create-popup-folder-wrap").show(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().hide(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").append("<p>"+BP_Nouveau.media.create_folder+"</p>"),i(".modal-container #bb-folder-privacy").addClass("new-folder-create-privacy"),i(document).find(".open-popup .error").hide()},createAlbumInPopup:function(e){e.preventDefault();var t=parseInt(i(document).find(".open-popup .bb-album-selected-id").val()),a=i(document).find(".open-popup .bb-album-create-from").val();t>0?i(document).find(".open-popup .privacy-field-wrap-hide-show").hide():i(document).find(".open-popup .privacy-field-wrap-hide-show").show(),"group"===a?i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide():i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),i(".modal-container .bb-model-footer").hide(),i(".bb-field-wrap-search").hide(),i(".bp-document-open-create-popup-folder").hide(),i(".location-album-list-wrap-main").hide(),i(".bb-field-steps-2 #bp-media-prev").hide(),i(".create-popup-album-wrap").show(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().hide(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").append("<p>"+BP_Nouveau.media.create_album_title+"</p>"),i(".modal-container #bb-folder-privacy").addClass("new-folder-create-privacy"),i(document).find(".open-popup .error").hide()},savePrivacy:function(e){var t=i(e.currentTarget),a=0,o="",d="",s="";if(e.preventDefault(),t.hasClass("new-folder-create-privacy"))return!1;if(a=parseInt(t.data("item-id")),o=t.data("item-type"),d=t.val(),s=i(e.currentTarget).find("option:selected").text(),this.privacySelectorSelect.addClass("hide"),this.privacySelectorSpan.text(""),this.privacySelectorSpan.text(s),this.privacySelectorSpan.show(),a>0){var n={action:"document_save_privacy",item_id:a,type:o,value:d,_wpnonce:BP_Nouveau.nonces.media};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){e.success?(i(document).find("#div-listing-"+a+" li#"+a+" a").attr("data-privacy",d),e.data.document&&e.data.document.video_symlink&&i(document).find('a.bb-open-document-theatre[data-id="'+a+'"]').attr("data-video-preview",e.data.document.video_symlink)):(t.find('option[value="'+t.attr("data-privacy")+'"]').attr("selected","selected"),t.siblings("span").text(t.find('option[value="'+t.attr("data-privacy")+'"]').text()),alert(e.data.feedback.replace("&#039;","'")))}})}},folderMove:function(e){var t=i(e.currentTarget);e.preventDefault();var a=t.attr("id"),o=i("#media-folder-document-data-table #bp-media-move-folder .modal-mask .modal-wrapper #boss-media-create-album-popup .bb-field-wrap .bb-folder-selected-id").val();if(""===a||""===o)return alert(BP_Nouveau.media.i18n_strings.folder_move_error),!1;t.addClass("loading");var d={action:"document_folder_move",current_folder_id:a,folder_move_to_id:o,group_id:this.group_id,_wpnonce:BP_Nouveau.nonces.media};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(e){if(!e.success)return i(document).find(".open-popup .error").show(),i(document).find(".open-popup .error").html(e.data.feedback),t.removeClass("loading"),!1;if("yes"===BP_Nouveau.media.is_document_directory)"personal"===bp.Nouveau.getStorage("bp-document").scope?(i(document).find("li#document-personal a").trigger("click"),i(document).find("li#document-personal").trigger("click")):(i(document).find("li#document-all a").trigger("click"),i(document).find("li#document-all").trigger("click"));else{var a=i("#media-stream");a.html(""),a.html(e.data.html),i(document).find(".open-popup .error").hide(),i(document).find(".open-popup .error").html(""),t.removeClass("loading"),i(document).removeClass("open-popup")}}})},deleteDocument:function(e){var t=i(e.currentTarget);e.preventDefault();var a=t.attr("data-type"),o=t.attr("data-item-id"),d=t.attr("data-item-attachment-id"),s=t.attr("data-item-preview-attachment-id"),n=t.attr("data-item-from"),r=[];if("activity"!==n){if("folder"===a){if(!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm))return!1}else if("document"===a&&!confirm(BP_Nouveau.media.i18n_strings.document_delete_confirm))return!1;if(r={action:"document_delete",id:o,preview_attachment_id:s,type:a,attachment_id:d,_wpnonce:BP_Nouveau.nonces.media},"yes"===BP_Nouveau.media.is_document_directory){var l=bp.Nouveau.getStorage("bp-document").scope;""===l?r.scope="all":r.scope=l}i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,asyc:!1,data:r,success:function(e){if(e.success){var t=i("#media-stream");t.html(""),t.html(e.data.html)}}}),this.current_page=1}else{if(!confirm(BP_Nouveau.media.i18n_strings.document_delete_confirm))return!1;var c=t.attr("data-item-activity-id");r={action:"document_activity_delete",id:o,preview_attachment_id:s,type:a,activity_id:c,attachment_id:d,_wpnonce:BP_Nouveau.nonces.media},i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:r,success:function(e){e.success&&(i("body #buddypress .activity-list li#activity-"+c+" .document-activity .activity-inner .bb-activity-media-wrap .document-activity."+o).remove(),i("body #buddypress .activity-list .activity-comments .document-activity."+o).remove(),!0===e.data.delete_activity?(i("body #buddypress .activity-list li#activity-"+c).remove(),i("body .bb-activity-media-elem.document-activity."+o).remove(),i("body .activity-comments li#acomment-"+c).remove()):i("body #buddypress .activity-list li#activity-"+c).replaceWith(e.data.activity_content))}})}},bp_ajax_media_request:function(e,t){BP_Nouveau.media.group_id&&void 0!==t&&void 0!==t.response.scopes.groups&&0===parseInt(t.response.scopes.groups)?i(".bb-photos-actions").hide():BP_Nouveau.media.group_id&&void 0!==t&&void 0!==t.response.scopes.groups&&0!==parseInt(t.response.scopes.groups)?i(".bb-photos-actions").show():void 0!==t&&void 0!==t.response.scopes.personal&&0===parseInt(t.response.scopes.personal)?i(".bb-photos-actions").hide():void 0!==t&&void 0!==t.response.scopes.personal&&0!==parseInt(t.response.scopes.personal)&&i(".bb-photos-actions").show()},addSelectedClassToWrapper:function(e){var t=e.currentTarget;if(i(t).is(":checked"))i(t).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),i(t).closest(".bb-item-thumb").addClass("selected");else{i(t).closest(".bb-item-thumb").removeClass("selected"),i(t).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select);var a=i(".bp-nouveau #bb-select-deselect-all-media");a.hasClass("selected")&&a.removeClass("selected")}},moveDocumentIntoFolder:function(e){var t=i(e.currentTarget);e.preventDefault();var a=t.attr("id"),o=t.closest(".bp-media-move-file").find(".bb-folder-selected-id").val();if(""===a||""===o)return t.closest(".modal-container").find(".location-folder-list").addClass("has-error"),!1;"yes"!==BP_Nouveau.media.is_document_directory&&(this.current_page=1),t.closest(".modal-container").find(".location-folder-list").removeClass("has-error"),t.addClass("loading");var d="";d=i(document).find('a[data-media-id="'+a+'"]').attr("data-parent-activity-id");var s={action:"document_move",_wpnonce:BP_Nouveau.nonces.media,document_id:a,folder_id:o,group_id:this.group_id,activity_id:d};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){if(e.success){if("yes"===BP_Nouveau.media.is_document_directory)"personal"===bp.Nouveau.getStorage("bp-document").scope?(i(document).find("li#document-personal a").trigger("click"),i(document).find("li#document-personal").trigger("click")):(i(document).find("li#document-all a").trigger("click"),i(document).find("li#document-all").trigger("click"));else{parseInt(BP_Nouveau.media.current_folder)>0?i('#document-stream ul.media-list li[data-id="'+a+'"]').remove():i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').length&&!i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').parent().hasClass("bb-media-length-1")&&(i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').remove(),d&&d.length&&(i('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove(),i('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner').append(e.data.document_content)));var o=i("#media-stream");o.html(""),o.html(e.data.html),i(document).find(".open-popup .error").hide(),i(document).find(".open-popup .error").html(""),t.removeClass("loading"),i(document).removeClass("open-popup")}t.closest(".bp-media-move-file").find(".ac-document-close-button").trigger("click")}else alert(e.data.feedback.replace("&#039;","'"))}})},moveMediaIntoAlbum:function(e){var t=i(e.currentTarget);e.preventDefault();var a=t.attr("id"),o=t.closest(".bp-media-move-file").find(".bb-album-selected-id").val();if(""===a||""===o)return t.closest(".modal-container").find(".location-album-list").addClass("has-error"),!1;t.closest(".modal-container").find(".location-album-list").removeClass("has-error"),t.addClass("loading");var d="";d=i(document).find('a[data-media-id="'+a+'"]').attr("data-parent-activity-id");var s=parseInt(this.group_id);s||(s=!1,"group"===i(document).find('a[data-media-id="'+a+'"]').attr("data-type")&&(s=i(document).find('a[data-media-id="'+a+'"]').attr("id")));var n={action:"media_move",_wpnonce:BP_Nouveau.nonces.media,media_id:a,album_id:o,group_id:s,activity_id:d};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){e.success?("yes"===BP_Nouveau.media.is_media_directory?"personal"===bp.Nouveau.getStorage("bp-media").scope?(i(document).find("li#media-personal a").trigger("click"),i(document).find("li#media-personal").trigger("click")):(i(document).find("li#media-all a").trigger("click"),i(document).find("li#media-all").trigger("click")):(parseInt(BP_Nouveau.media.current_album)>0?i('#media-stream ul.media-list li[data-id="'+a+'"]').remove():i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').length&&!i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').parent().hasClass("bb-media-length-1")&&(i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').remove(),d&&d.length&&(i('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove(),i('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner').append(e.data.media_content),jQuery(window).scroll())),i(document).find(".open-popup .error").hide(),i(document).find(".open-popup .error").html(""),t.removeClass("loading"),i(document).removeClass("open-popup")),t.closest(".bp-media-move-file").find(".ac-media-close-button").trigger("click"),i(document).find('a.bb-open-media-theatre[data-id="'+a+'"]').data("album-id",o)):alert(e.data.feedback.replace("&#039;","'"))}})},deleteMedia:function(e){var t=i(e.currentTarget),a=this;e.preventDefault();var o=[],d=i("#buddypress"),s=t.attr("data-type"),n=t.data("item-from"),r="",l="";if("album"===s){if(!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm))return!1}else if("media"===s&&!confirm(BP_Nouveau.media.i18n_strings.media_delete_confirm))return!1;if(t.hasClass("bb-delete")){if(!confirm(BP_Nouveau.media.i18n_strings.media_delete_confirm))return!1;var c=d.find(".media-list:not(.existing-media-list)");c.find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){i(this).closest(".bb-item-thumb").addClass("loading deleting"),o.push(i(this).val())}),c.parent().parent().hasClass("album-single-view")&&c.find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){i(this).closest(".bb-item-thumb").addClass("loading deleting"),o.push(i(this).val())})}if(l=t.data("parent-activity-id"),n&&n.length&&"activity"===n&&0==o.length&&(r=t.attr("data-item-id"),o.push(r)),0==o.length&&o.push(t.data("item-id")),0==o.length)return!1;t.prop("disabled",!0),i("#buddypress #media-stream.media .bp-feedback").remove();var p={action:"media_delete",_wpnonce:BP_Nouveau.nonces.media,media:o,activity_id:l,from_where:n};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:p,success:function(e){a.current_page=1;var s="";if(n&&n.length&&"activity"===n)e.success&&(i.each(o,function(e,t){i('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+t+'"]').length&&i('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+t+'"]').remove(),i("body .bb-activity-media-elem.media-activity."+t).length&&i("body .bb-activity-media-elem.media-activity."+t).remove()}),i('#activity-stream ul.activity-list li[data-bp-activity-id="'+l+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove(),i('#activity-stream ul.activity-list li[data-bp-activity-id="'+l+'"] .activity-content .activity-inner').append(e.data.media_content),0==i('#activity-stream ul.activity-list li[data-bp-activity-id="'+l+'"] .activity-content .activity-inner .bb-activity-media-elem').length&&i('#activity-stream ul.activity-list li[data-bp-activity-id="'+l+'"]').remove(),!0===e.data.delete_activity?(i("body #buddypress .activity-list li#activity-"+l).remove(),i("body .bb-activity-media-elem.media-activity."+r).remove(),i("body .activity-comments li#acomment-"+l).remove()):i("body #buddypress .activity-list li#activity-"+l).replaceWith(e.data.activity_content));else if(n&&n.length&&"media"===n){if(e.success){if("yes"===BP_Nouveau.media.is_media_directory){var c=bp.Nouveau.getStorage("bp-media").scope;"personal"===c?(i(document).find("li#media-personal a").trigger("click"),i(document).find("li#media-personal").trigger("click")):"groups"===c?(i(document).find("li#media-groups a").trigger("click"),i(document).find("li#media-groups").trigger("click")):(i(document).find("li#media-all a").trigger("click"),i(document).find("li#media-all").trigger("click"))}else e.data.media_personal_count&&i("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(e.data.media_personal_count),e.data.media_group_count&&i("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(e.data.media_group_count),i.each(o,function(e,t){i('#media-stream ul.media-list li[data-id="'+t+'"]').length&&i('#media-stream ul.media-list li[data-id="'+t+'"]').remove()}),0==i("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length&&(i(".bb-photos-actions").hide(),s='<aside class="bp-feedback bp-messages info">\n	<span class="bp-icon" aria-hidden="true"></span>\n	<p>'+BP_Nouveau.media.i18n_strings.no_photos_found+"</p>\n	</aside>",i('#buddypress [data-bp-list="media"]').html(s))}}else if(setTimeout(function(){t.prop("disabled",!1)},500),e.success){void 0!==e.data&&void 0!==e.data.media_personal_count&&i("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(e.data.media_personal_count),void 0!==e.data&&void 0!==e.data.media_group_count&&i("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(e.data.media_group_count);var p=d.find(".media-list:not(.existing-media-list)");p.find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){i(this).closest("li").remove()}),p.parent().parent().hasClass("album-single-view")&&p.find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){i(this).closest("li").remove()}),0==i("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length&&(i(".bb-photos-actions").hide(),s='<aside class="bp-feedback bp-messages info">\n	<span class="bp-icon" aria-hidden="true"></span>\n	<p>'+BP_Nouveau.media.i18n_strings.no_photos_found+"</p>\n	</aside>",i('#buddypress [data-bp-list="media"]').html(s))}else i("#buddypress #media-stream.media").prepend(e.data.feedback);jQuery(window).scroll()}})},toggleSelectAllMedia:function(e){e.preventDefault(),i(e.currentTarget).hasClass("selected")?(i(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllMedia(e)):(i(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllMedia(e)),i(e.currentTarget).toggleClass("selected")},selectAllMedia:function(e){e.preventDefault();var t=i("#buddypress").find(".media-list:not(.existing-media-list)");t.find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){i(this).prop("checked",!0),i(this).closest(".bb-item-thumb").addClass("selected"),i(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)}),t.parent().parent().hasClass("album-single-view")&&t.find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){i(this).prop("checked",!0),i(this).closest(".bb-item-thumb").addClass("selected"),i(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllMedia:function(e){e.preventDefault();var t=i("#buddypress").find(".media-list:not(.existing-media-list)");t.find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){i(this).prop("checked",!1),i(this).closest(".bb-item-thumb").removeClass("selected"),i(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)}),t.parent().parent().hasClass("album-single-view")&&t.find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){i(this).prop("checked",!1),i(this).closest(".bb-item-thumb").removeClass("selected"),i(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},editAlbumTitle:function(e){e.preventDefault(),i("#bb-album-title").show(),i("#bp-save-album-title").show(),i("#bp-cancel-edit-album-title").show(),i("#bp-edit-album-title").hide(),i("#bp-media-single-album #bp-single-album-title").hide()},editFolderTitle:function(e){e.preventDefault(),i("#bb-album-title").show(),i("#bp-save-folder-title").show(),i("#bp-cancel-edit-album-title").show(),i("#bp-edit-folder-title").hide(),i("#bp-media-single-album #bp-single-album-title").hide()},cancelEditAlbumTitle:function(e){e.preventDefault(),i("#bb-album-title").removeClass("error").hide(),i("#bp-save-album-title,#bp-save-folder-title").hide(),i("#bp-cancel-edit-album-title").hide(),i("#bp-edit-album-title,#bp-edit-folder-title").show(),i("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){this.dropzone_obj.hiddenFileInput.click()},closeUploader:function(e){e.preventDefault(),i("#bp-media-uploader").hide(),i("#bp-media-add-more").hide(),i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload),i("#bp-media-uploader-modal-status-text").text(""),i("#bp-media-post-content").val(""),this.dropzone_obj.element&&this.dropzone_obj.destroy(),this.dropzone_media=[];var t=i(e.currentTarget).closest("#bp-media-uploader");i(".close-create-popup-album").trigger("click"),i(".close-create-popup-folder").trigger("click"),t.find('.breadcrumbs-append-ul-li .item span[data-id="0"]').trigger("click"),t.find(".bb-field-steps").length&&(t.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),t.find(".bb-field-steps-1 #bp-media-photo-next, .bb-field-steps-1 #bp-media-document-next ").hide(),t.find(".bb-field-steps-1").removeClass("controls-added"),t.find("#bp-media-document-prev, #bp-media-prev, #bp-media-document-submit, #bp-media-submit, .bp-media-open-create-popup-folder, .bp-document-open-create-popup-folder, .create-popup-folder-wrap, .create-popup-album-wrap, .bp-video-open-create-popup-album").hide()),this.clearFolderLocationUI(e)},closeChildFolderUploader:function(e){e.preventDefault(),i(document).find(".open-popup #bb-album-child-title").val(""),i(document).find(".open-popup #bp-media-create-child-folder-submit").removeClass("loading"),i(document).find("#bp-media-create-child-folder").removeClass("open-popup"),i(document).find("#bp-media-create-child-folder").hide(),i(document).find(".open-popup #bb-album-title").text(""),i(document).find(".open-popup #bp-media-create-folder").hide(),i(document).find("#bp-media-create-folder").removeClass("open-popup")},closeFolderUploader:function(e){e.preventDefault(),i(document).find(".open-popup #bb-album-title").val(""),i(document).find(".open-popup #bp-media-create-folder-submit").removeClass("loading"),i(document).find(".open-popup #bp-media-document-submit").hide(),i(document).find("#bp-media-create-folder").removeClass("open-popup"),i(document).find("#bp-media-create-folder").hide()},loadMoreGif:function(e){var t=e.target,a=this,o=i(e.target).closest("form").find(".forums-attached-gif-container"),d=o.data("key");if(a.gif_container_key=d,t.scrollTop+t.offsetHeight>=t.scrollHeight&&!o.hasClass("loading")&&a.gif_data[d].total_count>0&&a.gif_data[d].offset<=a.gif_data[d].total_count){var s={offset:a.gif_data[d].offset,fmt:"json",limit:a.gif_data[d].limit};o.addClass("loading");var n=null;n=_.isNull(a.gif_data[d].q)?a.giphy.trending(s,_.bind(a.loadMoreGifResponse,a)):a.giphy.search(_.extend({q:a.gif_data[d].q},s),_.bind(a.loadMoreGifResponse,a)),a.gif_data[d].requests.push(n),a.gif_data[d].offset=a.gif_data[d].offset+a.gif_data[d].limit}},loadMoreGroupMessagesGif:function(e){var t=e.target,a=this,o=i(e.target).closest("form").find(".bp-group-messages-attached-gif-container").data("key");if(a.gif_container_key=o,t.scrollTop+t.offsetHeight>=t.scrollHeight&&!i(e.target).closest(".bp-group-messages-attached-gif-container").hasClass("loading")&&a.gif_total_count>0&&a.gif_offset<=a.gif_total_count){var d={offset:a.gif_offset,fmt:"json",limit:a.gif_limit};i(e.target).closest(".bp-group-messages-attached-gif-container").addClass("loading");var s=null;s=_.isNull(a.gif_q)?a.giphy.trending(d,_.bind(a.loadMoreGroupMessagesGifResponse,a)):a.giphy.search(_.extend({q:a.gif_q},d),_.bind(a.loadMoreGroupMessagesGifResponse,a)),a.gif_requests.push(s),a.gif_offset=a.gif_offset+a.gif_limit,a.gif_data[o].requests.push(s),a.gif_data[o].offset=a.gif_data[o].offset+a.gif_data[o].limit}},loadMoreGroupMessagesGifResponse:function(e){var t=this,a=0;if(i(".bp-group-messages-attached-gif-container").removeClass("loading"),void 0!==e.data&&e.data.length){var o="";for(a=0;a<e.data.length;a++)o+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[a].images.fixed_width.height+'px;">\n	<a class="found-media-item" href="'+e.data[a].images.original.url+'" data-id="'+e.data[a].id+'">\n		<img src="'+e.data[a].images.fixed_width.url+'">\n	</a>\n</li>',e.data[a].saved=!1,t.gif_data.push(e.data[a]);i(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_total_count=e.pagination.total_count)},loadMoreGifResponse:function(e){var t=this,a=0;if(i('div.forums-attached-gif-container[data-key="'+t.gif_container_key+'"]').removeClass("loading"),void 0!==e.data&&e.data.length){var o="";for(a=0;a<e.data.length;a++)o+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[a].images.fixed_width.height+'px;">\n	<a class="found-media-item" href="'+e.data[a].images.original.url+'" data-id="'+e.data[a].id+'">\n		<img src="'+e.data[a].images.fixed_width.url+'">\n	</a>\n</li>',e.data[a].saved=!1,t.gif_data[t.gif_container_key].data.push(e.data[a]);i('div.forums-attached-gif-container[data-key="'+t.gif_container_key+'"]').closest("form").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_data[t.gif_container_key].total_count=e.pagination.total_count)},editGifPreview:function(){var e={};if(this.bbp_is_reply_edit&&Object.keys(this.bbp_reply_edit_gif_data).length?e=this.bbp_reply_edit_gif_data.gif_raw_data:this.bbp_is_topic_edit&&Object.keys(this.bbp_topic_edit_gif_data).length?e=this.bbp_topic_edit_gif_data.gif_raw_data:this.bbp_is_forum_edit&&Object.keys(this.bbp_forum_edit_gif_data).length&&(e=this.bbp_forum_edit_gif_data.gif_raw_data),void 0===e.images)return!1;var t=i("#whats-new-attachments .forums-attached-gif-container");t[0].style.backgroundImage="url("+e.images.fixed_width.url+")",t[0].style.backgroundSize="contain",t[0].style.height=e.images.original.height+"px",t[0].style.width=e.images.original.width+"px",t.find(".gif-image-container img").attr("src",e.images.original.url),t.removeClass("closed"),i("#bbp_media_gif").length&&i("#bbp_media_gif").val(JSON.stringify(e))},selectGif:function(e){var t=0,a=i(e.currentTarget),o=a.closest("form").find(".forums-attached-gif-container");e.preventDefault(),o.closest("form").find(".gif-media-search-dropdown").removeClass("open");var d=o.data("key");if(void 0!==this.gif_data[d]&&void 0!==this.gif_data[d].data&&this.gif_data[d].data.length){for(t=0;t<this.gif_data[d].data.length;t++)if(this.gif_data[d].data[t].id==e.currentTarget.dataset.id){a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+this.gif_data[d].data[t].images.fixed_width.url+")",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.height=this.gif_data[d].data[t].images.original.height+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.width=this.gif_data[d].data[t].images.original.width+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",this.gif_data[d].data[t].images.original.url),a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),a.closest("form").find("#bbp_media_gif").length&&a.closest("form").find("#bbp_media_gif").val(JSON.stringify(this.gif_data[d].data[t]));break}var s=a.closest("form");s.addClass("has-gif"),s.find("#forums-document-button")&&s.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),s.find("#forums-media-button")&&s.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),s.find("#forums-video-button")&&s.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable")}},selectGroupMessagesGif:function(e){var t=0;e.preventDefault();var a=i("#whats-new-attachments .bp-group-messages-attached-gif-container"),o=i("#bp_group_messages_gif");if(i("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),this.gif_data.length){for(t=0;t<this.gif_data.length;t++)if(this.gif_data[t].id==e.currentTarget.dataset.id){a[0].style.backgroundImage="url("+this.gif_data[t].images.fixed_width.url+")",a[0].style.backgroundSize="contain",a[0].style.height=this.gif_data[t].images.original.height+"px",a[0].style.width=this.gif_data[t].images.original.width+"px",a.find(".gif-image-container img").attr("src",this.gif_data[t].images.original.url),a.removeClass("closed"),o.length&&o.val(JSON.stringify(this.gif_data[t]));break}var d=i("#send_group_message_form");d.find("#bp-group-messages-media-button")&&d.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").addClass("disable"),d.find("#bp-group-messages-document-button")&&d.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").addClass("disable"),d.find("#bp-group-messages-video-button")&&d.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("disable")}},removeSelectedGif:function(e){e.preventDefault(),this.resetForumsGifComponent(e)},removeGroupMessagesSelectedGif:function(e){e.preventDefault(),this.resetGroupMessagesGifComponent()},resetForumsGifComponent:function(e){var t=i(e.target);t.closest("form").find("#whats-new-toolbar #forums-gif-button").removeClass("active"),t.closest("form").find(".gif-media-search-dropdown").removeClass("open");var a=t.closest("form").find("#whats-new-attachments .forums-attached-gif-container");a.length&&(a.addClass("closed"),a.find(".gif-image-container img").attr("src",""),a[0].style=""),t.closest("form").find("#bbp_media_gif").length&&t.closest("form").find("#bbp_media_gif").val("");var o=t.closest("form");o.removeClass("has-gif"),o.find("#forums-document-button")&&o.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#forums-media-button")&&o.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#forums-video-button")&&o.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#forums-gif-button")&&o.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("no-click")},resetGroupMessagesGifComponent:function(){var e=i("#whats-new-attachments .bp-group-messages-attached-gif-container"),t=i("#bp_group_messages_gif");i("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),i("#whats-new-toolbar #bp-group-messages-gif-button").removeClass("active"),e.addClass("closed"),e.find(".gif-image-container img").attr("src",""),e[0].style="",t.length&&t.val("");var a=i("#send_group_message_form");a.find("#bp-group-messages-media-button")&&a.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find("#bp-group-messages-document-button")&&a.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find("#bp-group-messages-video-button")&&a.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").removeClass("disable")},searchGif:function(e){if("Enter"===e.key||13===e.keyCode)return e.preventDefault(),!1;var i=this;null!=i.gif_timeout&&clearTimeout(this.gif_timeout),i.gif_timeout=setTimeout(function(){i.gif_timeout=null,i.searchGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGif:function(e){var i=this;if(null!=i.gif_timeout&&clearTimeout(this.gif_timeout),""===e.target.value){this.toggleGroupMessagesGifSelector(e);return}i.gif_timeout=setTimeout(function(){i.gif_timeout=null,i.searchGroupMessagesGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGifRequest:function(e){var t=this;t.gif_q=e.target.value,t.gif_offset=0;var a=0;t.clearGifRequests(),i(e.target).closest(".bp-group-messages-attached-gif-container").addClass("loading"),i(e.target).find(".gif-no-results").removeClass("show"),i(e.target).find(".gif-no-connection").removeClass("show");var o=t.giphy.search({q:t.gif_q,offset:t.gif_offset,fmt:"json",limit:t.gif_limit},function(o){if(void 0!==o.data.length&&0===o.data.length&&i(e.target).find(".gif-no-results").addClass("show"),void 0!==o.meta.status&&200!==o.meta.status&&i(e.target).find(".gif-no-connection").addClass("show"),void 0!==o.data&&o.data.length){var d="";for(a=0;a<o.data.length;a++)d+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+o.data[a].images.fixed_width.height+'px;">\n	<a class="found-media-item" href="'+o.data[a].images.original.url+'" data-id="'+o.data[a].id+'">\n		<img src="'+o.data[a].images.fixed_width.url+'">\n	</a>\n</li>',o.data[a].saved=!1,t.gif_data.push(o.data[a]);i(e.target).closest(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(d)}void 0!==o.pagination&&void 0!==o.pagination.total_count&&(t.gif_total_count=o.pagination.total_count),i(e.target).closest(".bp-group-messages-attached-gif-container").removeClass("loading")},function(){i(e.target).find(".gif-no-connection").addClass("show")});t.gif_requests.push(o),t.gif_offset=t.gif_offset+t.gif_limit},searchGifRequest:function(e){var t=this,a=0,o=i(e.target).closest("form").find(".forums-attached-gif-container");o.addClass("loading");var d=o.data("key");i(e.target).closest("form").find(".gif-no-results").removeClass("show"),i(e.target).closest("form").find(".gif-no-connection").removeClass("show"),t.clearGifRequests(d),t.gif_data[d].q=e.target.value,t.gif_data[d].offset=0;var s=t.giphy.search({q:t.gif_data[d].q,offset:t.gif_data[d].offset,fmt:"json",limit:t.gif_data[d].limit},function(s){if(void 0!==s.data.length&&0===s.data.length&&i(e.target).closest("form").find(".gif-no-results").addClass("show"),void 0!==s.meta.status&&200!==s.meta.status&&i(e.target).closest("form").find(".gif-no-connection").addClass("show"),void 0!==s.data&&s.data.length){var n="";for(a=0;a<s.data.length;a++)n+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+s.data[a].images.fixed_width.height+'px;">\n	<a class="found-media-item" href="'+s.data[a].images.original.url+'" data-id="'+s.data[a].id+'">\n		<img src="'+s.data[a].images.fixed_width.url+'">\n	</a>\n</li>',s.data[a].saved=!1,t.gif_data[d].data.push(s.data[a]);i(e.target).closest(".gif-search-content").find(".gif-search-results-list").append(n)}void 0!==s.pagination&&void 0!==s.pagination.total_count&&(t.gif_data[d].total_count=s.pagination.total_count),o.removeClass("loading")},function(){i(e.target).closest("form").find(".gif-no-connection").addClass("show")});t.gif_data[d].requests.push(s),t.gif_data[d].offset=t.gif_data[d].offset+t.gif_data[d].limit},clearGifRequests:function(e){var t=this;if(void 0!==t.gif_data[e]&&void 0!==t.gif_data[e].requests){for(var a=0;a<t.gif_data[e].requests.length;a++)t.gif_data[e].requests[a].abort();i('[data-key="'+e+'"]').closest("form").find(".gif-search-results-list li").remove(),t.gif_data[e].requests=[],t.gif_data[e].data=[],t.gif_data.splice(e,1)}},toggleGifSelector:function(e){var t=this,a=i(e.currentTarget),o=a.closest("form").find(".gif-media-search-dropdown"),d=0;if(e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key){t.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key);var s=a.closest("form").find(".forums-attached-gif-container");s.addClass("loading");var n=s.data("key");t.clearGifRequests(n),t.gif_data[n]={q:null,offset:0,limit:20,requests:[],total_count:0,data:[]};var r=t.giphy.trending({offset:t.gif_data[n].offset,fmt:"json",limit:t.gif_data[n].limit},function(e){if(void 0!==e.data&&e.data.length){var i="";for(d=0;d<e.data.length;d++)i+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n	<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n		<img src="'+e.data[d].images.fixed_width.url+'">\n	</a>\n</li>',e.data[d].saved=!1,t.gif_data[n].data.push(e.data[d]);a.closest("form").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_data[n].total_count=e.pagination.total_count),s.removeClass("loading")});t.gif_data[n].requests.push(r),t.gif_data[n].offset=t.gif_data[n].offset+t.gif_data[n].limit}o.toggleClass("open");var l=a.parents("form").find("#whats-new-attachments .forums-attached-gif-container img");l.length>0&&""!=l.attr("src")?a.addClass("active"):a.toggleClass("active");var c=a.closest("form").find("#forums-post-media-uploader");c.length&&t.resetForumsMediaComponent(c.data("key"));var p=a.closest("form").find("#forums-post-document-uploader");p.length&&t.resetForumsDocumentComponent(p.data("key"));var m=a.closest("form").find("#forums-post-video-uploader");m.length&&t.resetForumsVideoComponent(m.data("key"))},closePickersOnEsc:function(e){var t=i(e.currentTarget);"Escape"!==e.key&&27!==e.keyCode||_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.gif_api_key)||(t.find("form").find(".gif-media-search-dropdown").removeClass("open"),t.find("#bbpress-forums form").each(function(){var e=jQuery(this),i=e.find("#whats-new-attachments .forums-attached-gif-container img");i.length>0&&""!=i.attr("src")?e.find("#forums-gif-button").addClass("active"):e.find("#forums-gif-button").removeClass("active")}),t.find("#send_group_message_form").each(function(){var e=jQuery(this),i=e.find("#whats-new-attachments .bp-group-messages-attached-gif-container img");i.length>0&&""!=i.attr("src")?e.find("#bp-group-messages-gif-button").addClass("active"):e.find("#bp-group-messages-gif-button").removeClass("active")}),t.find(".activity-comments form").each(function(){var e=jQuery(this),t=e.find(".ac-textarea").find(".ac-reply-attachments .activity-attached-gif-container");t.length&&""!=i.trim(t.html())?e.find(".ac-reply-gif-button").addClass("active"):e.find(".ac-reply-gif-button").removeClass("active")}))},closePickersOnClick:function(e){var t=i(e.target),a=i(e.currentTarget);_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.gif_api_key)||t.closest(".post-gif").length||(a.find("form").find(".gif-media-search-dropdown").removeClass("open"),a.find("#bbpress-forums form").each(function(){var e=jQuery(this),i=e.find("#whats-new-attachments .forums-attached-gif-container img");i.length>0&&""!=i.attr("src")?e.find("#forums-gif-button").addClass("active"):e.find("#forums-gif-button").removeClass("active")}),a.find("#send_group_message_form").each(function(){var e=jQuery(this),i=e.find("#whats-new-attachments .bp-group-messages-attached-gif-container img");i.length>0&&""!=i.attr("src")?e.find("#bp-group-messages-gif-button").addClass("active"):e.find("#bp-group-messages-gif-button").removeClass("active")}),a.find(".activity-comments form").each(function(){var e=jQuery(this),t=e.find(".ac-textarea").find(".ac-reply-attachments .activity-attached-gif-container");t.length&&""!=i.trim(t.html())?e.find(".ac-reply-gif-button").addClass("active"):e.find(".ac-reply-gif-button").removeClass("active")}))},toggleGroupMessagesGifSelector:function(e){var t=this,a=i(e.currentTarget),o=a.closest("form").find(".gif-media-search-dropdown"),d=0;if(e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key&&null==t.giphy){t.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key),t.gif_offset=0,t.gif_q=null,t.gif_limit=20,t.gif_requests=[],t.gif_data=[],t.clearGifRequests(),i(".gif-search-query").closest(".bp-group-messages-attached-gif-container").addClass("loading");var s=t.giphy.trending({offset:t.gif_offset,fmt:"json",limit:t.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var o="";for(d=0;d<e.data.length;d++)o+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n	<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n		<img src="'+e.data[d].images.fixed_width.url+'">\n	</a>\n</li>',e.data[d].saved=!1,t.gif_data.push(e.data[d]);a.closest("form").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_total_count=e.pagination.total_count),i(".gif-search-query").closest(".bp-group-messages-attached-gif-container").removeClass("loading")});t.gif_requests.push(s),t.gif_offset=t.gif_offset+t.gif_limit}var n=a.parents("form").find("#whats-new-attachments .bp-group-messages-attached-gif-container img");n.length>0&&""!=n.attr("src")?a.addClass("active"):a.toggleClass("active"),o.toggleClass("open"),t.resetGroupMessagesMediaComponent(),t.resetGroupMessagesDocumentComponent(),t.resetGroupMessagesVideoComponent()},resetGroupMessagesMediaComponent:function(){var e=this;e.dropzone_obj&&void 0!==e.dropzone_obj&&e.dropzone_obj.destroy(),e.dropzone_media=[],i("div#bp-group-messages-post-media-uploader").html(""),i("div#bp-group-messages-post-media-uploader").addClass("closed").removeClass("open"),i("#bp-group-messages-media-button").removeClass("active"),i("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_media").val("")},resetGroupMessagesDocumentComponent:function(){var e=this;e.document_dropzone_obj&&void 0!==e.document_dropzone_obj&&e.document_dropzone_obj.destroy(),e.dropzone_media=[],i("div#bp-group-messages-post-document-uploader").html(""),i("div#bp-group-messages-post-document-uploader").addClass("closed").removeClass("open"),i("#bp-group-messages-document-button").removeClass("active"),i("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_document").val("")},resetGroupMessagesVideoComponent:function(){var e=this;e.video_dropzone_obj&&void 0!==e.video_dropzone_obj&&e.video_dropzone_obj.destroy(),e.dropzone_media=[],i("div#bp-group-messages-post-video-uploader").html(""),i("div#bp-group-messages-post-video-uploader").addClass("closed").removeClass("open"),i("#bp-group-messages-video-button").removeClass("active"),i("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_video").val("")},resetForumsMediaComponent:function(e){if(i("#forums-media-button").removeClass("active"),void 0!==e){void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1));var t=i("div#forums-post-media-uploader");t.html(""),t.addClass("closed").removeClass("open")}},resetForumsDocumentComponent:function(e){if(i("#forums-document-button").removeClass("active"),void 0!==e){void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1));var t=i("div#forums-post-document-uploader");t.html(""),t.addClass("closed").removeClass("open")}},resetForumsVideoComponent:function(e){if(i("#forums-video-button").removeClass("active"),void 0!==e){void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1));var t=i("div#forums-post-video-uploader");t.html(""),t.addClass("closed").removeClass("open")}},openForumsUploader:function(e){var t=this,a=i(e.currentTarget),o=a.closest("form").find("#forums-post-media-uploader"),d=a.closest("form").find("#forums-post-document-uploader"),s=a.closest("form").find("#forums-post-video-uploader"),n=[];e.preventDefault(),a.toggleClass("active");var r=d.data("key"),l=s.data("key");if(t.resetForumsDocumentComponent(r),t.resetForumsVideoComponent(l),void 0!==window.Dropzone&&o.length){var c=o.data("key");if(o.hasClass("closed")){if(t.dropzone_obj[c]=new Dropzone(o[0],t.options),t.dropzone_media[c]=[],t.dropzone_obj[c].on("sending",function(e,i,t){t.append("action","media_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media);var o=a.closest("form");o.addClass("has-media"),o.find("#forums-document-button")&&o.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-gif-button")&&o.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-video-button")&&o.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-media-button")&&o.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("no-click")}),t.dropzone_obj[c].on("uploadprogress",function(e){a.closest("form").addClass("media-uploading");var t=i(e.previewElement).find(".dz-progress-ring circle")[0],o=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=o+" "+o,t.style.strokeDashoffset=o;var d=o-e.upload.progress.toFixed(0)/100*o;t.style.strokeDashoffset=d}),t.dropzone_obj[c].on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&i(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".forum-document-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e),a.closest("form").removeClass("media-uploading"))}),t.dropzone_obj[c].on("success",function(e,a){a.data.id?(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,a.data.album_id=t.album_id,a.data.group_id=t.group_id,a.data.saved=!1,t.dropzone_media[c].push(a.data),t.addMediaIdsToForumsForm(o)):(jQuery(".forum-media-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button" id="bp-media-create-folder-close" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.dropzone_obj[c].on("removedfile",function(e){if(!0===bp.Nouveau.Media.reply_topic_allow_delete_media){if(t.dropzone_media[c].length){for(var i in t.dropzone_media[c])if(e.upload.uuid==t.dropzone_media[c][i].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===t.dropzone_media[c][i].saved||t.dropzone_media[c][i].saved||"edit"!==bp.Nouveau.Media.reply_topic_display_post||t.removeAttachment(t.dropzone_media[c][i].id),t.dropzone_media[c].splice(i,1),t.addMediaIdsToForumsForm(o);break}}if(!_.isNull(t.dropzone_obj[c].files)&&0===t.dropzone_obj[c].files.length){var d=a.closest("form");d.find("#forums-document-button")&&d.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-video-button")&&d.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-gif-button")&&d.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-media-button")&&d.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("no-click")}}!_.isNull(t.dropzone_obj[c].files)&&0===t.dropzone_obj[c].files.length&&a.closest("form").removeClass("has-media")}),t.dropzone_obj[c].on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0&&a.closest("form").removeClass("media-uploading")}),o.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?n=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?n=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(n=this.bbp_forum_edit_media),n.length)){for(var p=!1,m=0;m<n.length;m++)p=!1,t.dropzone_media[c].push({id:n[m].attachment_id,media_id:n[m].id,name:n[m].title,thumb:n[m].thumb,url:n[m].full,uuid:n[m].id,menu_order:m,saved:!0}),p={name:n[m].title,accepted:!0,kind:"image",upload:{filename:n[m].title,uuid:n[m].id},dataURL:n[m].url,id:n[m].id},t.dropzone_obj[c].files.push(p),t.dropzone_obj[c].emit("addedfile",p),t.createThumbnailFromUrl(p,o);if(t.addMediaIdsToForumsForm(o),!_.isNull(t.dropzone_obj[c].files)&&0!==t.dropzone_obj[c].files.length){var u=a.closest("form");u.find("#forums-document-button")&&u.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-video-button")&&u.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-gif-button")&&u.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-media-button")&&u.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("no-click")}}}else t.resetForumsMediaComponent(c)}},openGroupMessagesUploader:function(e){var t=this,a=i("div#bp-group-messages-post-media-uploader"),o=i(e.currentTarget);e.preventDefault(),o.toggleClass("active"),void 0!==window.Dropzone&&a.length&&(a.hasClass("closed")?(t.dropzone_obj=new Dropzone("div#bp-group-messages-post-media-uploader",t.options),t.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var o=i("#send_group_message_form");o.find("#bp-group-messages-document-button")&&o.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-video-button")&&o.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-gif-button")&&o.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-media-button")&&o.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").addClass("no-click")}),t.dropzone_obj.on("uploadprogress",function(e){var t=i(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=a+" "+a,t.style.strokeDashoffset=a;var o=a-e.upload.progress.toFixed(0)/100*a;t.style.strokeDashoffset=o}),t.dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&i(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".group-media-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.dropzone_obj.on("success",function(e,a){a.data.id?(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,a.data.album_id=t.album_id,a.data.group_id=t.group_id,a.data.saved=!1,t.dropzone_media.push(a.data),t.addMediaIdsToGroupMessagesForm()):(jQuery(".group-message-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-message-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length){for(var a in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[a].uuid){void 0===t.dropzone_media[a].saved||t.dropzone_media[a].saved||t.removeAttachment(t.dropzone_media[a].id),t.dropzone_media.splice(a,1),t.addMediaIdsToGroupMessagesForm();break}}if(!_.isNull(t.dropzone_obj.files)&&0===t.dropzone_obj.files.length){var o=i("#send_group_message_form");o.find("#bp-group-messages-document-button")&&o.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-video-button")&&o.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-gif-button")&&o.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-media-button")&&o.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").removeClass("no-click")}}),a.removeClass("closed").addClass("open"),t.resetGroupMessagesGifComponent(),t.resetGroupMessagesDocumentComponent(),t.resetGroupMessagesVideoComponent()):t.resetGroupMessagesMediaComponent())},openGroupMessagesDocumentUploader:function(e){var t=this,a=i("div#bp-group-messages-post-document-uploader"),o=i(e.currentTarget);e.preventDefault(),o.toggleClass("active"),void 0!==window.Dropzone&&a.length&&(a.hasClass("closed")?(t.document_dropzone_obj=new Dropzone("div#bp-group-messages-post-document-uploader",t.documentOptions),t.document_dropzone_obj.on("addedfile",function(){}),t.document_dropzone_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var o=i("#send_group_message_form");o.find("#bp-group-messages-media-button")&&o.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-video-button")&&o.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-gif-button")&&o.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-document-button")&&o.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").addClass("no-click")}),t.document_dropzone_obj.on("uploadprogress",function(e){var t=i(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=a+" "+a,t.style.strokeDashoffset=a;var o=a-e.upload.progress.toFixed(0)/100*a;t.style.strokeDashoffset=o}),t.document_dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&i(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".group-document-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.document_dropzone_obj.on("accept",function(e,i){0==e.size?i(BP_Nouveau.media.empty_document_type):i()}),t.document_dropzone_obj.on("success",function(e,a){if(a.data.id){e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,a.data.folder_id=t.current_folder,a.data.group_id=t.current_group_id,a.data.saved=!1,t.dropzone_media.push(a.data),t.addDocumentIdsToGroupMessagesForm();var o=e.upload.filename,d=o.substr(o.lastIndexOf(".")+1),s=_.isUndefined(a.data.svg_icon)?"":a.data.svg_icon,n=_.isEmpty(s)?"bb-icon-file-"+d:s;i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(n)}else{var r,l,c,p,m,u=a.data.feedback;for(e.previewElement.classList.add("dz-error"),p=e.previewElement.querySelectorAll("[data-dz-errormessage]"),m=[],l=0,c=p.length;l<c;l++)r=p[l],m.push(r.textContent=u);return m}}),t.document_dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length){for(var a in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[a].uuid){void 0===t.dropzone_media[a].saved||t.dropzone_media[a].saved||t.removeAttachment(t.dropzone_media[a].id),t.dropzone_media.splice(a,1),t.addDocumentIdsToGroupMessagesForm();break}}if(!_.isNull(t.document_dropzone_obj.files)&&0===t.document_dropzone_obj.files.length){var o=i("#send_group_message_form");o.find("#bp-group-messages-media-button")&&o.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-video-button")&&o.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-gif-button")&&o.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-document-button")&&o.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").removeClass("no-click")}}),a.removeClass("closed").addClass("open"),t.resetGroupMessagesGifComponent(),t.resetGroupMessagesMediaComponent(),t.resetGroupMessagesVideoComponent()):t.resetGroupMessagesDocumentComponent())},openGroupMessagesVideoUploader:function(e){var t=this,a=i("div#bp-group-messages-post-video-uploader"),o=i(e.currentTarget);e.preventDefault(),o.toggleClass("active"),void 0!==window.Dropzone&&a.length&&(a.hasClass("closed")?(t.video_dropzone_obj=new Dropzone("div#bp-group-messages-post-video-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,t,a){a.append("action","video_upload"),a.append("_wpnonce",BP_Nouveau.nonces.video);var o=i("#send_group_message_form");o.find("#bp-group-messages-document-button")&&o.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-gif-button")&&o.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-media-button")&&o.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#bp-group-messages-video-button")&&o.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("no-click")}),t.video_dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&i(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(i("body").append('<div id="bp-video-create-album" style="display: block;" class="open-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-video-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.video_dropzone_obj.on("accept",function(e,i){0==e.size?i(BP_Nouveau.video.empty_video_type):i()}),t.video_dropzone_obj.on("addedfile",function(e){e.dataURL||bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),t.video_dropzone_obj.on("uploadprogress",function(e){var t=i(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=a+" "+a;var o=a-e.upload.progress.toFixed(0)/100*a;e.upload.progress<=99?(i(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),t.style.strokeDashoffset=o):100===e.upload.progress&&(t.style.strokeDashoffset=a-.99*a,i(e.previewElement).find(".dz-progress-count").text("99% "+BP_Nouveau.video.i18n_strings.video_uploaded_text))}),t.video_dropzone_obj.on("success",function(e,a){if(100===e.upload.progress&&(i(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,i(e.previewElement).find(".dz-progress-count").text("100% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),i(e.previewElement).closest(".dz-preview").addClass("dz-complete")),a.data.id)e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,a.data.album_id=t.album_id,a.data.group_id=t.group_id,a.data.js_preview=i(e.previewElement).find(".dz-video-thumbnail img").attr("src"),a.data.saved=!1,t.dropzone_media.push(a.data),t.addVideoIdsToGroupMessagesForm();else{var o,d,s,n,r,l=a.data.feedback;for(e.previewElement.classList.add("dz-error"),n=e.previewElement.querySelectorAll("[data-dz-errormessage]"),r=[],d=0,s=n.length;d<s;d++)o=n[d],r.push(o.textContent=l);return r}}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length){for(var a in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[a].uuid){void 0===t.dropzone_media[a].saved||t.dropzone_media[a].saved||t.removeAttachment(t.dropzone_media[a].id),t.dropzone_media.splice(a,1),t.addVideoIdsToGroupMessagesForm();break}}if(!_.isNull(t.video_dropzone_obj.files)&&0===t.video_dropzone_obj.files.length){var o=i("#send_group_message_form");o.find("#bp-group-messages-document-button")&&o.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-gif-button")&&o.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-media-button")&&o.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find("#bp-group-messages-video-button")&&o.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").removeClass("no-click")}}),a.removeClass("closed").addClass("open"),t.resetGroupMessagesMediaComponent(),t.resetGroupMessagesGifComponent(),t.resetGroupMessagesDocumentComponent()):t.resetGroupMessagesVideoComponent())},openForumsDocumentUploader:function(e){var t=this,a=i(e.currentTarget),o=a.closest("form").find("#forums-post-document-uploader"),d=a.closest("form").find("#forums-post-media-uploader"),s=a.closest("form").find("#forums-post-video-uploader"),n=[];e.preventDefault(),a.toggleClass("active");var r=d.data("key"),l=s.data("key");if(t.resetForumsMediaComponent(r),t.resetForumsVideoComponent(l),void 0!==window.Dropzone&&o.length){var c=o.data("key");if(o.hasClass("closed")){if(t.dropzone_obj[c]=new Dropzone(o[0],t.documentOptions),t.dropzone_media[c]=[],t.dropzone_obj[c].on("addedfile",function(){}),t.dropzone_obj[c].on("sending",function(e,i,t){t.append("action","document_document_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media);var o=a.closest("form");o.addClass("has-media"),o.find("#forums-media-button")&&o.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-gif-button")&&o.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-video-button")&&o.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-document-button")&&o.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("no-click")}),t.dropzone_obj[c].on("uploadprogress",function(e){a.closest("form").addClass("media-uploading");var t=i(e.previewElement).find(".dz-progress-ring circle")[0],o=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=o+" "+o,t.style.strokeDashoffset=o;var d=o-e.upload.progress.toFixed(0)/100*o;t.style.strokeDashoffset=d}),t.dropzone_obj[c].on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&i(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".forum-document-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e),a.closest("form").removeClass("media-uploading"))}),t.dropzone_obj[c].on("accept",function(e,i){0==e.size?i(BP_Nouveau.media.empty_document_type):i()}),t.dropzone_obj[c].on("success",function(e,a){if(a.data.id){e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,a.data.folder_id=t.current_folder,a.data.group_id=t.current_group_id,a.data.saved=!1,t.dropzone_media[c].push(a.data),t.addDocumentIdsToForumsForm(o);var d=e.upload.filename,s=d.substr(d.lastIndexOf(".")+1),n=_.isUndefined(a.data.svg_icon)?"":a.data.svg_icon,r=_.isEmpty(n)?"bb-icon-file-"+s:n;i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(r)}else{var l,p,m,u,b,f=a.data.feedback;for(e.previewElement.classList.add("dz-error"),u=e.previewElement.querySelectorAll("[data-dz-errormessage]"),b=[],p=0,m=u.length;p<m;p++)l=u[p],b.push(l.textContent=f);return b}}),t.dropzone_obj[c].on("removedfile",function(e){if(!0===bp.Nouveau.Media.reply_topic_allow_delete_media){if(t.dropzone_media[c].length){for(var i in t.dropzone_media[c])if(e.upload.uuid==t.dropzone_media[c][i].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===t.dropzone_media[c][i].saved||t.dropzone_media[c][i].saved||"edit"!==bp.Nouveau.Media.reply_topic_display_post||t.removeAttachment(t.dropzone_media[c][i].id),t.dropzone_media[c].splice(i,1),t.addDocumentIdsToForumsForm(o);break}}if(!_.isNull(t.dropzone_obj[c].files)&&0===t.dropzone_obj[c].files.length){var d=a.closest("form");d.find("#forums-media-button")&&d.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-video-button")&&d.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-gif-button")&&d.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-document-button")&&d.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("no-click")}}!_.isNull(t.dropzone_obj[c].files)&&0===t.dropzone_obj[c].files.length&&a.closest("form").removeClass("has-media")}),t.dropzone_obj[c].on("complete",function(e){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0&&a.closest("form").removeClass("media-uploading");var t=_.isUndefined(e.name)?"":e.name,o=t.substr(t.lastIndexOf(".")+1),d=_.isUndefined(e.svg_icon)?"":e.svg_icon,s=_.isEmpty(d)?"bb-icon-file-"+o:d;i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").hasClass("bb-icon-file")&&i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(s)}),o.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&(this.bbp_reply_edit_document.length?n=this.bbp_reply_edit_document:this.bbp_topic_edit_document.length?n=this.bbp_topic_edit_document:this.bbp_forum_edit_document.length&&(n=this.bbp_forum_edit_document),n.length)){for(var p=!1,m=0;m<n.length;m++)p=!1,t.dropzone_media[c].push({id:n[m].attachment_id,document_id:n[m].id,name:n[m].name,type:"document",title:n[m].name,size:n[m].size,url:n[m].url,uuid:n[m].id,menu_order:m,saved:!0}),p={name:n[m].name,size:n[m].size,accepted:!0,kind:"document",upload:{name:n[m].name,filename:n[m].name,title:n[m].name,size:n[m].size,uuid:n[m].id},dataURL:n[m].url,id:n[m].id},t.dropzone_obj[c].files.push(p),t.dropzone_obj[c].emit("addedfile",p),t.dropzone_obj[c].emit("complete",p);if(t.addDocumentIdsToForumsForm(o),!_.isNull(t.dropzone_obj[c].files)&&0!==t.dropzone_obj[c].files.length){var u=a.closest("form");u.find("#forums-media-button")&&u.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-video-button")&&u.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-gif-button")&&u.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-document-button")&&u.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("no-click")}}}else t.resetForumsDocumentComponent(c)}},openForumsVideoUploader:function(e){var t=this,a=i(e.currentTarget),o=a.closest("form").find("#forums-post-video-uploader"),d=a.closest("form").find("#forums-post-media-uploader"),s=a.closest("form").find("#forums-post-document-uploader"),n=[];e.preventDefault(),a.toggleClass("active");var r=d.data("key"),l=s.data("key");if(t.resetForumsMediaComponent(r),t.resetForumsDocumentComponent(l),void 0!==window.Dropzone&&o.length){var c=o.data("key");if(o.hasClass("closed")){if(t.dropzone_obj[c]=new Dropzone(o[0],t.videoOptions),t.dropzone_media[c]=[],t.dropzone_obj[c].on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video);var o=a.closest("form");o.addClass("has-media"),o.find("#forums-media-button")&&o.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-gif-button")&&o.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-document-button")&&o.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find("#forums-video-button")&&o.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("no-click")}),t.dropzone_obj[c].on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&i(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".forum-video-error-popup").length||i("body").append('<div id="bp-video-create-album" style="display: block;" class="open-popup forum-video-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-video-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e),a.closest("form").removeClass("media-uploading"))}),t.dropzone_obj[c].on("accept",function(e,i){0==e.size?i(BP_Nouveau.video.empty_video_type):i()}),t.dropzone_obj[c].on("addedfile",function(e){e.dataURL&&e.dataThumb&&e.dataThumb.length?i(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.dataThumb+' " />'):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),t.dropzone_obj[c].on("uploadprogress",function(e){a.closest("form").addClass("media-uploading");var t=i(e.previewElement).find(".dz-progress-ring circle")[0],o=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=o+" "+o;var d=o-e.upload.progress.toFixed(0)/100*o;e.upload.progress<=99?(i(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),t.style.strokeDashoffset=d):100===e.upload.progress&&(t.style.strokeDashoffset=o-.99*o,i(e.previewElement).find(".dz-progress-count").text("99% "+BP_Nouveau.video.i18n_strings.video_uploaded_text))}),t.dropzone_obj[c].on("success",function(e,a){if(100===e.upload.progress&&(i(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,i(e.previewElement).find(".dz-progress-count").text("100% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),i(e.previewElement).closest(".dz-preview").addClass("dz-complete")),a.data.id)e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,a.data.album_id=t.album_id,a.data.group_id=t.group_id,a.data.js_preview=i(e.previewElement).find(".dz-video-thumbnail img").attr("src"),a.data.saved=!1,t.dropzone_media[c].push(a.data),t.addVideoIdsToForumsForm(o);else{var d,s,n,r,l,p=a.data.feedback;for(e.previewElement.classList.add("dz-error"),r=e.previewElement.querySelectorAll("[data-dz-errormessage]"),l=[],s=0,n=r.length;s<n;s++)d=r[s],l.push(d.textContent=p);return l}}),t.dropzone_obj[c].on("removedfile",function(e){if(!0===bp.Nouveau.Media.reply_topic_allow_delete_media){if(t.dropzone_media[c].length){for(var i in t.dropzone_media[c])if(e.upload.uuid==t.dropzone_media[c][i].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===t.dropzone_media[c][i].saved||t.dropzone_media[c][i].saved||"edit"!==bp.Nouveau.Media.reply_topic_display_post||t.removeAttachment(t.dropzone_media[c][i].id),t.dropzone_media[c].splice(i,1),t.addVideoIdsToForumsForm(o);break}}if(!_.isNull(t.dropzone_obj[c].files)&&0===t.dropzone_obj[c].files.length){var d=a.closest("form");d.find("#forums-media-button")&&d.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-gif-button")&&d.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-document-button")&&d.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find("#forums-video-button")&&d.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("no-click")}}!_.isNull(t.dropzone_obj[c].files)&&0===t.dropzone_obj[c].files.length&&a.closest("form").removeClass("has-media")}),t.dropzone_obj[c].on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0&&a.closest("form").removeClass("media-uploading")}),o.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_video.length||this.bbp_topic_edit_video.length||this.bbp_forum_edit_video.length)&&(this.bbp_reply_edit_video.length?n=this.bbp_reply_edit_video:this.bbp_topic_edit_video.length?n=this.bbp_topic_edit_video:this.bbp_forum_edit_video.length&&(n=this.bbp_forum_edit_video),n.length)){for(var p=!1,m=0;m<n.length;m++)p=!1,t.dropzone_media[c].push({id:n[m].attachment_id,video_id:n[m].id,name:n[m].name,type:"video",title:n[m].name,size:n[m].size,url:n[m].url,uuid:n[m].id,thumb:n[m].thumb,menu_order:m,saved:!0}),p={name:n[m].name,size:n[m].size,accepted:!0,kind:"video",upload:{name:n[m].name,title:n[m].name,size:n[m].size,uuid:n[m].id},dataURL:n[m].url,dataThumb:n[m].thumb,id:n[m].id},t.dropzone_obj[c].files.push(p),t.dropzone_obj[c].emit("addedfile",p),t.dropzone_obj[c].emit("complete",p);if(t.addVideoIdsToForumsForm(o),!_.isNull(t.dropzone_obj[c].files)&&0!==t.dropzone_obj[c].files.length){var u=a.closest("form");u.find("#forums-media-button")&&u.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-gif-button")&&u.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-document-button")&&u.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),u.find("#forums-video-button")&&u.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("no-click")}}}else t.resetForumsVideoComponent(c)}},addMediaIdsToForumsForm:function(e){var i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_media").length&&e.closest("#whats-new-attachments").find("#bbp_media").val(JSON.stringify(this.dropzone_media[i]))},addDocumentIdsToForumsForm:function(e){var i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_document").length&&e.closest("#whats-new-attachments").find("#bbp_document").val(JSON.stringify(this.dropzone_media[i]))},addVideoIdsToForumsForm:function(e){var i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_video").length&&e.closest("#whats-new-attachments").find("#bbp_video").val(JSON.stringify(this.dropzone_media[i]))},createThumbnailFromUrl:function(e,i){var t=this,a=i.data("key");t.dropzone_obj[a].createThumbnailFromUrl(e,t.dropzone_obj[a].options.thumbnailWidth,t.dropzone_obj[a].options.thumbnailHeight,t.dropzone_obj[a].options.thumbnailMethod,!0,function(i){t.dropzone_obj[a].emit("thumbnail",e,i),t.dropzone_obj[a].emit("complete",e)})},openUploader:function(e){var t,a,o=this;if(e.preventDefault(),void 0!==window.Dropzone&&i("div#media-uploader").length){i("#bp-media-uploader").addClass("open-popup").show(),i(e.currentTarget).closest("#bp-media-single-album").length&&i("#bb-media-privacy").hide(),i("#bp-media-uploader").find(".bb-field-steps.bb-field-steps-2").length&&(0!==Number(i(t="#bp-media-uploader.bp-media-photo-uploader").find(".bb-album-selected-id").data("value"))?(a=i(t).find(".bb-album-selected-id").data("value"),i(t).find("#bb-document-privacy").prop("disabled",!0)):a=0,""!==this.moveToIdPopup&&i.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){i(document).find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-media").html(e.data.first_span_text),""===e.data.html?(i(document).find(".open-popup .location-album-list-wrap").hide(),i(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()):(i(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide(),i(document).find(".open-popup .location-album-list-wrap").show()),!1===e.data.create_album?(i(document).find(".open-popup .bp-media-open-create-popup-folder").removeClass("create-album"),i(document).find(".open-popup .bp-media-open-create-popup-folder").hide()):i(document).find(".open-popup .bp-media-open-create-popup-folder").addClass("create-album"),i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),i(document).find(".open-popup .bb-album-create-from").val("profile"),i(t).find(".location-album-list-wrap .location-album-list").remove(),i(t).find(".location-album-list-wrap").append(e.data.html),i(t).find('ul.location-album-list span[data-id="'+a+'"]').trigger("click"),i(t).find(".bb-album-selected-id").val(a)}})),i(document).on("click",t+" .location-album-list li span",function(e){if(e.preventDefault(),!i(this).parent().hasClass("is_active")){if(0!=i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),i(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+i(this).attr("id")+'">'+i(this).text()+"</span>"),i(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),a==i(e.currentTarget).data("id")?i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),!i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")){i(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val(i(e.currentTarget).data("id"));var t=i(e.currentTarget).closest("#bp-media-uploader").find("#bb-media-privacy");0!==Number(i(e.currentTarget).data("id"))?(t.find("option").removeAttr("selected"),t.val(i(e.currentTarget).parent().data("privacy")),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1))}}}),i(document).on("click",t+" .breadcrumb .item > span",function(e){if(!i(this).hasClass("is-disabled")){i(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val(0),i(e.currentTarget).closest(".bb-field-wrap").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),a==i(e.currentTarget).data("id")?i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled");var t=i(e.currentTarget).closest("#bp-media-uploader").find("#bb-media-privacy"),o=i(e.currentTarget).closest("#bp-media-uploader").find(".location-album-list li.is_active").data("privacy");0!==Number(i(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val())?(t.find("option").removeAttr("selected"),t.val(void 0===o?"public":o),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1))}});var d=document.getElementsByClassName("uploader-post-media-template").length?document.getElementsByClassName("uploader-post-media-template")[0].innerHTML:"";o.options.previewTemplate=d,o.dropzone_obj=new Dropzone("div#media-uploader",o.options),o.dropzone_obj.on("sending",function(e,i,t){t.append("action","media_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),o.dropzone_obj.on("uploadprogress",function(e){var t=i(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=a+" "+a,t.style.strokeDashoffset=a;var o=a-e.upload.progress.toFixed(0)/100*a;t.style.strokeDashoffset=o}),o.dropzone_obj.on("addedfile",function(){setTimeout(function(){o.dropzone_obj.getAcceptedFiles().length&&i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,o.dropzone_media.length,o.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),o.dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&i(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".media-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),o.dropzone_obj.on("queuecomplete",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),o.dropzone_obj.on("processing",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),o.dropzone_obj.on("success",function(e,t){t.data.id?(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=o.dropzone_media.length,t.data.album_id=o.album_id,t.data.group_id=o.group_id,t.data.saved=!1,o.dropzone_media.push(t.data)):(jQuery(".media-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),i(".bb-field-steps-1 #bp-media-photo-next, #bp-media-submit").show(),i(".modal-container").addClass("modal-container--alert"),i(".bb-field-steps-1").addClass("controls-added"),i("#bp-media-add-more").show(),i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,o.dropzone_media.length,o.dropzone_obj.getAcceptedFiles().length)).show()}),o.dropzone_obj.on("removedfile",function(e){if(o.dropzone_media.length){for(var t in o.dropzone_media)if(e.upload.uuid==o.dropzone_media[t].uuid){void 0===o.dropzone_media[t].saved||o.dropzone_media[t].saved||o.removeAttachment(o.dropzone_media[t].id),o.dropzone_media.splice(t,1);break}}o.dropzone_obj.getAcceptedFiles().length?i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,o.dropzone_media.length,o.dropzone_obj.getAcceptedFiles().length)).show():(i("#bp-media-uploader-modal-status-text").text(""),i("#bp-media-add-more, #bp-media-photo-next").hide(),i(".bb-field-steps-1").removeClass("controls-added"),i("#bp-media-submit").hide(),i(".modal-container").removeClass("modal-container--alert"))})}},openDocumentUploader:function(e){var t,a,o=this;if(e.preventDefault(),void 0!==window.Dropzone&&i("div#media-uploader").length){i("#bp-media-uploader").hasClass("bp-media-document-uploader")&&!this.currentTargetParent&&(this.currentTargetParent=0),i(e.currentTarget).closest("#bp-media-single-folder").length&&i("#bb-document-privacy").hide(),i(document).removeClass("open-popup"),i("#bp-media-uploader").show(),i("#bp-media-uploader").addClass("open-popup"),i("#bp-media-uploader.bp-media-document-uploader").find(".bb-field-steps.bb-field-steps-2").length&&(0!==Number(i(t="#bp-media-uploader.bp-media-document-uploader").find(".bb-folder-selected-id").data("value"))?(a=i(t).find(".bb-folder-selected-id").data("value"),i(t).find("#bb-document-privacy").prop("disabled",!0)):a=0,""!==this.moveToIdPopup&&i.ajax({url:BP_Nouveau.ajaxurl,type:"GET",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){i(document).find(".bp-media-document-uploader .location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(e.data.first_span_text),""===e.data.html?(i(document).find(".bp-media-document-uploader.open-popup .location-folder-list-wrap").hide(),i(document).find(".bp-media-document-uploader.open-popup .location-folder-list-wrap-main span.no-folder-exists").show()):(i(document).find(".bp-media-document-uploader.open-popup .location-folder-list-wrap-main span.no-folder-exists").hide(),i(document).find(".bp-media-document-uploader.open-popup .location-folder-list-wrap").show()),i(document).find(".bp-media-document-uploader .popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),i(document).find(".bp-media-document-uploader .open-popup .bb-folder-create-from").val("profile"),i(t).find(".location-folder-list-wrap .location-folder-list").remove(),i(t).find(".location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(t,a),i(t).find("ul.location-folder-list span#"+a).trigger("click"),i(t).find(".bb-folder-selected-id").val(a)}})),i(document).on("click",t+" .location-folder-list li span",function(e){if(e.preventDefault(),!i(this).parent().hasClass("is_active")){if(0!=i(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&i(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").remove(),i(this).closest(".location-folder-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+i(this).attr("id")+'">'+i(this).text()+"</span>"),i(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),a==i(e.currentTarget).data("id")?i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),!i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")){i(e.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val(i(e.currentTarget).data("id"));var t=i(e.currentTarget).closest("#bp-media-uploader").find("#bb-document-privacy");0!==Number(i(e.currentTarget).data("id"))?(t.find("option").removeAttr("selected"),t.val(i(e.currentTarget).parent().data("privacy")),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1))}}}),i(document).on("click",t+" .breadcrumb .item > span",function(e){if(!i(this).hasClass("is-disabled")){i(e.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val(i(e.currentTarget).data("id")),i(e.currentTarget).closest(".bb-field-wrap").find(".location-folder-list li span").removeClass("selected").parent().removeClass("is_active"),i(e.currentTarget).closest(".bb-field-wrap").find('.location-folder-list li[data-id="'+i(e.currentTarget).data("id")+'"]').addClass("is_active"),i(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&i(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").remove(),a==i(e.currentTarget).data("id")?i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled");var t=i(e.currentTarget).closest("#bp-media-uploader").find("#bb-document-privacy"),o=i(e.currentTarget).closest("#bp-media-uploader").find(".location-folder-list li.is_active").data("privacy");0!==Number(i(e.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val())?(t.find("option").removeAttr("selected"),t.val(void 0===o?"public":o),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1))}});var d=document.getElementsByClassName("uploader-post-document-template").length?document.getElementsByClassName("uploader-post-document-template")[0].innerHTML:"";o.options.previewTemplate=d,o.dropzone_obj=new Dropzone("div#media-uploader",o.options),o.dropzone_obj.on("sending",function(e,i,t){t.append("action","document_document_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),o.dropzone_obj.on("uploadprogress",function(e){var t=i(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=a+" "+a,t.style.strokeDashoffset=a;var o=a-e.upload.progress.toFixed(0)/100*a;t.style.strokeDashoffset=o}),o.dropzone_obj.on("addedfile",function(){setTimeout(function(){o.dropzone_obj.getAcceptedFiles().length&&i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,o.dropzone_media.length,o.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),o.dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&i(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".document-error-popup").length||i("body").append('<div id="bp-media-create-album" style="display: block;" class="open-popup document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),o.dropzone_obj.on("accept",function(e,i){0==e.size?i(BP_Nouveau.media.empty_document_type):i()}),o.dropzone_obj.on("queuecomplete",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),o.dropzone_obj.on("processing",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),o.dropzone_obj.on("success",function(e,t){if(t.data.id){e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=o.dropzone_media.length,t.data.folder_id=o.current_folder,t.data.group_id=o.current_group_id,t.data.saved=!1,o.dropzone_media.push(t.data);var a=e.upload.filename,d=a.substr(a.lastIndexOf(".")+1),s=_.isUndefined(t.data.svg_icon)?"":t.data.svg_icon,n=_.isEmpty(s)?"bb-icon-file-"+d:s;i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&i(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(n)}else{var r,l,c,p,m,u=t.data.feedback;for(e.previewElement.classList.add("dz-error"),p=e.previewElement.querySelectorAll("[data-dz-errormessage]"),m=[],l=0,c=p.length;l<c;l++)r=p[l],m.push(r.textContent=u);return m}i(".bb-field-steps-1 #bp-media-document-next, #bp-media-document-submit").show(),i(".modal-container").addClass("modal-container--alert"),i(".bb-field-steps-1").addClass("controls-added"),i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,o.dropzone_media.length,o.dropzone_obj.getAcceptedFiles().length)).show()}),o.dropzone_obj.on("removedfile",function(e){if(o.dropzone_media.length){for(var t in o.dropzone_media)if(e.upload.uuid==o.dropzone_media[t].uuid){void 0===o.dropzone_media[t].saved||o.dropzone_media[t].saved||o.removeAttachment(o.dropzone_media[t].id),o.dropzone_media.splice(t,1);break}}o.dropzone_obj.getAcceptedFiles().length?i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,o.dropzone_media.length,o.dropzone_obj.getAcceptedFiles().length)).show():(i("#bp-media-uploader-modal-status-text").text(""),i("#bp-media-document-submit").hide(),i(".modal-container").removeClass("modal-container--alert"))})}},openMediaMove:function(e){e.preventDefault(),this.moveToIdPopup=i(e.currentTarget).attr("id"),this.moveToTypePopup=i(e.currentTarget).attr("data-type"),i(e.currentTarget).closest(".activity-inner").length>0?t=i(e.currentTarget).closest(".activity-inner"):i(e.currentTarget).closest("#media-stream.media").length>0?t=i(e.currentTarget).closest("#media-stream.media"):i(e.currentTarget).closest(".comment-item").length>0&&(t=i(e.currentTarget).closest(".comment-item")),i(t).find(".bp-media-move-file").addClass("open").show(),o=i(e.currentTarget).closest(".media-action-wrap").siblings("a").data("id"),a=i(e.currentTarget).closest(".media-action-wrap").siblings("a").data("album-id"),t.find(".bp-media-move").attr("id",o),t.find(".bb-model-footer .bp-media-move").addClass("is-disabled"),d=i(e.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li.comment-item").length?"#"+i(e.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bp-media-move-file":"#"+i(e.currentTarget).closest("li.activity-item").attr("id")+" > .activity-content .bp-media-move-file",i(d).find(".bp-document-move").attr("id",i(e.currentTarget).closest(".document-activity").attr("data-id")),i(e.currentTarget).closest(".media-list").length>0&&(d=".bp-media-move-file"),"group"===this.moveToTypePopup?i(document).find(".location-album-list-wrap h4").show():i(document).find(".location-album-list-wrap h4").hide(),i(d).addClass("open-popup"),i(d).find(".location-album-list-wrap .location-album-list").remove(),i(d).find(".location-album-list-wrap").append('<ul class="location-album-list is-loading"><li><i class="bb-icon-l bb-icon-spinner animate-spin"></i></li></ul>');var t,a,o,d,s=a,n=this.moveToTypePopup;""!==this.moveToIdPopup&&i.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){i(document).find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-media").html(e.data.first_span_text),""===e.data.html?(i(document).find(".open-popup .location-album-list-wrap").hide(),i(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()):(i(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide(),i(document).find(".open-popup .location-album-list-wrap").show()),"group"===n?(i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide(),i(document).find(".open-popup .bb-album-create-from").val("group")):(i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),i(document).find(".open-popup .bb-album-create-from").val("profile")),!1===e.data.create_album?(i(d+".open-popup").find(".bp-media-open-create-popup-folder").removeClass("create-album"),i(d+".open-popup").find(".bp-media-open-create-popup-folder").hide()):(i(d+".open-popup").find(".bp-media-open-create-popup-folder").addClass("create-album"),i(d+".open-popup").find(".bp-media-open-create-popup-folder").show()),i(d).find(".location-album-list-wrap .location-album-list").remove(),i(d).find(".location-album-list-wrap").append(e.data.html),i(d).find("ul.location-album-list span#"+s).trigger("click")}}),i(document).on("click",d+" .location-album-list li span",function(e){if(e.preventDefault(),!i(this).parent().hasClass("is_active")){0!=i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),i(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+i(this).attr("id")+'">'+i(this).text()+"</span>"),i(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected");var a=i(document).find('a.bb-open-media-theatre[data-id="'+t.find(".bp-media-move").attr("id")+'"]').data("album-id");Number(a)==Number(i(e.currentTarget).data("id"))?i(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):i(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),!i(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")&&i(e.currentTarget).closest(".bp-media-move-file").find(".bb-album-selected-id").val(i(e.currentTarget).data("id"))}}),i(document).on("click",d+" .breadcrumb .item > span",function(e){!i(this).hasClass("is-disabled")&&(i(e.currentTarget).closest(".bp-media-move-file").find(".bb-album-selected-id").val(0),i(e.currentTarget).closest(".bp-media-move-file").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),s==i(e.currentTarget).data("id")?i(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):i(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"))})},openDocumentMove:function(e){e.preventDefault();var t,a=i(e.currentTarget).closest(".bb-activity-media-elem").find(".document-title").text();this.moveToIdPopup=i(e.currentTarget).attr("id"),this.moveToTypePopup=i(e.currentTarget).attr("data-type");var o=i(e.currentTarget).attr("data-action");t=i(e.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li.comment-item").length?"#"+i(e.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bp-media-move-file":"#"+i(e.currentTarget).closest("li.activity-item").attr("id")+" > .activity-content .bp-media-move-file",i(t).find(".bp-document-move").attr("id",i(e.currentTarget).closest(".document-activity").attr("data-id")),this.currentTargetParent=i(e.currentTarget).closest(".bb-activity-media-elem").attr("data-parent-id"),i(e.currentTarget).closest(".media-folder_items").length>0&&(a=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_name").text(),this.currentTargetParent=i(e.currentTarget).closest(".media-folder_items").attr("data-parent-id"),i(e.currentTarget).hasClass("ac-document-move")?i(t=".bp-media-move-file").find(".bp-document-move").attr("id",i(e.currentTarget).closest(".media-folder_items").attr("data-id")):i(t=".bp-media-move-folder").find(".bp-folder-move").attr("id",i(e.currentTarget).closest(".media-folder_items").attr("data-id"))),i(t).find(".location-folder-list-wrap .location-folder-list").remove(),i(t).find(".location-folder-list-wrap").append('<ul class="location-folder-list is-loading"><li><i class="bb-icon-l bb-icon-spinner animate-spin"></i></li></ul>'),"document"===o?i(t).find(".bb-model-header h4 .target_name").text(BP_Nouveau.media.move_to_file):i(t).find(".bb-model-header h4 .target_name").text(BP_Nouveau.media.move_to_folder),i(t).show(),i(t).addClass("open-popup"),"group"===this.moveToTypePopup?(i(document).find(".location-folder-list-wrap h4").show(),i(t).addClass("move-folder-popup-group")):(i(document).find(".location-folder-list-wrap h4").hide(),i(".move-folder-popup-group").removeClass("move-folder-popup-group"));var d=this.currentTargetParent,s=this.moveToTypePopup;""!==this.moveToIdPopup&&i.ajax({url:BP_Nouveau.ajaxurl,type:"GET",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){i(document).find(".location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(e.data.first_span_text),""===e.data.html?(i(document).find(".open-popup .location-folder-list-wrap").hide(),i(document).find(".open-popup .location-folder-list-wrap-main span.no-folder-exists").show()):(i(document).find(".open-popup .location-folder-list-wrap-main span.no-folder-exists").hide(),i(document).find(".open-popup .location-folder-list-wrap").show()),"group"===s?(i(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide(),i(document).find(".open-popup .bb-folder-create-from").val("group")):(i(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").show(),i(document).find(".open-popup .bb-folder-create-from").val("profile")),i(t).find(".location-folder-list-wrap .location-folder-list").remove(),i(t).find(".location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&(bp.Nouveau.Media.folderLocationUI(t,d),i(t).find("ul.location-folder-list span#"+d).trigger("click"))}})},closeMediaMove:function(e){e.preventDefault(),0!=i(e.currentTarget).closest(".bp-media-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").data("id")&&i(e.currentTarget).closest(".bp-media-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").remove(),i(e.currentTarget).closest(".bp-media-move-file").hide()},closeDocumentMove:function(e){e.preventDefault();var t=jQuery(e.currentTarget).closest(".has-folderlocationUI");i(e.currentTarget).hasClass("ac-document-close-button")?i(e.currentTarget).closest(".bp-media-move-file").hide().find(".bp-document-move").attr("id",""):i(e.currentTarget).closest(".bp-media-move-folder").hide().find(".bp-folder-move").attr("id",""),t.find(".bp-document-move.loading").removeClass("loading"),this.clearFolderLocationUI(e)},renameDocument:function(e){var t=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_name"),a=t.children("span").text();t.hide().siblings(".media-folder_name_edit_wrap").show().children(".media-folder_name_edit").val(a).focus().select(),e.preventDefault()},editPrivacyDocument:function(e){e.preventDefault(),i(e.currentTarget).closest("#media-folder-document-data-table").find(".media-folder_visibility .media-folder_details__bottom span").show().siblings("select").addClass("hide");var t=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_visibility");t.find(".media-folder_details__bottom span").hide().siblings("select").removeClass("hide"),t.find(".media-folder_details__bottom span").hide().siblings("select").val(i(e.currentTarget).attr("data-privacy")),t.find(".media-folder_details__bottom #bb-folder-privacy").attr("data-privacy",i(e.currentTarget).attr("data-privacy")),this.privacySelectorSelect=t.find(".media-folder_details__bottom span").hide().siblings("select"),this.privacySelectorSpan=t.find(".media-folder_details__bottom span")},editPrivacyDocumentSubmit:function(e){var t=i(e.currentTarget);"true"==t.attr("data-mouseup")?(t.attr("data-mouseup","false"),t.addClass("hide").siblings("span").show().text(t.find("option:selected").text())):t.attr("data-mouseup","true")},renameDocumentSubmit:function(e){var t=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_name_edit"),a=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > span"),o=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_name"),d=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-id").attr("data-item-id"),s=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-attachment-id").attr("data-item-id"),n=i(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-type").attr("data-item-id"),r=t.val().trim(),l="";i(e.currentTarget).closest(".ac-document-list").length?l=/[?\[\]=<>:;,'"&$#*()|~`!{}%+ \/]+/g:i(e.currentTarget).closest(".ac-folder-list").length&&(l=/[\\/?%*:|"<>]+/g);var c=Boolean(l.exec(r));if(c?t.addClass("error"):t.removeClass("error"),i(e.currentTarget).closest(".ac-document-list").length&&(-1!=r.indexOf("\\\\")||c?t.addClass("error"):t.removeClass("error")),(i(e.currentTarget).hasClass("name_edit_cancel")||27==e.keyCode)&&(t.removeClass("error"),t.parent().hide().siblings(".media-folder_name").show()),i(e.currentTarget).hasClass("name_edit_save")||13==e.keyCode){if(c)return;t.parent().addClass("submitting").append('<i class="animate-spin bb-icon-l bb-icon-spinner"></i>'),i.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"document_update_file_name",document_id:d,attachment_document_id:s,document_type:n,name:r,_wpnonce:BP_Nouveau.nonces.media},success:function(d){d.success?void 0!==d.data.document&&0<i(d.data.document).length?i(e.currentTarget).closest(".media-folder_items").html(i(d.data.document).html()):(o.attr("data-document-title",d.data.response.title+"."+o.data("extension")),a.html(d.data.response.title),t.removeClass("submitting"),t.parent().find(".animate-spin").remove(),t.parent().hide().siblings(".media-folder_name").show()):(t.removeClass("submitting"),t.parent().find(".animate-spin").remove(),t.parent().hide().siblings(".media-folder_name").show(),alert(d.data.feedback.replace("&#039;","'")))}})}e.preventDefault()},removeAttachment:function(e){var t={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:e};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t})},beforeunloadWindow:function(){i("body.messages").length>0&&i.each(Dropzone.instances,function(e,i){i.removeAllFiles(!0)})},changeUploadModalTab:function(e){e.preventDefault();var t=i(e.currentTarget).data("content"),a=i(e.currentTarget).closest("#bp-media-uploader");i(".bp-media-upload-tab-content").hide(),i("#"+t).show(),this.current_tab=t,a.find(".bp-media-upload-tab").removeClass("selected"),i(e.currentTarget).addClass("selected"),this.toggleSubmitMediaButton(),a.find(".bb-field-steps-2").slideUp(200),a.find("#bb-media-privacy").hide(),a.find(".bp-media-open-create-popup-folder").hide(),"bp-dropzone-content"===t&&(a.find(".bb-field-steps-1").show(),a.find("#bb-media-privacy").show(),a.find(".bp-media-open-create-popup-folder, .bp-document-open-create-popup-folder, #bb-media-privacy").hide()),"bp-existing-media-content"===t&&a.find(".bb-field-uploader-actions").hide(),jQuery(window).scroll()},openCreateAlbumModal:function(e){e.preventDefault(),this.openUploader(e),i("#bp-media-create-album").show(),i("body").hasClass("directory")&&i("#bp-media-uploader").hide()},openCreateFolderModal:function(e){e.preventDefault(),i("#bp-media-create-folder").show(),i("#bp-media-create-folder").addClass("open-popup"),i(document).find(".open-popup #boss-media-create-album-popup #bb-album-title").show(),i(document).find(".open-popup #boss-media-create-album-popup #bb-album-title").removeClass("error")},openCreateFolderChildModal:function(e){e.preventDefault(),i("#bp-media-create-child-folder").show(),i("#bp-media-create-child-folder").addClass("open-popup"),i(document).find(".open-popup #boss-media-create-album-popup #bb-album-child-title").show(),i(document).find(".open-popup #boss-media-create-album-popup #bb-album-child-title").removeClass("error")},openEditFolderChildModal:function(e){e.preventDefault();var t=BP_Nouveau.media.current_user_id,a=BP_Nouveau.media.current_group_id,o=BP_Nouveau.media.current_type,d=0;"group"===o?(d=a,i(document).find(".location-folder-list-wrap h4").show()):(d=t,i(document).find(".location-folder-list-wrap h4").hide()),i.ajax({url:BP_Nouveau.ajaxurl,type:"GET",data:{action:"document_get_folder_view",id:d,type:o},success:function(t){i(document).find(".location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(t.data.first_span_text),i(".location-folder-list-wrap .location-folder-list").remove(),i(".location-folder-list-wrap").append(t.data.html),bp.Nouveau.Media.folderLocationUI&&(bp.Nouveau.Media.folderLocationUI("#bp-media-edit-child-folder",BP_Nouveau.media.current_folder),i(e.currentTarget).closest("#bp-media-single-folder").find("ul.location-folder-list span#"+BP_Nouveau.media.current_folder).trigger("click")),"group"===o?(i(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide(),i(document).find(".open-popup .bb-folder-create-from").val("group")):(i(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").show(),i(document).find(".open-popup .bb-folder-create-from").val("profile"))}}),i("#bp-media-edit-child-folder").show()},folderLocationUI:function(e,t){if(i(e).find(".bb-folder-destination").length>0){i(e).find(".location-folder-list-wrap").hasClass("is_loaded")||(i(document).on("click",e+" .bb-folder-destination",function(){i(this).parent().find(".location-folder-list-wrap").slideToggle()}),i(e).find(".location-folder-list-wrap").addClass("is_loaded"),i(document).on("click",e+" .location-folder-list span",function(){this.currentTargetParent=i(this).attr("id");var a=i(this),o=i('<div class="item"></div>');a.parents("li").each(function(e,t){var a=i(t).children("span").clone();o.prepend("",a)}),i(e).find(".breadcrumbs-append-ul-li .breadcrumb").html(o.prepend('<span data-id="0">'+BP_Nouveau.media.target_text+"</span>")),i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").length||i(e).find(".breadcrumbs-append-ul-li .breadcrumb").find(".item").append('<span class="hidden"></span>'),i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(t){t>0&&i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>i(e).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||i('<span class="more_options">...</span>').insertAfter(i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),i(this).hasClass("selected")&&!i(this).hasClass("disabled")?(i(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(""),i(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val("0"),i(e).find(".location-folder-list li.is_active").length?i(e).find(".bb-folder-selected-id").val(i(e).find(".location-folder-list li.is_active").attr("data-id")):i(e).find(".bb-folder-selected-id").val("0")):(i(this).closest(".location-folder-list-wrap-main").find(".location-folder-list li span").removeClass("selected"),i(this).addClass("selected"),i(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(i(this).text()),i(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val(i(this).parent().attr("data-id"))),i(this).closest(".location-folder-list-wrap").find(".location-folder-title").text(i(this).siblings("span").text()).siblings(".location-folder-back").css("display","inline-block"),i(this).siblings("ul").show().siblings("span, i").hide().parent().siblings().hide(),i(this).siblings("ul").children("li").show().children("span,i").show(),i(this).closest(".is_active").removeClass("is_active"),i(e).find("li.is_active").removeClass("is_active"),i(this).parent().addClass("is_active"),i(e).find(".bb-folder-selected-id").val(i(e).find(".location-folder-list li.is_active").attr("data-id")),i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span").each(function(){i(this).show()}),t===i(e).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("data-id")&&(i(e).hasClass("bp-media-move-file")||i(e).hasClass("bp-media-move-folder"))?(i(e).find(".bp-document-move").addClass("is-disabled"),i(e).find(".bp-folder-move").addClass("is-disabled")):(i(e).find(".bp-document-move").removeClass("is-disabled"),i(e).find(".bp-folder-move").removeClass("is-disabled")),setTimeout(function(){var a=0;a=i(e).find(".breadcrumbs-append-ul-li .item > span:last-child").hasClass("hidden")?i(e).find(".breadcrumbs-append-ul-li .item > span:last-child").prev().attr("id"):i(e).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("id"),t===a&&(i(e).hasClass("bp-media-move-file")||i(e).hasClass("bp-media-move-folder"))?(i(e).find(".bp-document-move").addClass("is-disabled"),i(e).find(".bp-folder-move").addClass("is-disabled")):(i(e).find(".bp-document-move").removeClass("is-disabled"),i(e).find(".bp-folder-move").removeClass("is-disabled"))},100)}),i(document).on("click",e+" .breadcrumbs-append-ul-li .item span",function(a){if(!(i(this).parent().hasClass("is-disabled")||i(this).hasClass("more_options"))){var o=i(a.currentTarget).attr("data-id");i(e).find(".location-folder-list-wrap").find(".location-folder-title").text(i(e).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block"),i(e).find(".bb-folder-selected-id").val(o),i(e).find(".location-folder-list li").hide(),i(e).find(".location-folder-list li.is_active").removeClass("is_active"),i(e).find(".location-folder-list li > span.selected").removeClass("selected"),i(e).find('.location-folder-list li[data-id="'+o+'"]').addClass("is_active").children("span").addClass("selected"),i(e).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide(),i(e).find(".location-folder-list li.is_active").children("ul").length&&!i(e).find(".location-folder-list li.is_active").children("ul").hasClass("no-folder-list")?setTimeout(function(){i(e).find(".location-folder-list li.is_active").show().children("ul").show().children("li").show().children("span,i").show().closest("ul").siblings("span, i").hide()},100):i(e).find(".location-folder-list li.is_active").hasClass("has-ul").length?i(e).find(".location-folder-list li.is_active").children("span,i").hide().parent().children("ul").show().children("li").show():setTimeout(function(){i(e).find(".location-folder-list li.is_active").show().children("span").show().parent().siblings("li").show().children("span,i").show()},10),"0"===o&&(i(e).find(".location-folder-list").children("li").show().children("span,i").show(),i(e).find(".location-folder-list-wrap").find(".location-folder-title").text(BP_Nouveau.media.target_text),i(e).find(".location-folder-back").hide()),i(a.currentTarget).nextAll().remove(),t===i(e).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("data-id")&&(i(e).hasClass("bp-media-move-file")||i(e).hasClass("bp-media-move-folder"))?(i(e).find(".bp-document-move").addClass("is-disabled"),i(e).find(".bp-folder-move").addClass("is-disabled")):(i(e).find(".bp-document-move").removeClass("is-disabled"),i(e).find(".bp-folder-move").removeClass("is-disabled"));var d=i(e).find(".location-folder-list .is_active > span"),s=i('<div class="item"></div>');d.parents("li").each(function(e,t){var a=i(t).children("span").clone();s.prepend("",a)}),i(e).find(".breadcrumbs-append-ul-li .breadcrumb").html(s.prepend('<span data-id="0">'+BP_Nouveau.media.target_text+"</span>")),0===i(e).find('.breadcrumbs-append-ul-li .breadcrumb .item > span[data-id="'+o+'"]').length&&i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item").append(i(e).find('.location-folder-list li[data-id="'+o+'"]').children("span").clone()),i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").length||i(e).find(".breadcrumbs-append-ul-li .breadcrumb").find(".item").append('<span class="hidden"></span>'),i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(t){t>0&&i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>i(e).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||i('<span class="more_options">...</span>').insertAfter(i(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),i(e).find(".bb-folder-selected-id").val(o)}})),i(e).find(".location-folder-list li").each(function(){i(this).children("ul").parent().addClass("has-ul").append('<i class="bb-icon-l bb-icon-angle-right sub-menu-anchor"></i>')}),i(e).hasClass("bp-media-move-folder")&&(i(e).find(".location-folder-list li>span").removeClass("is-disabled"),i(e).find('.location-folder-list li>span[id="'+i(e).find(".bp-folder-move").attr("id")+'"]').parent().addClass("is-disabled"));var a=i(e).find(".bp-folder-move").attr("id");0==i(e).find('.location-folder-list li[data-id="'+a+'"]').siblings().length&&i(e).find('.location-folder-list li[data-id="'+a+'"]').parent("ul").addClass("no-folder-list a"),t&&(i(e).find(".location-folder-list li").hide(),i(e).find(".location-folder-list li.is_active").removeClass("is_active"),i(e).find('.location-folder-list li[data-id="'+t+'"]').addClass("is_active"),i(e).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide(),i(e).find(".location-folder-list li.is_active").children("ul").length&&!i(e).find(".location-folder-list li.is_active").children("ul").hasClass("no-folder-list")?setTimeout(function(){i(e).find(".location-folder-list li.is_active").show().children("ul").show().children("li").show().children("span,i").show().closest("ul").siblings("span, i").hide()},100):i(e).find(".location-folder-list li.is_active").hasClass("has-ul").length?i(e).find(".location-folder-list li.is_active").children("span,i").hide().parent().children("ul").show().children("li").show():setTimeout(function(){i(e).find(".location-folder-list li.is_active").show().children("span").show().parent().siblings("li").show().children("span,i").show()},10),i(e).find(".location-folder-list-wrap").find(".location-folder-title").text(i(e).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block"),i(e).find(".bb-folder-selected-id").val(i(e).find(".location-folder-list li.is_active").attr("data-id")),i(e).find('.location-folder-list li[data-id="'+a+'"]').children().hide()),"0"===t&&(i(e).find(".location-folder-list").children("li").show(),i(e).find(".location-folder-list-wrap").find(".location-folder-title").text(BP_Nouveau.media.target_text),i(e).find(".location-folder-back").hide()),setTimeout(function(){var a=0;a=i(e).find(".breadcrumbs-append-ul-li .item > span:last-child").hasClass("hidden")?i(e).find(".breadcrumbs-append-ul-li .item > span:last-child").prev().attr("id"):i(e).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("id"),t===a&&(i(e).hasClass("bp-media-move-file")||i(e).hasClass("bp-media-move-folder"))?(i(e).find(".bp-document-move").addClass("is-disabled"),i(e).find(".bp-folder-move").addClass("is-disabled")):(i(e).find(".bp-document-move").removeClass("is-disabled"),i(e).find(".bp-folder-move").removeClass("is-disabled"))},100);var o=i(e).find(".location-folder-list .is_active > span"),d=i('<div class="item"></div>');o.parents("li").each(function(e,t){var a=i(t).children("span").clone();d.prepend("",a)}),i(e).find(".breadcrumbs-append-ul-li .breadcrumb").html(d.prepend('<span data-id="0">'+BP_Nouveau.media.target_text+"</span>"))}},clearFolderLocationUI:function(e){var i=jQuery(e.currentTarget).closest(".has-folderlocationUI");i.length>0&&(i.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),i.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),i.find(".location-folder-title").text(BP_Nouveau.media.target_text),i.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0"),i.find(".ac_document_search_folder").val(""),i.find(".bb-model-header h4 span").text("..."),i.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show())},closeCreateAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),i("#bp-media-create-album").hide(),i("#bb-album-title").val("").removeClass("error")},closeCreateFolderModal:function(e){e.preventDefault(),i("#bp-media-create-folder, #bp-media-create-child-folder").hide(),i("#bb-album-title, #bb-album-child-title").val(""),i("#bp-media-create-child-folder-submit").removeClass("loading")},closeEditFolderModal:function(e){e.preventDefault();var t=i(e.currentTarget).closest("#bp-media-edit-child-folder");i("#bp-media-edit-child-folder").hide(),t.find(".bb-field-steps-1").show().siblings(".bb-field-steps").hide(),this.clearFolderLocationUI(e)},closeErrorPopup:function(e){e.preventDefault(),i(e.currentTarget).closest(".open-popup").remove()},submitMedia:function(e){var t,a=this,o=i(e.currentTarget),d=i("#bb-media-privacy");if(e.preventDefault(),o.hasClass("saving"))return!1;if(o.addClass("saving"),"bp-dropzone-content"===a.current_tab){var s=i("#bp-media-post-content").val(),n=i(e.currentTarget).closest(".open-popup"),r=n.find(".bb-album-selected-id").val();if(r.length&&parseInt(r)>0)for(var l=0;l<a.dropzone_media.length;l++)a.dropzone_media[l].album_id=r;else r=a.album_id;t={action:"media_save",_wpnonce:BP_Nouveau.nonces.media,medias:a.dropzone_media,content:s,album_id:r,group_id:a.group_id,privacy:d.val()},i("#bp-dropzone-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){if(t.success){if(i("#media-stream ul.media-list").length||i("#media-stream").html(i("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),i(".bb-photos-actions").length>0&&i(".bb-photos-actions").show(),bp.Nouveau.inject("#media-stream ul.media-list",t.data.media,"prepend"),t.data.media_personal_count){if(i("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").length)i("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(t.data.media_personal_count);else{var d=document.createElement("span");d.setAttribute("class","count");var s=document.createTextNode(t.data.media_personal_count);d.appendChild(s),i("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a").append(d)}}if(t.data.media_group_count){if(i("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").length)i("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(t.data.media_group_count);else{var r=document.createElement("span");r.setAttribute("class","count");var l=document.createTextNode(t.data.media_group_count);r.appendChild(l),i("#buddypress").find(".bp-wrap .users-nav ul li#photos-groups-li a").append(r)}}"yes"===BP_Nouveau.media.is_media_directory&&(i("#buddypress").find(".media-type-navs ul.media-nav li#media-all a span.count").text(t.data.media_all_count),i("#buddypress").find(".media-type-navs ul.media-nav li#media-personal a span.count").text(t.data.media_personal_count),i("#buddypress").find(".media-type-navs ul.media-nav li#media-groups a span.count").text(t.data.media_group_count));for(var c=0;c<a.dropzone_media.length;c++)a.dropzone_media[c].saved=!0;n.find(".bb-album-selected-id").val(0),a.closeUploader(e),jQuery(window).scroll()}else i("#bp-dropzone-content").prepend(t.data.feedback);o.removeClass("saving")}})}else if("bp-existing-media-content"===a.current_tab){var c=[];i('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){c.push(i(this).val())}),t={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:c,album_id:a.album_id,group_id:a.group_id},i("#bp-existing-media-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){t.success?(i("#media-stream ul.media-list").length||i("#media-stream").html(i("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),i(".bb-photos-actions").length>0&&i(".bb-photos-actions").show(),bp.Nouveau.inject("#media-stream ul.media-list",t.data.media,"prepend"),i('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){parseInt(i(this).closest("li").data("id"))===parseInt(i(this).val())&&i(this).closest("li").remove()}),jQuery(window).scroll(),a.closeUploader(e)):i("#bp-existing-media-content").prepend(t.data.feedback),o.removeClass("saving")}})}else a.current_tab||(a.closeUploader(e),o.removeClass("saving"))},submitDocumentMedia:function(e){var t,a=this,o=i(e.currentTarget),d=i(e.currentTarget).closest("#bp-media-uploader");if(e.preventDefault(),o.hasClass("saving"))return!1;if(o.addClass("saving"),"bp-dropzone-content"===a.current_tab){var s=i("#bp-media-post-content").val(),n=i("#bb-document-privacy").val(),r=i(e.currentTarget).closest(".open-popup"),l=r.find(".bb-folder-selected-id").val(),c=r.find(".bb-folder-selected-id").data("value"),p=!0;if(l.length&&parseInt(l)>0){void 0!==c&&parseInt(l)!==parseInt(c)&&(p=!1);for(var m=0;m<a.dropzone_media.length;m++)a.dropzone_media[m].folder_id=l}else l=a.album_id;t={action:"document_document_save",_wpnonce:BP_Nouveau.nonces.media,documents:a.dropzone_media,content:s,privacy:n,folder_id:a.current_folder,group_id:a.current_group_id},i("#bp-dropzone-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){if(t.success){(i("#media-stream div#media-folder-document-data-table").length||(i("#media-stream").html(i("<div></div>").addClass("display")),i("#media-stream div").attr("id","media-folder-document-data-table"),i(".bb-photos-actions").show()),i(".document-data-table-head").length)?"yes"===BP_Nouveau.media.is_document_directory&&"groups"===bp.Nouveau.getStorage("bp-document").scope?(i(document).find("li#document-personal a").trigger("click"),i(document).find("li#document-personal").trigger("click")):p&&bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",t.data.document,"prepend"):location.reload(!0),i("#bp-media-post-content").val("");for(var s=0;s<a.dropzone_media.length;s++)a.dropzone_media[s].saved=!0;a.closeUploader(e),i(document).removeClass("open-popup"),jQuery(window).scroll()}else i(document).removeClass("open-popup"),i("#bp-dropzone-content").prepend(t.data.feedback);o.removeClass("saving"),d.find("#bp-media-document-submit").hide()}})}else a.current_tab||(a.closeUploader(e),o.removeClass("saving"))},saveAlbum:function(e){var t=i(e.currentTarget),a=this,o=i("#bb-album-title"),d=i("#bb-album-privacy");if(t.hasClass("saving"))return!1;if(e.preventDefault(),""===i.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===i.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.addClass("saving"),t.attr("disabled",!0);var s={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),medias:a.dropzone_media,privacy:d.val()};a.album_id&&(s.album_id=a.album_id),a.group_id&&(s.group_id=a.group_id),i("#bp-media-single-album .bp-feedback").remove(),i("#boss-media-create-album-popup .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(s){setTimeout(function(){t.removeClass("saving"),t.prop("disabled",!1)},500),s.success?a.album_id?(i("#bp-single-album-title").text(o.val()),i("#bb-album-privacy").val(d.val()),a.cancelEditAlbumTitle(e)):(i("#buddypress .bb-albums-list").prepend(s.data.album),window.location.href=s.data.redirect_url):a.album_id?i("#bp-media-single-album").prepend(s.data.feedback):i("#boss-media-create-album-popup .bb-model-header").after(s.data.feedback)}})},saveFolder:function(e){var t=i(e.currentTarget),a=this,o=i("#bb-album-title"),d=i(e.currentTarget).parents().find(".open-popup #bb-folder-privacy option:selected");e.preventDefault();var s=Boolean(/[\\/?%*:|"<>]+/g.exec(o.val()));if(""===i.trim(o.val())||s)return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===i.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.prop("disabled",!0).addClass("loading");var n={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val().trim(),privacy:d.val(),album_id:a.current_folder,group_id:a.current_group_id};i(".bb-single-album-header .bp-feedback").remove(),i("#boss-media-create-album-popup .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(o){(setTimeout(function(){t.prop("disabled",!1)},500),o.success)?(a.closeFolderUploader(e),i(".document-data-table-head").length)?"yes"===BP_Nouveau.media.is_document_directory&&"groups"===bp.Nouveau.getStorage("bp-document").scope?(i(document).find("li#document-personal a").trigger("click"),i(document).find("li#document-personal").trigger("click")):(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",o.data.document,"prepend"),jQuery(window).scroll()):location.reload(!0):alert(o.data.feedback.replace("&#039;","'"))}})},saveChildFolder:function(e){var t=i(e.currentTarget),a=this,o=i("#bp-media-create-child-folder #bb-album-child-title");e.preventDefault();var d=Boolean(/[\\/?%*:|"<>]+/g.exec(o.val()));if(""===i.trim(o.val())||d)return o.addClass("error"),!1;o.removeClass("error"),t.prop("disabled",!0).addClass("loading");var s={action:"document_child_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),folder_id:a.current_folder,group_id:a.current_group_id};i(".bb-single-album-header .bp-feedback").remove(),i("#boss-media-create-album-popup .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(i){i.success?(a.closeChildFolderUploader(e),location.reload(!0)):alert(i.data.feedback.replace("&#039;","'"))}})},renameChildFolder:function(e){e.preventDefault();var t=i(e.currentTarget),a=this,o=i("#bp-media-edit-child-folder #bb-album-child-title"),d=i("#bp-media-edit-child-folder #bb-folder-privacy"),s=this.currentTargetParent,n=Boolean(/[\\/?%*:|"<>]+/g.exec(o.val()));if(""===i.trim(o.val())||n)return o.addClass("error"),!1;o.removeClass("error"),t.prop("disabled",!0).addClass("loading");var r={action:"document_edit_folder",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),privacy:d.val(),id:s,group_id:a.current_group_id};i(".bb-single-album-header .bp-feedback").remove(),i("#boss-media-create-album-popup .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:r,success:function(e){setTimeout(function(){t.prop("disabled",!1)},500),e.success?window.location.reload(!0):a.current_folder?i("#bp-media-single-album").prepend(e.data.feedback):i("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},deleteAlbum:function(e){if(e.preventDefault(),!this.album_id||!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm))return!1;i(e.currentTarget).prop("disabled",!0);var t={action:"media_album_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){t.success?window.location.href=t.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.album_delete_error),i(e.currentTarget).prop("disabled",!1))}})},deleteFolder:function(e){if(e.preventDefault(),!BP_Nouveau.media.current_folder||!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm))return!1;i(e.currentTarget).prop("disabled",!0);var t={action:"document_folder_delete",_wpnonce:BP_Nouveau.nonces.media,folder_id:BP_Nouveau.media.current_folder,group_id:BP_Nouveau.media.current_group_id};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){t.success?window.location.href=t.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.folder_delete_error),i(e.currentTarget).prop("disabled",!1))}})},addMediaIdsToGroupMessagesForm:function(){i("#bp_group_messages_media").length&&i("#bp_group_messages_media").val(JSON.stringify(this.dropzone_media))},addDocumentIdsToGroupMessagesForm:function(){i("#bp_group_messages_document").length&&i("#bp_group_messages_document").val(JSON.stringify(this.dropzone_media))},addVideoIdsToGroupMessagesForm:function(){i("#bp_group_messages_video").length&&i("#bp_group_messages_video").val(JSON.stringify(this.dropzone_media))},injectMedias:function(e){var t=bp.Nouveau.getStorage("bp-media"),a=t.scope||null,o=t.filter||null;if(i(e.currentTarget).hasClass("load-more")){var d=1*Number(this.current_page)+1,s=this,n="";e.preventDefault(),i(e.currentTarget).find("a").first().addClass("loading"),i("#buddypress .dir-search input[type=search]").length&&(n=i("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:a,filter:o,search_terms:n,page:d,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(t){!0===t.success&&(i(e.currentTarget).remove(),s.current_page=d,jQuery(window).scroll())})}},injectDocuments:function(e){var t=bp.Nouveau.getStorage("bp-document"),a="",o="",d=t.scope||null,s=t.filter||null,n=i(e.currentTarget);if(n.hasClass("load-more")){var r,l=1*Number(this.current_page)+1,c=this,p="";e.preventDefault(),n.find("a").first().addClass("loading"),i("#buddypress .dir-search input[type=search]").length&&(p=i("#buddypress .dir-search input[type=search]").val()),this.order_by&&this.sort_by?(a=this.sort_by,o=this.order_by):void 0!==t.extras?(a=t.extras.sort,o=t.extras.orderby):(a="ASC",o="title"),r={object:"document",scope:d,filter:s,search_terms:p,page:l,method:"append",target:"#buddypress [data-bp-list] div#media-folder-document-data-table",order_by:o,sort:a},bp.Nouveau.objectRequest(r).done(function(e){!0===e.success&&(n.parent(".pager").remove(),c.current_page=l,jQuery(window).scroll())})}},sortDocuments:function(e){var t=i(e.currentTarget),a=t.data("target"),o="",d="date_created",s="";switch(t.attr("class"),a){case"name":d="title";break;case"modified":d="date_modified";break;case"visibility":d="privacy";break;case"group":d="group_id"}t.hasClass("asce")?t.removeClass("asce"):t.addClass("asce");var s=t.hasClass("asce")?"DESC":"ASC";bp.Nouveau.getStorage("bp-document");var n={};n.orderby=d,n.sort=s,"group"!==d&&bp.Nouveau.setStorage("bp-document","extras",n);var r=bp.Nouveau.getStorage("bp-document"),l=r.scope||null,c=r.filter||null;i(e.currentTarget),i("#buddypress .bp-dir-search-form input[type=search]").length&&(o=i("#buddypress .bp-dir-search-form input[type=search]").val()),this.sort_by=s,this.order_by=d,this.current_page=1,bp.Nouveau.objectRequest({object:"document",scope:l,filter:c,search_terms:o,page:1,order_by:d,sort:s,method:"reset",target:"#buddypress [data-bp-list]"}).done()},documentPopupNavigate:function(e){e.preventDefault();var t=i(e.currentTarget),a=t.closest(".bb-field-steps"),o=0==t.closest(".bp-document-listing").length?"#bb-album-child-title":"#bb-album-title";if(t.closest(".document-options").length&&(o="#bb-album-title"),t.hasClass("bb-field-steps-next")&&""==a.find(o).val().trim()){a.find(o).addClass("error");return}a.find(o).removeClass("error"),a.slideUp(200).siblings(".bb-field-steps").slideDown(200)},uploadDocumentNavigate:function(e){e.preventDefault();var t=i(e.currentTarget),a=i(t).closest("#bp-media-uploader");i(t).hasClass("bb-field-uploader-next")?(a.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),a.find("#bp-media-document-submit, #bp-media-document-prev, .bp-document-open-create-popup-folder, #bb-document-privacy").show(),0!==Number(i(a).find(".bb-folder-selected-id"))&&i(a).find(".location-folder-list li.is_active").length&&i(a).find(".location-folder-list").scrollTop(i(a).find(".location-folder-list li.is_active").offset().top-i(a).find(".location-folder-list").offset().top),i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){e>0&&i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>i(a).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||i('<span class="more_options">...</span>').insertAfter(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))})):(i(t).hide(),a.find("#bp-media-document-prev, .bp-document-open-create-popup-folder").hide(),a.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),a.closest("#bp-media-single-folder").length&&i("#bb-document-privacy").hide())},uploadMediaNavigate:function(e){e.preventDefault();var t=i(e.currentTarget),a=i(t).closest(".bp-media-photo-uploader");i(t).hasClass("bb-field-uploader-next")?(a.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),a.find("#bp-media-submit, #bp-media-prev, .bp-media-open-create-popup-folder.create-album").show(),a.find("#bb-media-privacy").show(),0!==Number(i(a).find(".bb-album-selected-id"))&&i(a).find(".location-album-list li.is_active").length&&i(a).find(".location-album-list").scrollTop(i(a).find(".location-album-list li.is_active").offset().top-i(a).find(".location-album-list").offset().top)):(i(t).hide(),a.find("#bp-media-prev, .bp-media-open-create-popup-folder").hide(),a.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),a.closest("#bp-media-single-album").length&&i("#bb-media-privacy").hide())},appendMedia:function(e){var t=bp.Nouveau.getStorage("bp-media"),a=t.scope||null,o=t.filter||null;if(i(e.currentTarget).hasClass("load-more")){var d=1*Number(this.current_page_existing_media)+1,s=this,n="";e.preventDefault(),i(e.currentTarget).find("a").first().addClass("loading"),i("#buddypress .dir-search input[type=search]").length&&(n=i("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:a,filter:o,search_terms:n,page:d,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(t){!0===t.success&&(i(e.currentTarget).remove(),s.current_page_existing_media=d,jQuery(window).scroll())})}},appendAlbums:function(e){var t=1*Number(this.current_page_albums)+1,a=this;e.preventDefault(),i(e.currentTarget).find("a").first().addClass("loading");var o={action:"media_albums_loader",_wpnonce:BP_Nouveau.nonces.media,page:t};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(o){!0===o.success&&(i(e.currentTarget).remove(),i("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){i("#albums-dir-list ul.bb-albums-list").append(o.data.albums),i(this).fadeIn(100)}),a.current_page_albums=t)}})},toggleSubmitMediaButton:function(){var e=i("#bp-media-submit"),t=i("#bp-media-add-more");"bp-dropzone-content"===this.current_tab?this.dropzone_obj.getAcceptedFiles().length?(e.show(),t.show()):(e.hide(),t.hide()):"bp-existing-media-content"===this.current_tab&&(i('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length?e.show():e.hide(),t.hide())},playVideo:function(e){e.preventDefault();var t=i(e.currentTarget).find("video").get(0),a=i(e.currentTarget).find(".gif-play-button");!0==t.paused?(t.play(),a.hide()):(t.pause(),a.show())},autoPlayGifVideos:function(){i(".gif-player").each(function(){var e=i(this).find("video").get(0),t=i(this).find(".gif-play-button");i(this).is(":in-viewport")?(e.play(),t.hide()):(e.pause(),t.show())})},fileActionButton:function(e){!(i(e.currentTarget).parent().hasClass("download_file")||i(e.currentTarget).parent().hasClass("copy_download_file_url")||i(e.currentTarget).parent().hasClass("redirect-activity-privacy-change"))&&(e.preventDefault(),i(e.currentTarget).closest(".media-folder_items").toggleClass("is-visible").siblings(".media-folder_items").removeClass("is-visible"))},copyDownloadLink:function(e){e.preventDefault();var t=e.currentTarget,a="document_copy_link";i("body").append('<textarea style="position:absolute;opacity:0;" id="'+a+'"></textarea>');var o=i(t).text();return i(t).text(BP_Nouveau.media.copy_to_clip_board_text),i("#"+a).val(i(t).attr("href")),i("#"+a).select(),document.execCommand("copy"),setTimeout(function(){i(t).text(o)},2e3),!1},fileActivityActionButton:function(e){e.preventDefault(),!i(e.currentTarget).parent().hasClass("copy_download_file_url")&&(i(e.currentTarget).closest(".bb-activity-media-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-media-elem").removeClass("is-visible"),i(e.currentTarget).closest(".bb-activity-media-elem").length<1&&i(e.currentTarget).closest(".bb-photo-thumb").toggleClass("is-visible").parent().siblings().find(".bb-photo-thumb").removeClass("is-visible").removeClass("is-visible"),"a"!=e.currentTarget.tagName.toLowerCase()||i(e.currentTarget).hasClass("document-action_more")||i(e.currentTarget).hasClass("media-action_more")||(i(e.currentTarget).closest(".bb-activity-media-elem").removeClass("is-visible"),i(e.currentTarget).closest(".bb-photo-thumb").removeClass("is-visible")))},toggleFileActivityActionButton:function(e){var t;if((e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||i(t).hasClass("document-action_more")||i(t).parent().hasClass("document-action_more")||i(t).hasClass("media-folder_action__anchor")||i(t).parent().hasClass("media-folder_action__anchor")||i(t).hasClass("media-action_more")||i(t).parent().hasClass("media-action_more")||i(t).hasClass("video-action_more")||i(t).parent().hasClass("video-action_more"))return e;i(".bb-activity-media-elem.is-visible").removeClass("is-visible"),i(".media-folder_items.is-visible").removeClass("is-visible"),i(".bb-photo-thumb.is-visible").removeClass("is-visible"),i(".bb-item-thumb.is-visible").removeClass("is-visible"),i(".bb-activity-video-elem.is-visible").removeClass("is-visible"),i(".video-action-wrap.item-action-wrap.is-visible").removeClass("is-visible")},toggleCodePreview:function(e){e.preventDefault(),i(e.currentTarget).closest(".document-activity").toggleClass("code-full-view")},documentCodeMirror:function(){i(".document-text:not(.loaded)").each(function(){var e=i(this),t=e.attr("data-extension"),a=e.attr("data-extension");("html"==t||"htm"==t)&&(a="text/html"),"js"==t?CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0}):CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),mode:a,lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0}),e.addClass("loaded"),e.parent().height()>150&&(e.closest(".document-text-wrap").addClass("is_large"),e.closest(".document-activity").addClass("is_large"))})},closePopup:function(e){27==e.keyCode&&(i(".bp-media-move-folder.open-popup .ac-folder-close-button:visible, .bp-media-move-file .ac-media-close-button:visible, .bp-media-move-folder.open-popup .close-create-popup-folder:visible,.bp-media-move-file.open-popup .ac-document-close-button:visible, .bp-media-move-file .close-create-popup-folder:visible, .bp-media-move-photo.open .close-create-popup-album:visible").trigger("click"),i("#bp-media-create-folder #bp-media-create-folder-close:visible, #bp-media-create-child-folder #bp-media-create-folder-close:visible").trigger("click"),i("#bp-media-uploader #bp-media-uploader-close:visible").trigger("click"),i("#bp-media-edit-child-folder #bp-media-edit-folder-close:visible").trigger("click"),i("#bp-media-create-album #bp-media-create-album-close:visible").trigger("click"),i(".media-folder_visibility select#bb-folder-privacy:not(.hide)").each(function(){i(this).attr("data-mouseup","false").addClass("hide").siblings("span").show().text(i(this).find("option:selected").text())}),i(".bp-video-thumbnail-uploader .bp-video-thumbnail-uploader-close:visible").trigger("click"),i(".bb-action-popup .bb-close-action-popup:visible").trigger("click"))},submitPopup:function(e){!(i(document).find(".modal-wrapper:visible").length<1)&&13==e.keyCode&&(i(".bp-media-move-folder.open-popup .bp-document-move:not(.is-disabled):visible, .bp-media-move-folder.open-popup  .bp-folder-move:not(.is-disabled):visible,.bp-media-move-file.open-popup .bp-document-move:not(.is-disabled):visible, .bp-media-move-file.open-popup .bp-document-create-popup-folder-submit:visible, .bp-media-move-folder.open-popup .bp-document-create-popup-folder-submit:visible, .bp-media-move-file.open .bp-media-move:not(.is-disabled):visible, .bp-media-move-file.open .bp-media-create-popup-album-submit:visible").trigger("click"),i("#bp-media-create-folder #bp-media-create-folder-submit:visible, #bp-media-create-child-folder #bp-media-create-child-folder-submit:visible").trigger("click"),i("#bp-media-uploader #bp-media-document-submit:visible, #bp-media-uploader #bp-media-submit:visible").trigger("click"),i("#bp-media-edit-child-folder #bp-media-edit-child-folder-submit:visible").trigger("click"),i("#bp-media-create-album #bp-media-create-album-submit:visible").trigger("click"))},updateAlbumNavCount:function(){if(!(i(".single-screen-navs.groups-nav").find("ul li#albums-groups-li").length<1)){var e=i(".single-screen-navs.groups-nav").find("ul li#albums-groups-li"),t=i(e).find("span.count").text();parseInt(t)>0?i(e).find("span.count").text(++t):i(e).find("a#albums").append('<span class="count">1</span>')}}},bp.Nouveau.Media.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.medias=[],this.documents=[],this.current_media=!1,this.current_document=!1,this.current_index=0,this.current_document_index=0,this.is_open_media=!1,this.is_open_document=!1,this.nextLink=i(".bb-next-media"),this.nextDocumentLink=i(".bb-next-document"),this.previousDocumentLink=i(".bb-prev-document"),this.previousLink=i(".bb-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,this.manage_media=void 0!==BP_Nouveau.media.can_manage_media&&BP_Nouveau.media.can_manage_media,this.manage_document=void 0!==BP_Nouveau.media.can_manage_document&&BP_Nouveau.media.can_manage_document},addListeners:function(){i(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this)),i(document).on("click",".bb-open-document-theatre",this.openDocumentTheatre.bind(this)),i(document).on("click",".document-detail-wrap-description-popup",this.openDocumentTheatre.bind(this)),i(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),i(document).on("click",".bb-close-document-theatre",this.closeDocumentTheatre.bind(this)),i(document).on("click",".bb-prev-media",this.previous.bind(this)),i(document).on("click",".bb-next-media",this.next.bind(this)),i(document).on("click",".bb-prev-document",this.previousDocument.bind(this)),i(document).on("click",".bb-next-document",this.nextDocument.bind(this)),i(document).on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this)),i(document).on("click","#bb-media-model-container .media-privacy>li",this.mediaPrivacyChange.bind(this)),i(document).on("click","#bb-media-model-container .document-privacy>li",this.documentPrivacyChange.bind(this)),i(document).on("click","#bb-media-model-container .bb-media-section span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),i(document).on("click","#bb-media-model-container .bb-document-section span.privacy",bp.Nouveau,this.toggleDocumentPrivacyDropdown.bind(this)),i(document).on("click",".bp-add-media-activity-description",this.openMediaActivityDescription.bind(this)),i(document).on("click","#bp-activity-description-new-reset",this.closeMediaActivityDescription.bind(this)),i(document).on("keyup",".bp-edit-media-activity-description #add-activity-description",this.MediaActivityDescriptionUpdate.bind(this)),i(document).on("click","#bp-activity-description-new-submit",this.submitMediaActivityDescription.bind(this)),i(document).click(this.togglePopupDropdown),document.addEventListener("keyup",this.checkPressedKeyDocuments.bind(this)),document.addEventListener("keyup",this.checkPressedKey.bind(this))},checkPressedKey:function(e){if(e=e||window.event,!this.is_open_media)return!1;var t=i(e.target).hasClass("ac-input")||"add-activity-description"===i(e.target).attr("id");switch(e.keyCode){case 27:this.closeTheatre(e);break;case 37:if(void 0===this.medias[this.current_index-1]||t)return!1;this.previous(e);break;case 39:if(void 0===this.medias[this.current_index+1]||t)return!1;this.next(e)}},checkPressedKeyDocuments:function(e){if(e=e||window.event,!this.is_open_document)return!1;var t=i(e.target).hasClass("ac-input")||"add-activity-description"===i(e.target).attr("id");switch(e.keyCode){case 27:this.closeDocumentTheatre(e);break;case 37:if(void 0===this.documents[this.current_document_index-1]||t)return!1;this.previousDocument(e);break;case 39:if(void 0===this.documents[this.current_document_index+1]||t)return!1;this.nextDocument(e)}},openTheatre:function(e){e.preventDefault();var t,a=i(e.currentTarget),o=this;if(a.closest("#bp-existing-media-content").length)return!1;o.setupGlobals(),o.setMedias(a),t=a.data("id"),o.setCurrentMedia(t),o.showMedia(),o.navigationCommands(),o.getParentActivityHtml(a),o.getMediasDescription(),i(".bb-media-model-wrapper.document").hide();var d=document.getElementById(i(".bb-media-model-wrapper.video video").attr("id"));d&&d.pause(),i(".bb-media-model-wrapper.video").hide(),i(".bb-media-model-wrapper.media").show(),o.is_open_media=!0},getParentActivityHtml:function(e){var t=i("#hidden_parent_id").val(),a=e.closest(".bb-media-model-wrapper").find("#bb-media-model-container .activity-list li.activity-item").data("bp-activity-id");if(parseInt(t)===parseInt(a)){var o=i('#bb-media-model-container [data-bp-activity-id="'+t+'"]');i('[data-bp-activity-id="'+t+'"] > .activity-state').html(i(o).find(".activity-state").html()),i('[data-bp-activity-id="'+t+'"] > .activity-meta').html(i(o).find(".activity-meta").html()),i('[data-bp-activity-id="'+t+'"] > .activity-comments').html(i(o).find(".activity-comments").html())}i("#hidden_parent_id").length&&i("#hidden_parent_id").remove()},getMediasDescription:function(){var e=this;i(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),!1!=e.activity_ajax&&e.activity_ajax.abort();var t=i('[data-bp-activity-id="'+e.current_media.activity_id+'"] .activity-comments');t.length&&(e.current_media.parent_activity_comments=!0,t.html("")),!0===e.current_media.parent_activity_comments&&i(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+e.current_media.activity_id+'" id="hidden_parent_id"/>'),e.activity_ajax=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_media_description",id:e.current_media.id,attachment_id:e.current_media.attachment_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success?(i(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),i(".bb-media-info-section:visible").show(),i(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},10)):i(".bb-media-info-section.media").hide()}})},openDocumentTheatre:function(e){e.preventDefault();var t,a=i(e.currentTarget),o=this;if(a.closest("#bp-existing-document-content").length)return!1;a.closest(".document.document-theatre").length&&o.closeDocumentTheatre(e),t=a.data("id"),o.setupGlobals(),o.setDocuments(a),o.setCurrentDocument(t),o.showDocument(),o.navigationDocumentCommands(),o.getParentActivityHtml(a),o.getDocumentsDescription(),-1!==i.inArray(o.current_document.extension,BP_Nouveau.document.mp3_preview_extension.split(","))&&i(e.currentTarget).closest(".bb-activity-media-elem.document-activity").length&&i(e.currentTarget).closest(".bb-activity-media-elem.document-activity").find(".document-audio-wrap").length&&i(e.currentTarget).closest(".bb-activity-media-elem.document-activity").find(".document-audio-wrap audio")[0].pause(),i(".bb-media-model-wrapper.media").hide(),i(".bb-media-model-wrapper.document").show();var d=document.getElementById(i(".bb-media-model-wrapper.video video").attr("id"));d&&(d.pause(),d.src=""),i(".bb-media-model-wrapper.video").hide(),o.is_open_document=!0},resetRemoveActivityCommentsData:function(){var e=!1,t=!1,a=!1,o=!1,d=!1,s=!1;this.current_media.parent_activity_comments&&((e=(o=i('.bb-media-model-wrapper.media [data-bp-activity-id="'+this.current_media.activity_id+'"]')).find(".activity-comments")).length&&(d=e.html(),s=e.attr("class"),e.remove(),(e=i('[data-bp-activity-id="'+this.current_media.activity_id+'"] .activity-comments')).length&&(e.html(d),e.attr("class",s),e.children("form").removeClass("events-initiated").hide())),(a=o.find(".activity-state")).length&&(d=a.html(),s=a.attr("class"),a.remove(),(a=i('[data-bp-activity-id="'+this.current_media.activity_id+'"] .activity-state')).length&&(a.html(d),a.attr("class",s))),(t=o.find(".activity-meta")).length&&(d=t.html(),s=t.attr("class"),t.remove(),(t=i('[data-bp-activity-id="'+this.current_media.activity_id+'"] > .activity-meta')).length&&(t.html(d),t.attr("class",s))),o.remove()),this.current_document.parent_activity_comments&&((e=(o=i('.bb-media-model-wrapper.document [data-bp-activity-id="'+this.current_document.activity_id+'"]')).find(".activity-comments")).length&&(d=e.html(),s=e.attr("class"),e.remove(),(e=i('[data-bp-activity-id="'+this.current_document.activity_id+'"] .activity-comments')).length&&(e.html(d),e.attr("class",s),e.children("form").removeClass("events-initiated").hide(),e.find(".document-text.loaded").removeClass("loaded").find(".CodeMirror").remove(),jQuery(window).scroll())),(a=o.find(".activity-state")).length&&(d=a.html(),s=a.attr("class"),a.remove(),(a=i('[data-bp-activity-id="'+this.current_document.activity_id+'"] .activity-state')).length&&(a.html(d),a.attr("class",s))),(t=o.find(".activity-meta")).length&&(d=t.html(),s=t.attr("class"),t.remove(),(t=i('[data-bp-activity-id="'+this.current_document.activity_id+'"] > .activity-meta')).length&&(t.html(d),t.attr("class",s))),o.remove()),bp.Nouveau.reportPopUp(),bp.Nouveau.reportActions()},closeTheatre:function(e){e.preventDefault();var t=this,a=i(e.currentTarget);if(i(a).closest(".bb-media-model-wrapper").hasClass("video-theatre"))return!1;i(".bb-media-model-wrapper.media .bb-media-section").find("img").attr("src",""),i(".bb-media-model-wrapper.video .bb-media-section").find("video").length&&videojs(i(".bb-media-model-wrapper.video .bb-media-section").find("video").attr("id")).reset(),i(".bb-media-model-wrapper").hide(),t.is_open_media=!1,t.resetRemoveActivityCommentsData(),t.current_media=!1,t.getParentActivityHtml(a)},closeDocumentTheatre:function(e){e.preventDefault();var t=this,a=i(document).find(".document-theatre");a.find(".bb-media-section").removeClass("bb-media-no-preview").find(".document-preview").html(""),i(".bb-media-info-section.document").show(),a.hide(),t.is_open_document=!1,t.resetRemoveActivityCommentsData(),t.current_document=!1,t.getParentActivityHtml(i(e.currentTarget))},setMedias:function(e){var t=i(".bb-open-media-theatre"),a=0,o=this;if(i("body").hasClass("activity")&&(t=i(e).closest(".bb-activity-media-wrap").find(".bb-open-media-theatre")),void 0!==t)for(a=0,o.medias=[];a<t.length;a++){var d=i(t[a]);if(!d.closest("#bp-existing-media-content").length){var s={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),attachment_id:d.data("attachment-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),can_edit:d.data("can-edit"),is_forum:!1};d.closest(".forums-media-wrap").length&&(s.is_forum=!0),void 0!==s.privacy&&"message"==s.privacy?s.is_message=!0:s.is_message=!1,o.medias.push(s)}}},setDocuments:function(e){var t=i(".bb-open-document-theatre"),a=0,o=this;if(i(e).closest(".bp-search-ac-header").length?t=i(e).closest(".bp-search-ac-header").find(".bb-open-document-theatre"):i("body").hasClass("activity")&&0===i(e).closest(".search-document-list").length&&(t=i(e).closest(".bb-activity-media-wrap").find(".bb-open-document-theatre")),void 0!==t)for(a=0,o.documents=[];a<t.length;a++){var d=i(t[a]);if(!t.closest("#bp-existing-document-content").length){var s={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),attachment_id:d.data("attachment-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),extension:d.data("extension"),target_text:d.data("document-title"),preview:d.data("preview"),full_preview:d.data("full-preview"),text_preview:d.data("text-preview"),mirror_text:d.data("mirror-text"),target_icon_class:d.data("icon-class"),author:d.data("author"),download:d.attr("href"),mp3:d.data("mp3-preview"),can_edit:d.data("can-edit"),video:d.attr("data-video-preview"),is_forum:!1};d.closest(".forums-media-wrap").length&&(s.is_forum=!0),void 0!==s.privacy&&"message"==s.privacy?s.is_message=!0:s.is_message=!1,o.documents.push(s)}}},setCurrentMedia:function(e){var i=this,t=0;for(t=0;t<i.medias.length;t++)if(e===i.medias[t].id){i.current_media=i.medias[t],i.current_index=t;break}},setCurrentDocument:function(e){var i=this,t=0;for(t=0;t<i.documents.length;t++)if(e===i.documents[t].id){i.current_document=i.documents[t],i.current_document_index=t;break}},showMedia:function(){if(void 0===this.current_media)return!1;i(".bb-media-model-wrapper.media .bb-media-section").find("img").attr("src",this.current_media.attachment);var e=i(".bb-media-section .bb-media-privacy-wrap");if(e.length){e.show(),e.find("ul.media-privacy li").removeClass("selected"),e.find(".bp-tooltip").attr("data-bp-tooltip","");var t=e.find("ul.media-privacy").find("li[data-value="+this.current_media.privacy+"]");t.addClass("selected"),e.find(".bp-tooltip").attr("data-bp-tooltip",t.text()),e.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(this.current_media.privacy),(void 0!==BP_Nouveau.activity&&void 0!==this.current_media.activity_id&&0!=this.current_media.activity_id||this.group_id||this.current_media.is_forum||this.current_media.group_id||this.current_media.album_id||this.current_media.is_message||!this.can_manage_media||!this.current_media.can_edit)&&e.hide()}this.navigationCommands()},showDocument:function(){if(void 0===this.current_document)return!1;var e=this.current_document.target_text,t=this.current_document.target_icon_class,a=i(document).find(".document-theatre"),o=this.current_document.extension,d=this.current_document.mirror_text;a.find(".bb-document-section").removeClass("bb-video-preview"),-1!==i.inArray(this.current_document.extension,["css","txt","js","html","htm","csv"])?(a.find(".bb-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html("<h3>"+e+'</h3><div class="document-text"><textarea class="document-text-file-data-hidden"></textarea></div>'),a.find(".bb-document-section .document-preview .document-text").attr("data-extension",o),a.find(".bb-document-section .document-preview .document-text textarea").html(d),setTimeout(function(){bp.Nouveau.Media.documentCodeMirror()},1e3)):-1!==i.inArray(this.current_document.extension,BP_Nouveau.document.mp3_preview_extension.split(","))?(a.find(".bb-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html('<div class="img-section"><h3>'+e+'</h3><div class="document-audio"><audio src="'+this.current_document.mp3+'" controls controlsList="nodownload"></audio></div></div>')):-1!==i.inArray("."+this.current_document.extension,BP_Nouveau.video.video_type.split(","))?(a.find(".bb-document-section").addClass("bb-video-preview"),a.find(".bb-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),"mov"===this.current_document.extension||"m4v"===this.current_document.extension?a.find(".bb-document-section .document-preview").html('<video playsinline id="video-'+this.current_document.id+'" class="video-js video-loading" controls  data-setup=\'{"aspectRatio": "16:9", "fluid": true,"playbackRates": [0.5, 1, 1.5, 2] }\' ><source src="'+this.current_document.video+'" type="video/mp4" ></source></video><span class="video-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i></span>'):a.find(".bb-document-section .document-preview").html('<video playsinline id="video-'+this.current_document.id+'" class="video-js video-loading" controls  data-setup=\'{"aspectRatio": "16:9", "fluid": true,"playbackRates": [0.5, 1, 1.5, 2] }\' ><source src="'+this.current_document.video+'" type="video/'+this.current_document.extension+'" ></source></video><span class="video-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i></span>'),i(window).scroll()):this.current_document.full_preview?(a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html("<h3>"+e+'</h3><div class="img-section"><div class="img-block-wrap"> <img src="'+this.current_document.full_preview+'" /></div></div>')):(a.find(".bb-document-section").addClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html('<div class="img-section"> <i class="'+t+'"></i><p>'+e+"</p></div>"));var s=i(".bb-document-section .bb-document-privacy-wrap");if(s.length){s.show(),s.parent().show(),s.find("ul.document-privacy li").removeClass("selected"),s.find(".bp-tooltip").attr("data-bp-tooltip","");var n=s.find("ul.document-privacy").find("li[data-value="+this.current_document.privacy+"]");n.addClass("selected"),s.find(".bp-tooltip").attr("data-bp-tooltip",n.text()),s.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(this.current_document.privacy),(void 0!==BP_Nouveau.activity&&void 0!==this.current_document.activity_id&&0!=this.current_document.activity_id||this.group_id||this.current_document.is_forum||this.current_document.group_id||this.current_document.album_id||!this.can_manage_document||!this.current_document.can_edit||this.current_document.is_message)&&s.parent().hide()}this.navigationDocumentCommands()},next:function(e){e.preventDefault();var i,t=this;t.resetRemoveActivityCommentsData(),void 0!==t.medias[t.current_index+1]?(t.current_index=t.current_index+1,i=t.current_media.activity_id,t.current_media=t.medias[t.current_index],t.showMedia(),t.getMediasDescription()):t.nextLink.hide()},previous:function(e){e.preventDefault();var i,t=this;t.resetRemoveActivityCommentsData(),void 0!==t.medias[t.current_index-1]?(t.current_index=t.current_index-1,i=t.current_media.activity_id,t.current_media=t.medias[t.current_index],t.showMedia(),t.getMediasDescription()):t.previousLink.hide()},nextDocument:function(e){e.preventDefault();var i,t=this;t.resetRemoveActivityCommentsData(),void 0!==t.documents[t.current_document_index+1]?(t.current_document_index=t.current_document_index+1,i=t.current_document.activity_id,t.current_document=t.documents[t.current_document_index],t.showDocument(),t.getDocumentsDescription()):t.nextDocumentLink.hide()},previousDocument:function(e){e.preventDefault();var i,t=this;t.resetRemoveActivityCommentsData(),void 0!==t.documents[t.current_document_index-1]?(t.current_document_index=t.current_document_index-1,i=t.current_document.activity_id,t.current_document=t.documents[t.current_document_index],t.showDocument(),t.getDocumentsDescription()):t.previousDocumentLink.hide()},navigationCommands:function(){0==this.current_index&&this.current_index!=this.medias.length-1?(this.previousLink.hide(),this.nextLink.show()):0==this.current_index&&this.current_index==this.medias.length-1?(this.previousLink.hide(),this.nextLink.hide()):this.current_index==this.medias.length-1?(this.previousLink.show(),this.nextLink.hide()):(this.previousLink.show(),this.nextLink.show())},navigationDocumentCommands:function(){0==this.current_document_index&&this.current_document_index!=this.documents.length-1?(this.previousDocumentLink.hide(),this.nextDocumentLink.show()):0==this.current_document_index&&this.current_document_index==this.documents.length-1?(this.previousDocumentLink.hide(),this.nextDocumentLink.hide()):this.current_document_index==this.documents.length-1?(this.previousDocumentLink.show(),this.nextDocumentLink.hide()):(this.previousDocumentLink.show(),this.nextDocumentLink.show())},getActivity:function(){var e=this;if(i(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner"></i>'),void 0!==BP_Nouveau.activity&&e.current_media&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id&&!e.current_media.is_forum){!1!=e.activity_ajax&&e.activity_ajax.abort();var t=i('[data-bp-activity-id="'+e.current_media.activity_id+'"] .activity-comments');t.length&&(e.current_media.parent_activity_comments=!0,t.html("")),!0===e.current_media.parent_activity_comments&&i(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+e.current_media.activity_id+'" id="hidden_parent_id"/>'),e.activity_ajax=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_activity",id:e.current_media.activity_id,group_id:_.isUndefined(e.current_media.group_id)?0:e.current_media.group_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(i(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity),i(".bb-media-info-section:visible").show(),jQuery(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},10))}})}else i(".bb-media-info-section.media").hide()},getDocumentsActivity:function(){var e=this;if(i(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),void 0!==BP_Nouveau.activity&&e.current_document&&void 0!==e.current_document.activity_id&&0!=e.current_document.activity_id&&!e.current_document.is_forum){!1!=e.activity_ajax&&e.activity_ajax.abort();var t=i('[data-bp-activity-id="'+e.current_document.activity_id+'"] .activity-comments');t.length&&(e.current_document.parent_activity_comments=!0,t.html("")),!0===e.current_document.parent_activity_comments&&i(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+e.current_document.activity_id+'" id="hidden_parent_id"/>'),e.activity_ajax=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_get_activity",id:e.current_document.activity_id,group_id:_.isUndefined(e.current_document.group_id)?0:e.current_document.group_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(i(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity),i(".bb-media-info-section:visible").show(),jQuery(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},10))}})}else i(".bb-media-info-section.document").hide()},getDocumentsDescription:function(){var e=this;i(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),!1!=e.activity_ajax&&e.activity_ajax.abort();var t=i('[data-bp-activity-id="'+e.current_document.activity_id+'"] .activity-comments');t.length&&(e.current_document.parent_activity_comments=!0,t.html("")),!0===e.current_document.parent_activity_comments&&i(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+e.current_document.activity_id+'" id="hidden_parent_id"/>'),e.activity_ajax=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_get_document_description",id:e.current_document.id,attachment_id:e.current_document.attachment_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success?(i(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),i(".bb-media-info-section:visible").show(),i(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},10)):i(".bb-media-info-section.document").hide()}})},activityDeleted:function(e,t){var a=this,o=0;if(a.is_open_media&&void 0!==t&&"delete_activity"===t.action&&a.current_media.activity_id==t.id){var d=i(document).find('[data-bp-list="media"] .bb-open-media-theatre[data-id="'+a.current_media.id+'"]'),s=d.parents("ul");for(d.closest("li").remove(),0===s.find("li:not(.load-more)").length&&(i(".bb-photos-actions").length>0&&i(".bb-photos-actions").hide(),1===s.find("li.load-more").length&&location.reload()),i(document).find('[data-bp-list="activity"] .bb-open-media-theatre[data-id="'+a.current_media.id+'"]').closest(".bb-activity-media-elem").remove(),o=0;o<a.medias.length;o++)if(a.medias[o].activity_id==t.id){a.medias.splice(o,1);break}0==a.current_index&&a.current_index!=a.medias.length?(a.current_index=-1,a.next(e)):0==a.current_index&&a.current_index==a.medias.length?(i(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+a.current_media.activity_id+'"]').remove(),a.closeTheatre(e)):a.current_index==a.medias.length?a.previous(e):(a.current_index=-1,a.next(e))}if(a.is_open_document&&void 0!==t&&"delete_activity"===t.action&&a.current_document.activity_id==t.id){for(i(document).find('[data-bp-list="document"] .bb-open-document-theatre[data-id="'+a.current_document.id+'"]').closest('div.ac-document-list[data-activity-id="'+a.current_document.activity_id+'"]').remove(),i(document).find('[data-bp-list="activity"] .bb-open-document-theatre[data-id="'+a.current_document.id+'"]').closest(".bb-activity-media-elem").remove(),o=0;o<a.documents.length;o++)if(a.documents[o].activity_id==t.id){a.documents.splice(o,1);break}0==a.current_document_index&&a.current_document_index!=a.documents.length?(a.current_document_index=-1,a.nextDocument(e)):0==a.current_document_index&&a.current_document_index==a.documents.length?(i(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+a.current_document.activity_id+'"]').remove(),a.closeDocumentTheatre(e)):a.current_document_index==a.documents.length?a.previousDocument(e):(a.current_document_index=-1,a.nextDocument(e))}},togglePopupDropdown:function(e){var t;if((e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||i(t).hasClass("privacy-wrap")||i(t).parent().hasClass("privacy-wrap"))return e;i("ul.media-privacy").removeClass("bb-open"),i("ul.document-privacy").removeClass("bb-open")},togglePrivacyDropdown:function(e){var t=i(e.target);e.preventDefault(),t.closest(".bb-media-privacy-wrap").find(".media-privacy").toggleClass("bb-open")},mediaPrivacyChange:function(e){var t=i(e.target),a=t.data("value"),o="public";if(e.preventDefault(),t.hasClass("selected"))return!1;t.closest(".bb-media-privacy-wrap").find(".privacy").addClass("loading"),o=t.closest(".bb-media-privacy-wrap").find("ul.media-privacy li.selected").data("value"),t.closest(".bb-media-privacy-wrap").find("ul.media-privacy li").removeClass("selected"),t.addClass("selected"),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_update_privacy",id:this.current_media.id,_wpnonce:BP_Nouveau.nonces.media,privacy:a},success:function(){t.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading").removeClass(o),t.closest(".bb-media-privacy-wrap").find(".privacy").addClass(a),t.closest(".bb-media-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",t.text())},error:function(){t.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading")}})},openMediaActivityDescription:function(e){e.preventDefault();var t=i(e.currentTarget);if(t.parents(".activity-media-description").find(".bp-edit-media-activity-description").length<1)return!1;t.parents(".activity-media-description").find(".bp-edit-media-activity-description").show().addClass("open"),t.parents(".activity-media-description").find(".bp-media-activity-description").hide(),t.hide()},closeMediaActivityDescription:function(e){e.preventDefault();var t=i(e.currentTarget);if(t.parents(".activity-media-description").length<1)return!1;var a=t.parents(".activity-media-description").find("#add-activity-description").get(0).defaultValue;t.parents(".activity-media-description").find(".bp-add-media-activity-description").show(),t.parents(".activity-media-description").find(".bp-media-activity-description").show(),t.parents(".activity-media-description").find("#add-activity-description").val(a),t.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open")},MediaActivityDescriptionUpdate:function(e){""!==i(e.currentTarget).val().trim()?i(e.currentTarget).closest(".bp-edit-media-activity-description").addClass("has-content"):i(e.currentTarget).closest(".bp-edit-media-activity-description").removeClass("has-content")},submitMediaActivityDescription:function(e){e.preventDefault();var t,a=i(e.currentTarget),o=a.parents(".activity-media-description"),d={action:"media_description_save",description:o.find("#add-activity-description").val(),attachment_id:o.find("#bp-attachment-id").val(),_wpnonce:BP_Nouveau.nonces.media};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,async:!1,success:function(e){e.success?(a.parents(".activity-media-description").find(".bp-media-activity-description").html(e.data.description).show(),a.parents(".activity-media-description").find(".bp-add-media-activity-description").show(),o.find("#add-activity-description").val(e.data.description),o.find("#add-activity-description").get(0).defaultValue=e.data.description,""==e.data.description?a.parents(".activity-media-description").find(".bp-add-media-activity-description").removeClass("show-edit").addClass("show-add"):a.parents(".activity-media-description").find(".bp-add-media-activity-description").addClass("show-edit").removeClass("show-add"),a.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open"),a.parents(".activity-media-description").find(".bp-media-activity-description").show(),a.parents(".activity-media-description").find(".bp-feedback.error").remove()):a.parents(".activity-media-description").prepend(e.data.feedback)}})},toggleDocumentPrivacyDropdown:function(e){var t=i(e.target);e.preventDefault(),t.closest(".bb-document-privacy-wrap").find(".document-privacy").toggleClass("bb-open")},documentPrivacyChange:function(e){var t=i(e.target),a=t.data("value"),o="public";if(e.preventDefault(),t.hasClass("selected"))return!1;t.closest(".bb-document-privacy-wrap").find(".privacy").addClass("loading"),o=t.closest(".bb-document-privacy-wrap").find("ul.document-privacy li.selected").data("value"),t.closest(".bb-document-privacy-wrap").find("ul.document-privacy li").removeClass("selected"),t.addClass("selected"),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_save_privacy",item_id:this.current_document.id,_wpnonce:BP_Nouveau.nonces.media,value:a,type:"document"},success:function(){t.closest(".bb-document-privacy-wrap").find(".privacy").removeClass("loading").removeClass(o),t.closest(".bb-document-privacy-wrap").find(".privacy").addClass(a),t.closest(".bb-document-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",t.text())},error:function(){t.closest(".bb-document-privacy-wrap").find(".privacy").removeClass("loading")}})}},bp.Nouveau.Media.start(),bp.Nouveau.Media.Theatre.start())}(bp,jQuery);