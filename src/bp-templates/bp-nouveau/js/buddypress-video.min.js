window.bp=window.bp||{},function(n){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Video={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=n("body");this.video_dropzone_obj=[],this.dropzone_video=[],this.video_album_id=void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,this.video_group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-video-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType},void 0!==BP_Nouveau.video.dropzone_options&&Object.assign(this.options,BP_Nouveau.video.dropzone_options)},addListeners:function(){n(document).on("click","#bp-add-video",this.openUploader.bind(this)),n(document).on("click","#bp-video-uploader-close",this.closeUploader.bind(this)),n(document).on("click","#bp-video-submit",this.submitVideo.bind(this)),n(document).on("click",".bb-activity-video-elem .video-action-wrap .video-action_more, #video-stream.video .bb-item-thumb .video-action-wrap .video-action_more, .bb-activity-video-elem .video-action-wrap .video-action_list li a",this.videoActivityActionButton.bind(this)),n(document).on("change",'.bb-video-check-wrap [name="bb-video-select"]',this.addSelectedClassToWrapper.bind(this)),n(document).on("click","#bb-select-deselect-all-video",this.toggleSelectAllVideo.bind(this))},videoActivityActionButton:function(e){e.preventDefault(),n(e.currentTarget).closest(".bb-activity-video-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-video-elem").removeClass("is-visible"),n(e.currentTarget).closest(".bb-activity-video-elem").length<1&&n(e.currentTarget).closest(".bb-item-thumb").toggleClass("is-visible").parent().siblings().find(".bb-item-thumb").removeClass("is-visible").removeClass("is-visible"),"a"!=e.currentTarget.tagName.toLowerCase()||n(e.currentTarget).hasClass("video-action_more")||(n(e.currentTarget).closest(".bb-activity-video-elem").removeClass("is-visible"),n(e.currentTarget).closest(".bb-item-thumb").removeClass("is-visible"))},toggleSelectAllVideo:function(e){e.preventDefault(),n(e.currentTarget).hasClass("selected")?(n(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllVideo(e)):(n(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllVideo(e)),n(e.currentTarget).toggleClass("selected")},selectAllVideo:function(e){e.preventDefault(),n("#buddypress").find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){n(this).prop("checked",!0),n(this).closest(".bb-item-thumb").addClass("selected"),n(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllVideo:function(e){e.preventDefault(),n("#buddypress").find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){n(this).prop("checked",!1),n(this).closest(".bb-item-thumb").removeClass("selected"),n(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},addSelectedClassToWrapper:function(e){var o,i=e.currentTarget;n(i).is(":checked")?(n(i).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),n(i).closest(".bb-item-thumb").addClass("selected")):(n(i).closest(".bb-item-thumb").removeClass("selected"),n(i).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select),(o=n(".bp-nouveau #bb-select-deselect-all-video")).hasClass("selected")&&o.removeClass("selected"))},submitVideo:function(i){var e,o,t,d=this,a=n(i.currentTarget),s=n("#bb-video-privacy");if(i.preventDefault(),a.hasClass("saving"))return!1;a.addClass("saving"),"bp-video-dropzone-content"===d.current_tab?(e=n("#bp-video-post-content").val(),o={action:"video_save",_wpnonce:BP_Nouveau.nonces.video,videos:d.dropzone_video,content:e,album_id:d.video_album_id,group_id:d.video_group_id,privacy:s.val()},n("#bp-video-dropzone-content .bp-feedback").remove(),n.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(e){if(e.success){n("#video-stream ul.video-list").length||(n("#video-stream").html(n("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),n(".bb-videos-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend");for(var o=0;o<d.dropzone_video.length;o++)d.dropzone_video[o].saved=!0;d.closeUploader(i),jQuery(window).scroll()}else n("#bp-video-dropzone-content").prepend(e.data.feedback);a.removeClass("saving")}})):"bp-existing-video-content"===d.current_tab?(t=[],n('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){t.push(n(this).val())}),o={action:"video_move_to_album",_wpnonce:BP_Nouveau.nonces.video,medias:t,album_id:d.video_album_id,group_id:d.video_group_id},n("#bp-existing-video-content .bp-feedback").remove(),n.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(e){e.success?(n("#video-stream ul.media-list").length||(n("#video-stream").html(n("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),n(".bb-video-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend"),n('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){n(this).closest("li").data("id")===n(this).val()&&n(this).closest("li").remove()}),jQuery(window).scroll(),d.closeUploader(i)):n("#bp-existing-video-content").prepend(e.data.feedback),a.removeClass("saving")}})):d.current_tab||(d.closeUploader(i),a.removeClass("saving"))},clearFolderLocationUI:function(e){var o=jQuery(e.currentTarget).closest(".has-folderlocationUI");0<o.length&&(o.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),o.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),o.find(".location-folder-title").text(BP_Nouveau.media.target_text),o.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0"),o.find(".ac_document_search_folder").val(""),o.find(".bb-model-header h4 span").text("..."),o.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show())},openUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&n("div#video-uploader").length&&(n("#bp-video-uploader").show(),i.video_dropzone_obj=new Dropzone("div#video-uploader",i.videoOptions),i.video_dropzone_obj.on("sending",function(e,o,i){i.append("action","video_upload"),i.append("_wpnonce",BP_Nouveau.nonces.video)}),i.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){i.video_dropzone_obj.getAcceptedFiles().length&&n("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.video_dropzone_obj.on("error",function(e,o){e.accepted?void 0!==o&&void 0!==o.data&&void 0!==o.data.feedback&&n(e.previewElement).find(".dz-error-message span").text(o.data.feedback):this.removeFile(e)}),i.video_dropzone_obj.on("queuecomplete",function(){n("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),i.video_dropzone_obj.on("processing",function(){n("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),i.video_dropzone_obj.on("success",function(e,o){o.data.id?(e.id=o.id,o.data.uuid=e.upload.uuid,o.data.menu_order=i.dropzone_video.length,o.data.album_id=i.video_album_id,o.data.group_id=i.video_group_id,o.data.saved=!1,i.dropzone_video.push(o.data)):this.removeFile(e),n("#bp-video-submit").show(),n("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),n("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show()}),i.video_dropzone_obj.on("removedfile",function(e){if(i.dropzone_video.length)for(var o in i.dropzone_video)if(e.upload.uuid==i.dropzone_video[o].uuid){void 0===i.dropzone_video[o].saved||i.dropzone_video[o].saved||i.removeAttachment(i.dropzone_video[o].id),i.dropzone_video.splice(o,1);break}i.video_dropzone_obj.getAcceptedFiles().length?n("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show():(n("#bp-video-uploader-modal-status-text").text(""),n("#bp-video-submit").hide())}))},closeUploader:function(e){e.preventDefault(),n("#bp-video-uploader").hide(),n("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload),n("#bp-video-uploader-modal-status-text").text(""),this.video_dropzone_obj.destroy(),this.dropzone_video=[]},toggle_video_uploader:function(){this.open_video_uploader()},open_video_uploader:function(){if(this.$el.find("#activity-post-media-uploader").hasClass("open"))return!1}},bp.Nouveau.Video.start(),bp.Nouveau.Video.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.videos=[],this.current_video=!1,this.current_video_index=0,this.is_open_video=!1,this.nextVideoLink=n(".bb-next-video"),this.previousVideoLink=n(".bb-prev-video"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id},addListeners:function(){n(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this))},openTheatre:function(e){e.preventDefault();var o,i=n(e.currentTarget),t=this;if(i.closest("#bp-existing-media-content").length)return!1;t.setupGlobals(),t.setMedias(i),o=i.data("id"),t.setCurrentMedia(o),t.showMedia(),t.navigationCommands(),void 0!==BP_Nouveau.activity&&t.current_media&&void 0!==t.current_media.activity_id&&0!=t.current_media.activity_id&&!t.current_media.is_forum?t.getActivity():t.getMediasDescription(),n(".bb-media-model-wrapper.document").hide(),n(".bb-media-model-wrapper.media").show(),t.is_open_media=!0}},bp.Nouveau.Video.Theatre.start())}((bp,jQuery));