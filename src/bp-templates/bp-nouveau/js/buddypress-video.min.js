window.bp=window.bp||{},function(c){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Video={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=c("body");this.current_page=1,this.video_dropzone_obj=null,this.video_thumb_dropzone_obj=[],this.dropzone_video=[],this.dropzone_video_thumb=[],this.video_album_id=void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,!this.video_album_id&&0<parseInt(BP_Nouveau.media.current_album)&&(this.video_album_id=parseInt(BP_Nouveau.media.current_album)),this.video_group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-video-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType},this.videoThumbnailOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,dictDefaultMessage:BP_Nouveau.video.dropzone_video_thumbnail_message,acceptedFiles:"image/jpeg,image/png",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:1,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded},void 0!==BP_Nouveau.video.dropzone_options&&Object.assign(this.options,BP_Nouveau.video.dropzone_options)},addListeners:function(){var e=c(".bp-nouveau");c(document).on("click","#bp-add-video",this.openUploader.bind(this)),c(document).on("click",".bp-video-thumbnail-submit",this.submitVideoThumbnail.bind(this)),c(document).on("click",".ac-video-thumbnail-edit",this.openEditThumbnailUploader.bind(this)),c(document).on("click",".bp-video-thumbnail-uploader-close",this.closeEditThumbnailUploader.bind(this)),c(document).on("click","#bp-video-uploader-close",this.closeUploader.bind(this)),c(document).on("click","#bp-video-submit",this.submitVideo.bind(this)),c(document).on("click",".bb-activity-video-elem .video-action-wrap .video-action_more, #video-stream.video .bb-item-thumb .video-action-wrap .video-action_more, .bb-activity-video-elem .video-action-wrap .video-action_list li a",this.videoActivityActionButton.bind(this)),c(document).on("click",".activity .bp-video-move-activity, #video-stream .bp-video-move-activity",this.moveVideoIntoAlbum.bind(this)),c(document).on("click",".bp-video-open-create-popup-folder",this.createAlbumInPopup.bind(this)),c(document).on("click",".ac-video-close-button",this.closeVideoMove.bind(this)),c(document).on("click",".ac-video-move",this.openVideoMove.bind(this)),c(document).on("change",'.bb-video-check-wrap [name="bb-video-select"]',this.addSelectedClassToWrapper.bind(this)),c(document).on("click","#bb-select-deselect-all-video",this.toggleSelectAllVideo.bind(this)),c(document).on("click",".video-action_list .edit_video",this.editVideo.bind(this)),c(document).on("click",".video-action_list .video-file-delete, #bb-delete-video",this.deleteVideo.bind(this)),e.on("click","#bb-create-video-album",this.openCreateVideoAlbumModal.bind(this)),e.on("click","#bp-video-create-album-close",this.closeCreateVideoAlbumModal.bind(this)),c(document).on("click","#bp-video-create-album-submit",this.saveAlbum.bind(this)),c('.bp-nouveau [data-bp-list="video"]').on("click","li.load-more",this.injectVideos.bind(this)),c(document).on("click",".bp-video-create-popup-album-submit",this.submitCreateAlbumInPopup.bind(this))},submitVideoThumbnail:function(t){var o=this,d=c(t.currentTarget);if(t.preventDefault(),d.hasClass("saving"))return!1;d.addClass("saving");var e=c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-edit-thumbnail-hidden-video-id").val(),i=c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-edit-thumbnail-hidden-attachment-id").val(),a={action:"video_thumbnail_save",_wpnonce:BP_Nouveau.nonces.video,video_thumbnail:o.dropzone_video_thumb,video_id:e,video_attachment_id:i};c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:a,success:function(e){if(e.success){for(var i=0;i<o.dropzone_video_thumb.length;i++)o.dropzone_video_thumb[i].saved=!0;o.closeEditThumbnailUploader(t)}d.removeClass("saving")}})},videoActivityActionButton:function(e){e.preventDefault(),c(e.currentTarget).closest(".bb-activity-video-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-video-elem").removeClass("is-visible"),c(e.currentTarget).closest(".bb-activity-video-elem").length<1&&c(e.currentTarget).closest(".bb-item-thumb").toggleClass("is-visible").parent().siblings().find(".bb-item-thumb").removeClass("is-visible").removeClass("is-visible"),"a"!=e.currentTarget.tagName.toLowerCase()||c(e.currentTarget).hasClass("video-action_more")||(c(e.currentTarget).closest(".bb-activity-video-elem").removeClass("is-visible"),c(e.currentTarget).closest(".bb-item-thumb").removeClass("is-visible"))},toggleSelectAllVideo:function(e){e.preventDefault(),c(e.currentTarget).hasClass("selected")?(c(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllVideo(e)):(c(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllVideo(e)),c(e.currentTarget).toggleClass("selected")},selectAllVideo:function(e){e.preventDefault(),c("#buddypress").find("#video-stream li").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){c(this).prop("checked",!0),c(this).closest(".bb-item-thumb").addClass("selected"),c(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllVideo:function(e){e.preventDefault(),c("#buddypress").find("#video-stream li").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){c(this).prop("checked",!1),c(this).closest(".bb-item-thumb").removeClass("selected"),c(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},addSelectedClassToWrapper:function(e){var i,t=e.currentTarget;c(t).is(":checked")?(c(t).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),c(t).closest(".bb-item-thumb").addClass("selected")):(c(t).closest(".bb-item-thumb").removeClass("selected"),c(t).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select),(i=c(".bp-nouveau #bb-select-deselect-all-video")).hasClass("selected")&&i.removeClass("selected"))},submitVideo:function(t){var e,i,o,d=this,a=c(t.currentTarget),n=c("#bb-video-privacy");if(t.preventDefault(),a.hasClass("saving"))return!1;a.addClass("saving"),"bp-video-dropzone-content"===d.current_tab?(e=c("#bp-video-post-content").val(),i={action:"video_save",_wpnonce:BP_Nouveau.nonces.video,videos:d.dropzone_video,content:e,album_id:d.video_album_id,group_id:d.video_group_id,privacy:n.val()},c("#bp-video-dropzone-content .bp-feedback").remove(),c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){if(e.success){c("#bp-media-single-album").length?(c("#media-stream ul.media-list").length||(c("#media-stream").html(c("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),c(".bb-videos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",e.data.video,"prepend")):(c("#video-stream ul.video-list").length||(c("#video-stream").html(c("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),c(".bb-videos-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend"));for(var i=0;i<d.dropzone_video.length;i++)d.dropzone_video[i].saved=!0;d.closeUploader(t),jQuery(window).scroll()}else c("#bp-video-dropzone-content").prepend(e.data.feedback);a.removeClass("saving")}})):"bp-existing-video-content"===d.current_tab?(o=[],c('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){o.push(c(this).val())}),i={action:"video_move_to_album",_wpnonce:BP_Nouveau.nonces.video,medias:o,album_id:d.video_album_id,group_id:d.video_group_id},c("#bp-existing-video-content .bp-feedback").remove(),c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(c("#video-stream ul.media-list").length||(c("#video-stream").html(c("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),c(".bb-video-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend"),c('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){c(this).closest("li").data("id")===c(this).val()&&c(this).closest("li").remove()}),jQuery(window).scroll(),d.closeUploader(t)):c("#bp-existing-video-content").prepend(e.data.feedback),a.removeClass("saving")}})):d.current_tab||(d.closeUploader(t),a.removeClass("saving"))},clearFolderLocationUI:function(e){var i=jQuery(e.currentTarget).closest(".has-folderlocationUI");0<i.length&&(i.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),i.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),i.find(".location-folder-title").text(BP_Nouveau.video.target_text),i.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0"),i.find(".ac_document_search_folder").val(""),i.find(".bb-model-header h4 span").text("..."),i.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show())},openUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&c("div.video-uploader-wrapper #video-uploader").length&&(c("#bp-video-uploader").show(),t.video_dropzone_obj=new Dropzone("div.video-uploader-wrapper #video-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),t.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){t.video_dropzone_obj.getAcceptedFiles().length&&c("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&c(e.previewElement).find(".dz-error-message span").text(i.data.feedback):this.removeFile(e)}),t.video_dropzone_obj.on("queuecomplete",function(){c("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),t.video_dropzone_obj.on("processing",function(){c("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),t.video_dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.saved=!1,t.dropzone_video.push(i.data)):this.removeFile(e),c("#bp-video-submit").show(),c("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),c("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video.length)for(var i in t.dropzone_video)if(e.upload.uuid==t.dropzone_video[i].uuid){void 0===t.dropzone_video[i].saved||t.dropzone_video[i].saved||t.removeAttachment(t.dropzone_video[i].id),t.dropzone_video.splice(i,1);break}t.video_dropzone_obj.getAcceptedFiles().length?c("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show():(c("#bp-video-uploader-modal-status-text").text(""),c("#bp-video-submit").hide())}))},openEditThumbnailUploader:function(e){var o=this;e.preventDefault();var i,t=c(e.currentTarget),d=t.attr("data-video-attachment-id"),a=t.attr("data-video-id"),n="";0<c(e.currentTarget).closest(".activity-inner").length?n=c(e.currentTarget).closest(".activity-inner"):0<c(e.currentTarget).closest("#video-stream.video").length?n=c(e.currentTarget).closest("#video-stream.video"):0<c(e.currentTarget).closest("#media-stream.media").length?n=c(e.currentTarget).closest("#media-stream.media"):0<c(e.currentTarget).closest(".comment-item").length&&(n=c(e.currentTarget).closest(".comment-item")),c(n).find(".bp-video-thumbnail-uploader").addClass("opened-edit-thumbnail").show(),void 0!==window.Dropzone&&c("div.bp-video-thumbnail-uploader.opened-edit-thumbnail div.video-thumbnail-uploader-wrapper .video-thumbnail-uploader-dropzone-select").length&&(c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-edit-thumbnail-hidden-video-id").val(a),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-edit-thumbnail-hidden-attachment-id").val(d),o.video_thumb_dropzone_obj=new Dropzone("div.bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-uploader-dropzone-select",o.videoThumbnailOptions),o.video_thumb_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_thumbnail_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),o.video_thumb_dropzone_obj.on("addedfile",function(e){e.video_thumbnail_edit_data?(o.dropzone_video_thumb.push(e.video_thumbnail_edit_data),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-uploader-wrapper .dropzone.dz-clickable").addClass("dz-max-files-reached")):setTimeout(function(){o.video_thumb_dropzone_obj.getAcceptedFiles().length&&c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,o.dropzone_video_thumb.length,o.video_thumb_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),o.video_thumb_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&c(e.previewElement).find(".dz-error-message span").text(i.data.feedback):this.removeFile(e)}),o.video_thumb_dropzone_obj.on("queuecomplete",function(){c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload_thumb)}),o.video_thumb_dropzone_obj.on("processing",function(){c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),o.video_thumb_dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=o.dropzone_video.length,i.data.album_id=o.video_album_id,i.data.group_id=o.video_group_id,i.data.saved=!1,o.dropzone_video_thumb.push(i.data)):this.removeFile(e),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-submit").show(),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,o.dropzone_video_thumb.length,o.video_thumb_dropzone_obj.getAcceptedFiles().length)).show()}),o.video_thumb_dropzone_obj.on("removedfile",function(e){if(o.dropzone_video_thumb.length)for(var i in o.dropzone_video_thumb)if(e.upload.uuid==o.dropzone_video_thumb[i].uuid){void 0===o.dropzone_video_thumb[i].saved||o.dropzone_video_thumb[i].saved||o.removeVideoThumbnailAttachment(o.dropzone_video_thumb[i].id),o.dropzone_video_thumb.splice(i,1);break}o.video_thumb_dropzone_obj.getAcceptedFiles().length?c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,o.dropzone_video_thumb.length,o.video_thumb_dropzone_obj.getAcceptedFiles().length)).show():(c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(""),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-submit").hide())}),i={action:"video_get_edit_thumbnail_data",_wpnonce:BP_Nouveau.nonces.video,attachment_id:d,video_id:a},c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){var i,t;e.success&&(e.data.default_images&&((i=c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list")).html(""),i.html(e.data.default_images)),e.data.dropzone_edit&&(t={name:e.data.dropzone_edit.name,accepted:!0,kind:"image",upload:{filename:e.data.dropzone_edit.name,uuid:e.data.dropzone_edit.attachment_id},dataURL:e.data.dropzone_edit.url,id:e.data.dropzone_edit.attachment_id,video_thumbnail_edit_data:{id:e.data.dropzone_edit.attachment_id,media_id:e.data.dropzone_edit.id,name:e.data.dropzone_edit.name,thumb:e.data.dropzone_edit.thumb,url:e.data.dropzone_edit.url,uuid:e.data.dropzone_edit.attachment_id,menu_order:0,saved:!0}},o.video_thumb_dropzone_obj&&(o.video_thumb_dropzone_obj.files.push(t),o.video_thumb_dropzone_obj.emit("addedfile",t),o.createThumbnailFromUrl(t))))}}))},createThumbnailFromUrl:function(i){var t=this;t.video_thumb_dropzone_obj.createThumbnailFromUrl(i,t.video_thumb_dropzone_obj.options.thumbnailWidth,t.video_thumb_dropzone_obj.options.thumbnailHeight,t.video_thumb_dropzone_obj.options.thumbnailMethod,!0,function(e){t.video_thumb_dropzone_obj.emit("thumbnail",i,e),t.video_thumb_dropzone_obj.emit("complete",i)})},closeEditThumbnailUploader:function(e){e.preventDefault(),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload_thumb),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(""),c(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-uploader-wrapper .video-thumbnail-uploader-dropzone-select").html(""),this.video_thumb_dropzone_obj.destroy(),this.dropzone_video_thumb=[],c(".bp-video-thumbnail-uploader.opened-edit-thumbnail").hide(),c(".bp-video-thumbnail-uploader").removeClass("opened-edit-thumbnail"),c(window).scroll()},openAlbumUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&c("div#video-album-uploader").length&&(c("#bp-video-uploader").show(),t.video_dropzone_obj=new Dropzone("div#video-album-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),t.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){t.video_dropzone_obj.getAcceptedFiles().length&&c("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&c(e.previewElement).find(".dz-error-message span").text(i.data.feedback):this.removeFile(e)}),t.video_dropzone_obj.on("queuecomplete",function(){c("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),t.video_dropzone_obj.on("processing",function(){c("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),t.video_dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.saved=!1,t.dropzone_video.push(i.data)):this.removeFile(e),c("#bp-video-submit").show(),c("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),c("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video.length)for(var i in t.dropzone_video)if(e.upload.uuid==t.dropzone_video[i].uuid){void 0===t.dropzone_video[i].saved||t.dropzone_video[i].saved||t.removeAttachment(t.dropzone_video[i].id),t.dropzone_video.splice(i,1);break}t.video_dropzone_obj.getAcceptedFiles().length?c("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show():(c("#bp-video-uploader-modal-status-text").text(""),c("#bp-video-submit").hide())}))},removeVideoThumbnailAttachment:function(e){var i={action:"video_thumbnail_delete_attachment",_wpnonce:BP_Nouveau.nonces.video,id:e};c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i})},closeUploader:function(e){e.preventDefault(),c("#bp-video-uploader").hide(),c("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload),c("#bp-video-uploader-modal-status-text").text(""),this.video_dropzone_obj.destroy(),this.dropzone_video=[]},toggle_video_uploader:function(){this.open_video_uploader()},open_video_uploader:function(){if(this.$el.find("#activity-post-media-uploader").hasClass("open"))return!1},editVideo:function(e){e.preventDefault(),console.log("Open Edit Popup here")},deleteVideo:function(e){var o=c(e.currentTarget);e.preventDefault();var d,a=[],n=c("#buddypress"),i=o.attr("data-type"),s=o.data("item-from"),t="";if("video"===i&&!confirm(BP_Nouveau.video.i18n_strings.video_delete_confirm))return!1;if(o.hasClass("bb-delete")){if(!confirm(BP_Nouveau.video.i18n_strings.video_delete_confirm))return!1;n.find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){c(this).closest(".bb-video-thumb").addClass("loading deleting"),a.push(c(this).val())})}if(d=o.data("parent-activity-id"),s&&s.length&&"activity"===s&&0==a.length&&(t=o.attr("data-item-id"),a.push(t)),0==a.length&&a.push(o.data("item-id")),0==a.length)return!1;o.prop("disabled",!0),c("#buddypress #video-stream.video .bp-feedback").remove();var r={action:"video_delete",_wpnonce:BP_Nouveau.nonces.video,video:a,activity_id:d,from_where:s};c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:r,success:function(e){var i,t="";s&&s.length&&"activity"===s?e.success&&(c.each(a,function(e,i){c('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+i+'"]').length&&c('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+i+'"]').remove(),c("body .bb-activity-video-elem.video-activity."+i).length&&c("body .bb-activity-video-elem.video-activity."+i).remove()}),c('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-video-wrap').remove(),c('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner').append(e.data.video_content),0==c('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-video-elem').length&&c('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"]').remove(),!1===e.data.delete_activity&&c("body #buddypress .activity-list li#activity-"+d).replaceWith(e.data.activity_content)):s&&s.length&&"video"===s?e.success&&("yes"===BP_Nouveau.video.is_video_directory?"personal"===(i=bp.Nouveau.getStorage("bp-video").scope)?(c(document).find("li#video-personal a").trigger("click"),c(document).find("li#video-personal").trigger("click")):"groups"===i?(c(document).find("li#video-groups a").trigger("click"),c(document).find("li#video-groups").trigger("click")):(c(document).find("li#video-all a").trigger("click"),c(document).find("li#video-all").trigger("click")):(e.data.video_personal_count&&c("#buddypress").find(".bp-wrap .users-nav ul li#video-personal-li a span.count").text(e.data.video_personal_count),e.data.video_group_count&&c("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").text(e.data.video_group_count),c.each(a,function(e,i){c('#video-stream ul.video-list li[data-id="'+i+'"]').length&&c('#video-stream ul.video-list li[data-id="'+i+'"]').remove()}),0==c("#buddypress").find(".video-list:not(.existing-video-list)").find("li:not(.load-more)").length&&(c(".bb-videos-actions").hide(),t='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.video.i18n_strings.no_videos_found+"</p>\n\t</aside>",c('#buddypress [data-bp-list="video"]').html(t)))):(setTimeout(function(){o.prop("disabled",!1)},500),e.success?(n.find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){c(this).closest("li").remove()}),0==c("#buddypress").find(".video-list:not(.existing-video-list)").find("li:not(.load-more)").length&&(c(".bb-videos-actions").hide(),t='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.video.i18n_strings.no_videos_found+"</p>\n\t</aside>",c('#buddypress [data-bp-list="video"]').html(t))):c("#buddypress #video-stream.video").prepend(e.data.feedback)),jQuery(window).scroll()}})},openCreateVideoAlbumModal:function(e){e.preventDefault(),this.openAlbumUploader(e),c("#bp-video-create-album").show()},closeCreateVideoAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),c("#bp-video-create-album").hide(),c("#bb-album-title").val("")},saveAlbum:function(i){console.log("HelloWorld!");var t=c(i.currentTarget),o=this,d=c("#bb-album-title"),a=c("#bb-album-privacy");if(t.hasClass("saving"))return!1;if(i.preventDefault(),""===c.trim(d.val()))return d.addClass("error"),!1;if(d.removeClass("error"),!o.group_id&&""===c.trim(a.val()))return a.addClass("error"),!1;a.removeClass("error"),t.addClass("saving"),t.attr("disabled",!0);var e={action:"video_album_save",_wpnonce:BP_Nouveau.nonces.video,title:d.val(),videos:o.dropzone_video,privacy:a.val()};o.album_id&&(e.album_id=o.album_id),o.group_id&&(e.group_id=o.group_id),c("#bp-media-single-album .bp-feedback").remove(),c("#boss-media-create-album-popup .bp-feedback").remove(),c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){setTimeout(function(){t.removeClass("saving"),t.prop("disabled",!1)},500),e.success?o.album_id?(c("#bp-single-album-title").text(d.val()),c("#bb-album-privacy").val(a.val()),o.cancelEditAlbumTitle(i)):(c("#buddypress .bb-albums-list").prepend(e.data.album),window.location.href=e.data.redirect_url):o.album_id?c("#bp-media-single-album").prepend(e.data.feedback):c("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},injectVideos:function(i){var t,o,e,d=bp.Nouveau.getStorage("bp-video"),a=d.scope||null,n=d.filter||null;c(i.currentTarget).hasClass("load-more")&&(t=+Number(this.current_page)+1,o=this,e="",i.preventDefault(),c(i.currentTarget).find("a").first().addClass("loading"),c("#buddypress .dir-search input[type=search]").length&&(e=c("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"video",scope:a,filter:n,search_terms:e,page:t,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(c(i.currentTarget).remove(),o.current_page=t,jQuery(window).scroll())}))},openVideoMove:function(e){var i,t,o,d;e.preventDefault(),this.moveToIdPopup=c(e.currentTarget).attr("id"),this.moveToTypePopup=c(e.currentTarget).attr("data-type"),0<c(e.currentTarget).closest(".activity-inner").length?i=c(e.currentTarget).closest(".activity-inner"):0<c(e.currentTarget).closest("#media-stream.media").length?i=c(e.currentTarget).closest("#media-stream.media"):0<c(e.currentTarget).closest("#video-stream.video").length?i=c(e.currentTarget).closest("#video-stream.video"):0<c(e.currentTarget).closest(".comment-item").length&&(i=c(e.currentTarget).closest(".comment-item")),c(i).find(".bp-video-move-file").addClass("open").show(),o=c(e.currentTarget).closest(".video-action-wrap").siblings("a").data("id"),t=c(e.currentTarget).closest(".video-action-wrap").siblings("a").data("album-id"),"undefined"===o&&(o=c(e.currentTarget).closest(".video-action-wrap").siblings("div.video-js").data("id"),t=c(e.currentTarget).closest(".video-action-wrap").siblings("div.video-js").data("album-id")),i.find(".bp-video-move").attr("id",o),i.find(".bb-model-footer .bp-video-move").addClass("is-disabled"),d=c(e.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li.comment-item").length?"#"+c(e.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bp-video-move-file":"#"+c(e.currentTarget).closest("li.activity-item").attr("id")+" > .activity-content .bp-video-move-file",c(d).find(".bp-document-move").attr("id",c(e.currentTarget).closest(".document-activity").attr("data-id")),(0<c(e.currentTarget).closest(".media-list").length||0<c(e.currentTarget).closest(".video-list").length)&&(d=".bp-video-move-file"),"group"===this.moveToTypePopup?c(document).find(".location-album-list-wrap h4").show():c(document).find(".location-album-list-wrap h4").hide(),c(d).addClass("open-popup"),c(d).find(".location-album-list-wrap .location-album-list").remove(),c(d).find(".location-album-list-wrap").append('<ul class="location-album-list is-loading"><li><i class="bb-icon-loader animate-spin"></i></li></ul>');var a=t,n=this.moveToTypePopup;""!==this.moveToIdPopup&&c.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){c(document).find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-video").html(e.data.first_span_text),""===e.data.html?(c(document).find(".open-popup .location-album-list-wrap").hide(),c(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()):(c(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide(),c(document).find(".open-popup .location-album-list-wrap").show()),"group"===n?(c(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide(),c(document).find(".open-popup .bb-album-create-from").val("group")):(c(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),c(document).find(".open-popup .bb-album-create-from").val("profile")),c(d).find(".location-album-list-wrap .location-album-list").remove(),c(d).find(".location-album-list-wrap").append(e.data.html),c(d).find("ul.location-album-list span#"+a).trigger("click")}}),c(document).on("click",d+" .location-album-list li span",function(e){var i;e.preventDefault(),c(this).parent().hasClass("is_active")||(0!=c(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&c(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),c(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+c(this).attr("id")+'">'+c(this).text()+"</span>"),c(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),i=c(document).find('a.bb-open-video-theatre[data-id="'+o+'"]').data("album-id"),Number(i)==Number(c(e.currentTarget).data("id"))?c(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").addClass("is-disabled"):c(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").removeClass("is-disabled"),c(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").hasClass("is-disabled")||c(e.currentTarget).closest(".bp-video-move-file").find(".bb-album-selected-id").val(c(e.currentTarget).data("id")))}),c(document).on("click",d+" .breadcrumb .item > span",function(e){c(this).hasClass("is-disabled")||(c(e.currentTarget).closest(".bp-video-move-file").find(".bb-album-selected-id").val(0),c(e.currentTarget).closest(".bp-video-move-file").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),c(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&c(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),a==c(e.currentTarget).data("id")?c(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").addClass("is-disabled"):c(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").removeClass("is-disabled"))})},createAlbumInPopup:function(e){e.preventDefault();var i=parseInt(c(document).find(".open-popup .bb-album-selected-id").val()),t=c(document).find(".open-popup .bb-album-create-from").val();0<i?c(document).find(".open-popup .privacy-field-wrap-hide-show").hide():c(document).find(".open-popup .privacy-field-wrap-hide-show").show(),"group"===t?c(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide():c(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),c(".modal-container .bb-model-footer").hide(),c(".bb-field-wrap-search").hide(),c(".bp-document-open-create-popup-folder").hide(),c(".location-album-list-wrap-main").hide(),c(".bb-field-steps-2 #bp-media-prev").hide(),c(".create-popup-album-wrap").show(),c(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().hide(),c(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").append("<p>Create Album</p>"),c(".modal-container #bb-folder-privacy").addClass("new-folder-create-privacy"),c(document).find(".open-popup .error").hide()},closeVideoMove:function(e){e.preventDefault(),0!=c(e.currentTarget).closest(".bp-video-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").data("id")&&c(e.currentTarget).closest(".bp-video-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").remove(),c(e.currentTarget).closest(".bp-video-move-file").hide()},moveVideoIntoAlbum:function(e){var i=c(e.currentTarget);e.preventDefault();var t=i.attr("id"),o=i.closest(".bp-video-move-file").find(".bb-album-selected-id").val();if(""===t||""===o)return i.closest(".modal-container").find(".location-album-list").addClass("has-error"),!1;i.closest(".modal-container").find(".location-album-list").removeClass("has-error"),i.addClass("loading");var d=c(document).find('li.move_video a[data-video-id="'+t+'"]').attr("data-parent-activity-id"),a=parseInt(this.group_id);a||(a=!1,"group"===c(document).find('li.move_video a[data-video-id="'+t+'"]').attr("data-type")&&(a=c(document).find('li.move_video a[data-video-id="'+t+'"]').attr("id")));var n={action:"video_move",_wpnonce:BP_Nouveau.nonces.video,video_id:t,album_id:o,group_id:a,activity_id:d};c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){e.success?("yes"===BP_Nouveau.video.is_video_directory?"personal"===bp.Nouveau.getStorage("bp-video").scope?(c(document).find("li#video-personal a").trigger("click"),c(document).find("li#video-personal").trigger("click")):(c(document).find("li#video-all a").trigger("click"),c(document).find("li#video-all").trigger("click")):(0<parseInt(BP_Nouveau.video.current_album)?c('#video-stream ul.video-list li[data-id="'+t+'"]').remove():c('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+t+'"]').length&&!c('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+t+'"]').parent().hasClass("bb-video-length-1")&&(c('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+t+'"]').remove(),d&&d.length&&(c('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-video-wrap').remove(),c('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner').append(e.data.video_content),jQuery(window).scroll())),c(document).find(".open-popup .error").hide(),c(document).find(".open-popup .error").html(""),i.removeClass("loading"),c(document).removeClass("open-popup")),i.closest(".bp-video-move-file").find(".ac-video-close-button").trigger("click"),c(document).find('a.bb-open-video-theatre[data-id="'+t+'"]').data("album-id",o)):alert(e.data.feedback.replace("&#039;","'"))}})},submitCreateAlbumInPopup:function(e){e.preventDefault();var i=c(e.currentTarget).closest(".open-popup"),t=c(i).find(".bp-video-create-popup-album-submit"),o=i.find(".bb-album-selected-id").val();""===o&&(o=0),this.currentTargetParent=o;var d=this.currentTargetParent,a=0,n=c.trim(c(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album-title").val()),s=c(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album-title"),r="",l="",u=0;if("group"===this.moveToTypePopup?(r="grouponly",a=this.moveToIdPopup):(r=c(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy").val(),l=c(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy")),""===n)return alert(BP_Nouveau.media.create_album_error_title),!1;t.addClass("loading"),setTimeout(function(){var e={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:n,privacy:r,parent:d,group_id:a};c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,async:!1,success:function(e){e.success&&(i.find(".location-album-list-wrap .location-album-list").remove(),i.find(".location-album-list-wrap").append(e.data.tree_view),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(i,e.data.album_id),u=e.data.album_id,""===e.data.tree_view?(i.find(".location-album-list-wrap").hide(),i.find(".location-album-list-wrap-main span.no-album-exists").show()):(i.find(".location-album-list-wrap-main span.no-album-exists").hide(),i.find(".location-album-list-wrap").show()),i.find("ul.location-album-list span#"+u).trigger("click"),i.find(".bb-model-footer").show(),i.find(".bb-field-wrap-search").show(),i.find(".bp-video-open-create-popup-album").show(),i.find(".location-album-list-wrap-main").show(),i.find(".create-popup-album-wrap").hide(),i.find(".bb-field-steps-2 #bp-media-prev").show(),i.find(".bb-album-selected-id").val(),i.find(".bb-album-selected-id").val(u),i.find(".bb-model-header").children().show(),i.find(".bb-model-header p").hide(),s.val(""),""!==l&&l.val("public"),c(i).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&c(i).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>c(i).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(c(i).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(c(i).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),c(i).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||c('<span class="more_options">...</span>').insertAfter(c(i).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),t.removeClass("loading"))}}),this.currentTargetParent=u,i.find(".location-album-list li.is_active").show().children("span, i").show().siblings("ul").hide(),i.find(".location-album-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide(),i.find(".location-album-list li span.selected").removeClass("selected"),i.find(".location-album-list li.is_active").children("span").addClass("selected")},0)}},bp.Nouveau.Video.start(),bp.Nouveau.Video.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.videos=[],this.current_video=!1,this.current_video_index=0,this.is_open_video=!1,this.nextVideoLink=c(".bb-next-media"),this.previousVideoLink=c(".bb-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id},addListeners:function(){c(document).on("click",".bb-open-video-theatre",this.openTheatre.bind(this)),c(document).on("click",".bb-prev-media",this.previous.bind(this)),c(document).on("click",".bb-next-media",this.next.bind(this)),c(document).on("click",".bp-add-video-activity-description",this.openVideoActivityDescription.bind(this)),c(document).on("click","#bp-activity-description-new-reset",this.closeVideoActivityDescription.bind(this)),c(document).on("click","#bp-activity-description-new-submit",this.submitVideoActivityDescription.bind(this))},openTheatre:function(e){e.preventDefault();var i,t=c(e.currentTarget),o=this;if(t.closest("#bp-existing-video-content").length)return!1;o.setupGlobals(),o.setVideos(t),i=t.data("id"),o.setCurrentVideo(i),o.showVideo(),o.navigationCommands(),void 0!==BP_Nouveau.activity&&o.current_video&&void 0!==o.current_video.activity_id&&0!=o.current_video.activity_id&&!o.current_video.is_forum?o.getActivity():o.getVideosDescription(),c(".bb-media-model-wrapper.document").hide(),c(".bb-media-model-wrapper.video").show(),o.is_open_video=!0},getVideosDescription:function(){var e=this;c(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),0!=e.activity_ajax&&e.activity_ajax.abort(),e.activity_ajax=c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_get_video_description",id:e.current_video.id,attachment_id:e.current_video.attachment_id,nonce:BP_Nouveau.nonces.video},success:function(e){e.success?(c(".bb-media-model-wrapper.video .bb-media-section").find("figure").html(e.data.video_data),c(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),c(".bb-media-info-section:visible").show(),c(window).scroll()):c(".bb-media-info-section.media").hide()}})},setVideos:function(e){var i=c(".bb-open-video-theatre"),t=0;if(c("body").hasClass("activity")&&(i=c(e).closest(".bb-activity-video-wrap").find(".bb-open-video-theatre")),void 0!==i)for(this.videos=[],t=0;t<i.length;t++){var o,d=c(i[t]);d.closest("#bp-existing-media-content").length||(o={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),attachment_id:d.data("attachment-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),is_forum:!1},d.closest(".forums-media-wrap").length&&(o.is_forum=!0),void 0!==o.privacy&&"message"==o.privacy?o.is_message=!0:o.is_message=!1,this.videos.push(o))}},setCurrentVideo:function(e){for(var i=this,t=0,t=0;t<i.videos.length;t++)if(e===i.videos[t].id){i.current_video=i.videos[t],i.current_index=t;break}},showVideo:function(){var e=this;if(void 0===e.current_video)return!1;c(".bb-media-model-wrapper.video .bb-media-section").find("figure").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>');var i,t=c(".bb-media-section .bb-media-privacy-wrap");t.length&&(t.show(),t.find("ul.media-privacy li").removeClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",""),(i=t.find("ul.media-privacy").find("li[data-value="+e.current_video.privacy+"]")).addClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",i.text()),t.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_video.privacy),(void 0!==BP_Nouveau.activity&&void 0!==e.current_video.activity_id&&0!=e.current_video.activity_id||e.group_id||e.current_video.is_forum||e.current_video.group_id||e.current_video.album_id||e.current_video.is_message)&&t.hide()),e.navigationCommands()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.videos.length-1?(e.previousVideoLink.hide(),e.nextVideoLink.show()):0==e.current_index&&e.current_index==e.videos.length-1?(e.previousVideoLink.hide(),e.nextVideoLink.hide()):e.current_index==e.videos.length-1?(e.previousVideoLink.show(),e.nextVideoLink.hide()):(e.previousVideoLink.show(),e.nextVideoLink.show())},next:function(e){e.preventDefault();var i,t=this;t.resetRemoveActivityCommentsData(),void 0!==t.videos[t.current_index+1]?(t.current_index=t.current_index+1,i=t.current_video.activity_id,t.current_video=t.videos[t.current_index],t.showVideo(),i!=t.current_video.activity_id?t.getActivity():t.getVideosDescription()):t.nextLink.hide()},previous:function(e){e.preventDefault();var i,t=this;t.resetRemoveActivityCommentsData(),void 0!==t.videos[t.current_index-1]?(t.current_index=t.current_index-1,i=t.current_video.activity_id,t.current_video=t.videos[t.current_index],t.showVideo(),i!=t.current_video.activity_id?t.getActivity():t.getVideosDescription()):t.previousLink.hide()},resetRemoveActivityCommentsData:function(){var e=this,i=!1,t=!1,o=!1,d=!1,a=!1,n=!1;e.current_video.parent_activity_comments&&((i=(d=c('.bb-media-model-wrapper.video [data-bp-activity-id="'+e.current_video.activity_id+'"]')).find(".activity-comments")).length&&(a=i.html(),n=i.attr("class"),i.remove(),(i=c('[data-bp-activity-id="'+e.current_video.activity_id+'"] .activity-comments')).length&&(i.html(a),i.attr("class",n))),(o=d.find(".activity-state")).length&&(a=o.html(),n=o.attr("class"),o.remove(),(o=c('[data-bp-activity-id="'+e.current_video.activity_id+'"] .activity-state')).length&&(o.html(a),o.attr("class",n))),(t=d.find(".activity-meta")).length&&(a=t.html(),n=t.attr("class"),t.remove(),(t=c('[data-bp-activity-id="'+e.current_video.activity_id+'"] .activity-meta')).length&&(t.html(a),t.attr("class",n))),d.remove())},getActivity:function(){var e,i=this;c(".bb-video-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),void 0!==BP_Nouveau.activity&&i.current_video&&void 0!==i.current_video.activity_id&&0!=i.current_video.activity_id&&!i.current_video.is_forum?(0!=i.activity_ajax&&i.activity_ajax.abort(),c(".bb-media-info-section.media").show(),(e=c('[data-bp-activity-id="'+i.current_video.activity_id+'"] .activity-comments')).length&&(i.current_video.parent_activity_comments=!0,e.html("")),i.activity_ajax=c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_get_activity",id:i.current_video.activity_id,group_id:_.isUndefined(i.current_video.group_id)?0:i.current_video.group_id,video_id:_.isUndefined(i.current_video.id)?0:i.current_video.id,nonce:BP_Nouveau.nonces.video},success:function(e){e.success&&(c(".bb-media-model-wrapper.video .bb-media-section").find("figure").html(e.data.video_data),c(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity),c(".bb-media-info-section:visible").show(),jQuery(window).scroll())}})):c(".bb-media-info-section.media").hide()},openVideoActivityDescription:function(e){e.preventDefault();var i=c(e.currentTarget);if(i.parents(".activity-video-description").find(".bp-edit-video-activity-description").length<1)return!1;i.parents(".activity-video-description").find(".bp-edit-video-activity-description").show().addClass("open"),i.parents(".activity-video-description").find(".bp-video-activity-description").hide(),i.hide()},closeVideoActivityDescription:function(e){e.preventDefault();var i=c(e.currentTarget);if(i.parents(".activity-video-description").length<1)return!1;var t=i.parents(".activity-video-description").find("#add-activity-description").get(0).defaultValue;i.parents(".activity-video-description").find(".bp-add-video-activity-description").show(),i.parents(".activity-video-description").find(".bp-video-activity-description").show(),i.parents(".activity-video-description").find("#add-activity-description").val(t),i.parents(".activity-video-description").find(".bp-edit-video-activity-description").hide().removeClass("open")},submitVideoActivityDescription:function(e){e.preventDefault();var i=c(e.currentTarget),t=i.parents(".activity-video-description"),o={action:"video_description_save",description:t.find("#add-activity-description").val(),attachment_id:t.find("#bp-attachment-id").val(),_wpnonce:BP_Nouveau.nonces.video};c.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,async:!1,success:function(e){e.success?(i.parents(".activity-video-description").find(".bp-video-activity-description").html(e.data.description).show(),i.parents(".activity-video-description").find(".bp-add-video-activity-description").show(),t.find("#add-activity-description").val(e.data.description),t.find("#add-activity-description").get(0).defaultValue=e.data.description,""==e.data.description?i.parents(".activity-video-description").find(".bp-add-video-activity-description").removeClass("show-edit").addClass("show-add"):i.parents(".activity-video-description").find(".bp-add-video-activity-description").addClass("show-edit").removeClass("show-add"),i.parents(".activity-video-description").find(".bp-edit-video-activity-description").hide().removeClass("open"),i.parents(".activity-video-description").find(".bp-video-activity-description").show(),i.parents(".activity-video-description").find(".bp-feedback.error").remove()):i.parents(".activity-video-description").prepend(e.data.feedback)}})}},bp.Nouveau.Video.Theatre.start(),bp.Nouveau.Video.Player={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){bp.Nouveau.Video.Player.openPlayer(),c(window).on("scroll resize",function(){bp.Nouveau.Video.Player.openPlayer()})},addListeners:function(){c(document).on("click",".video-js",this.openPlayer.bind(this))},openPlayer:function(){c(".video-js:not(.loaded)").each(function(){videojs(this,{},function(){this.on("ended",function(){})}),c(this).addClass("loaded")})}},bp.Nouveau.Video.Player.start())}((bp,jQuery));