window.bp=window.bp||{},function(s){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Video={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=s("body");this.video_dropzone_obj=[],this.dropzone_video=[],this.video_album_id=void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,this.video_group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-video-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType},void 0!==BP_Nouveau.video.dropzone_options&&Object.assign(this.options,BP_Nouveau.video.dropzone_options)},addListeners:function(){s(document).on("click","#bp-add-video",this.openUploader.bind(this)),s(document).on("click","#bp-video-uploader-close",this.closeUploader.bind(this)),s(document).on("click","#bp-video-submit",this.submitVideo.bind(this)),s(document).on("click",".bb-activity-video-elem .video-action-wrap .video-action_more, #video-stream.video .bb-item-thumb .video-action-wrap .video-action_more, .bb-activity-video-elem .video-action-wrap .video-action_list li a",this.videoActivityActionButton.bind(this)),s(document).on("change",'.bb-video-check-wrap [name="bb-video-select"]',this.addSelectedClassToWrapper.bind(this)),s(document).on("click","#bb-select-deselect-all-video",this.toggleSelectAllVideo.bind(this)),s(document).on("click",".video-action_list .edit_video",this.editVideo.bind(this)),s(document).on("click",".video-action_list .video-file-delete",this.deleteVideo.bind(this))},videoActivityActionButton:function(e){e.preventDefault(),s(e.currentTarget).closest(".bb-activity-video-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-video-elem").removeClass("is-visible"),s(e.currentTarget).closest(".bb-activity-video-elem").length<1&&s(e.currentTarget).closest(".bb-item-thumb").toggleClass("is-visible").parent().siblings().find(".bb-item-thumb").removeClass("is-visible").removeClass("is-visible"),"a"!=e.currentTarget.tagName.toLowerCase()||s(e.currentTarget).hasClass("video-action_more")||(s(e.currentTarget).closest(".bb-activity-video-elem").removeClass("is-visible"),s(e.currentTarget).closest(".bb-item-thumb").removeClass("is-visible"))},toggleSelectAllVideo:function(e){e.preventDefault(),s(e.currentTarget).hasClass("selected")?(s(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllVideo(e)):(s(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllVideo(e)),s(e.currentTarget).toggleClass("selected")},selectAllVideo:function(e){e.preventDefault(),s("#buddypress").find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){s(this).prop("checked",!0),s(this).closest(".bb-item-thumb").addClass("selected"),s(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllVideo:function(e){e.preventDefault(),s("#buddypress").find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){s(this).prop("checked",!1),s(this).closest(".bb-item-thumb").removeClass("selected"),s(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},addSelectedClassToWrapper:function(e){var i,t=e.currentTarget;s(t).is(":checked")?(s(t).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),s(t).closest(".bb-item-thumb").addClass("selected")):(s(t).closest(".bb-item-thumb").removeClass("selected"),s(t).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select),(i=s(".bp-nouveau #bb-select-deselect-all-video")).hasClass("selected")&&i.removeClass("selected"))},submitVideo:function(t){var e,i,o,d=this,a=s(t.currentTarget),n=s("#bb-video-privacy");if(t.preventDefault(),a.hasClass("saving"))return!1;a.addClass("saving"),"bp-video-dropzone-content"===d.current_tab?(e=s("#bp-video-post-content").val(),i={action:"video_save",_wpnonce:BP_Nouveau.nonces.video,videos:d.dropzone_video,content:e,album_id:d.video_album_id,group_id:d.video_group_id,privacy:n.val()},s("#bp-video-dropzone-content .bp-feedback").remove(),s.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){if(e.success){s("#video-stream ul.video-list").length||(s("#video-stream").html(s("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),s(".bb-videos-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend");for(var i=0;i<d.dropzone_video.length;i++)d.dropzone_video[i].saved=!0;d.closeUploader(t),jQuery(window).scroll()}else s("#bp-video-dropzone-content").prepend(e.data.feedback);a.removeClass("saving")}})):"bp-existing-video-content"===d.current_tab?(o=[],s('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){o.push(s(this).val())}),i={action:"video_move_to_album",_wpnonce:BP_Nouveau.nonces.video,medias:o,album_id:d.video_album_id,group_id:d.video_group_id},s("#bp-existing-video-content .bp-feedback").remove(),s.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(s("#video-stream ul.media-list").length||(s("#video-stream").html(s("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),s(".bb-video-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend"),s('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){s(this).closest("li").data("id")===s(this).val()&&s(this).closest("li").remove()}),jQuery(window).scroll(),d.closeUploader(t)):s("#bp-existing-video-content").prepend(e.data.feedback),a.removeClass("saving")}})):d.current_tab||(d.closeUploader(t),a.removeClass("saving"))},clearFolderLocationUI:function(e){var i=jQuery(e.currentTarget).closest(".has-folderlocationUI");0<i.length&&(i.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),i.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),i.find(".location-folder-title").text(BP_Nouveau.media.target_text),i.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0"),i.find(".ac_document_search_folder").val(""),i.find(".bb-model-header h4 span").text("..."),i.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show())},openUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&s("div#video-uploader").length&&(s("#bp-video-uploader").show(),t.video_dropzone_obj=new Dropzone("div#video-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),t.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){t.video_dropzone_obj.getAcceptedFiles().length&&s("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&s(e.previewElement).find(".dz-error-message span").text(i.data.feedback):this.removeFile(e)}),t.video_dropzone_obj.on("queuecomplete",function(){s("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),t.video_dropzone_obj.on("processing",function(){s("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),t.video_dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.saved=!1,t.dropzone_video.push(i.data)):this.removeFile(e),s("#bp-video-submit").show(),s("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),s("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video.length)for(var i in t.dropzone_video)if(e.upload.uuid==t.dropzone_video[i].uuid){void 0===t.dropzone_video[i].saved||t.dropzone_video[i].saved||t.removeAttachment(t.dropzone_video[i].id),t.dropzone_video.splice(i,1);break}t.video_dropzone_obj.getAcceptedFiles().length?s("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show():(s("#bp-video-uploader-modal-status-text").text(""),s("#bp-video-submit").hide())}))},closeUploader:function(e){e.preventDefault(),s("#bp-video-uploader").hide(),s("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload),s("#bp-video-uploader-modal-status-text").text(""),this.video_dropzone_obj.destroy(),this.dropzone_video=[]},toggle_video_uploader:function(){this.open_video_uploader()},open_video_uploader:function(){if(this.$el.find("#activity-post-media-uploader").hasClass("open"))return!1},editVideo:function(e){e.preventDefault(),console.log("Open Edit Popup here")},deleteVideo:function(e){e.preventDefault(),confirm("Are you sure you want to delete this video?")&&console.log("Delete Video")}},bp.Nouveau.Video.start(),bp.Nouveau.Video.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.videos=[],this.current_video=!1,this.current_video_index=0,this.is_open_video=!1,this.nextVideoLink=s(".bb-next-video"),this.previousVideoLink=s(".bb-prev-video"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id},addListeners:function(){s(document).on("click",".bb-open-video-theatre",this.openTheatre.bind(this)),s(document).on("click",".bb-prev-media",this.previous.bind(this)),s(document).on("click",".bb-next-media",this.next.bind(this))},openTheatre:function(e){e.preventDefault();var i,t=s(e.currentTarget),o=this;if(t.closest("#bp-existing-video-content").length)return!1;o.setupGlobals(),o.setVideos(t),i=t.data("id"),o.setCurrentVideo(i),o.showVideo(),o.navigationCommands(),void 0!==BP_Nouveau.activity&&o.current_video&&void 0!==o.current_video.activity_id&&0!=o.current_video.activity_id&&!o.current_video.is_forum?o.getActivity():o.getVideosDescription(),s(".bb-media-model-wrapper.document").hide(),s(".bb-media-model-wrapper.video").show(),o.is_open_video=!0},setVideos:function(e){var i=s(".bb-open-video-theatre"),t=0;if(s("body").hasClass("activity")&&(i=s(e).closest(".bb-activity-video-wrap").find(".bb-open-video-theatre")),void 0!==i)for(this.videos=[],t=0;t<i.length;t++){var o,d=s(i[t]);d.closest("#bp-existing-media-content").length||(o={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),attachment_id:d.data("attachment-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),is_forum:!1},d.closest(".forums-media-wrap").length&&(o.is_forum=!0),void 0!==o.privacy&&"message"==o.privacy?o.is_message=!0:o.is_message=!1,this.videos.push(o))}},setCurrentVideo:function(e){for(var i=this,t=0,t=0;t<i.videos.length;t++)if(e===i.videos[t].id){i.current_video=i.videos[t],i.current_index=t;break}},showVideo:function(){var e=this;if(void 0===e.current_video)return!1;s(".bb-media-model-wrapper.video .bb-media-section").find("img").attr("src",e.current_video.attachment);var i,t=s(".bb-media-section .bb-media-privacy-wrap");t.length&&(t.show(),t.find("ul.media-privacy li").removeClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",""),(i=t.find("ul.media-privacy").find("li[data-value="+e.current_video.privacy+"]")).addClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",i.text()),t.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_video.privacy),(void 0!==BP_Nouveau.activity&&void 0!==e.current_video.activity_id&&0!=e.current_video.activity_id||e.group_id||e.current_video.is_forum||e.current_video.group_id||e.current_video.album_id||e.current_video.is_message)&&t.hide()),e.navigationCommands()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.videos.length-1?(e.previousVideoLink.hide(),e.nextVideoLink.show()):0==e.current_index&&e.current_index==e.videos.length-1?(e.previousVideoLink.hide(),e.nextVideoLink.hide()):e.current_index==e.videos.length-1?(e.previousVideoLink.show(),e.nextVideoLink.hide()):(e.previousVideoLink.show(),e.nextVideoLink.show())},next:function(e){e.preventDefault();var i,t=this;t.resetRemoveActivityCommentsData(),void 0!==t.videos[t.current_index+1]?(t.current_index=t.current_index+1,i=t.current_video.activity_id,t.current_video=t.videos[t.current_index],t.showVideo(),i!=t.current_video.activity_id?t.getActivity():t.getMediasDescription()):t.nextLink.hide()},previous:function(e){e.preventDefault();var i,t=this;t.resetRemoveActivityCommentsData(),void 0!==t.videos[t.current_index-1]?(t.current_index=t.current_index-1,i=t.current_video.activity_id,t.current_video=t.videos[t.current_index],t.showVideo(),i!=t.current_video.activity_id?t.getActivity():t.getMediasDescription()):t.previousLink.hide()},resetRemoveActivityCommentsData:function(){var e=this,i=!1,t=!1,o=!1,d=!1,a=!1,n=!1;e.current_video.parent_activity_comments&&((i=(d=s('.bb-media-model-wrapper.video [data-bp-activity-id="'+e.current_video.activity_id+'"]')).find(".activity-comments")).length&&(a=i.html(),n=i.attr("class"),i.remove(),(i=s('[data-bp-activity-id="'+e.current_video.activity_id+'"] .activity-comments')).length&&(i.html(a),i.attr("class",n))),(o=d.find(".activity-state")).length&&(a=o.html(),n=o.attr("class"),o.remove(),(o=s('[data-bp-activity-id="'+e.current_video.activity_id+'"] .activity-state')).length&&(o.html(a),o.attr("class",n))),(t=d.find(".activity-meta")).length&&(a=t.html(),n=t.attr("class"),t.remove(),(t=s('[data-bp-activity-id="'+e.current_video.activity_id+'"] .activity-meta')).length&&(t.html(a),t.attr("class",n))),d.remove())},getActivity:function(){var e,i=this;s(".bb-video-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),void 0!==BP_Nouveau.activity&&i.current_video&&void 0!==i.current_video.activity_id&&0!=i.current_video.activity_id&&!i.current_video.is_forum?(0!=i.activity_ajax&&i.activity_ajax.abort(),s(".bb-media-info-section.media").show(),(e=s('[data-bp-activity-id="'+i.current_video.activity_id+'"] .activity-comments')).length&&(i.current_video.parent_activity_comments=!0,e.html("")),i.activity_ajax=s.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_get_activity",id:i.current_video.activity_id,group_id:_.isUndefined(i.current_video.group_id)?0:i.current_video.group_id,video_id:_.isUndefined(i.current_video.id)?0:i.current_video.id,nonce:BP_Nouveau.nonces.video},success:function(e){e.success&&(s(".bb-media-model-wrapper.video .bb-media-section").find("figure").html(e.data.video_data),s(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity),s(".bb-media-info-section:visible").show(),jQuery(window).scroll())}})):s(".bb-media-info-section.media").hide()}},bp.Nouveau.Video.Theatre.start(),bp.Nouveau.Video.Player={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){bp.Nouveau.Video.Player.openPlayer(),s(window).on("scroll resize",function(){bp.Nouveau.Video.Player.openPlayer()})},addListeners:function(){s(document).on("click",".video-js",this.openPlayer.bind(this))},openPlayer:function(){s(".video-js:not(.loaded)").each(function(){videojs(this,{},function(){this.on("ended",function(){})}),s(this).addClass("loaded")})}},bp.Nouveau.Video.Player.start())}((bp,jQuery));