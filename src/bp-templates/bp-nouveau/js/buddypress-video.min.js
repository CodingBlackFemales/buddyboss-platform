window.bp=window.bp||{},function(t){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Video={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.video_dropzone_obj=[],this.dropzone_video=[],this.video_album_id=void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,this.video_group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType},void 0!==BP_Nouveau.video.dropzone_options&&Object.assign(this.options,BP_Nouveau.video.dropzone_options)},addListeners:function(){t(document).on("click","#bp-add-video",this.openUploader.bind(this))},openUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&t("div#video-uploader").length&&(t("#bp-video-uploader").show(),i.video_dropzone_obj=new Dropzone("div#video-uploader",i.videoOptions),i.video_dropzone_obj.on("sending",function(e,o,i){i.append("action","video_upload"),i.append("_wpnonce",BP_Nouveau.nonces.video)}),i.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){i.video_dropzone_obj.getAcceptedFiles().length&&t("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.video_dropzone_obj.on("error",function(e,o){e.accepted?void 0!==o&&void 0!==o.data&&void 0!==o.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(o.data.feedback):this.removeFile(e)}),i.video_dropzone_obj.on("queuecomplete",function(){t("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),i.video_dropzone_obj.on("processing",function(){t("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),i.video_dropzone_obj.on("success",function(e,o){o.data.id?(e.id=o.id,o.data.uuid=e.upload.uuid,o.data.menu_order=i.dropzone_media.length,o.data.album_id=i.video_album_id,o.data.group_id=i.video_group_id,o.data.saved=!1,i.dropzone_video.push(o.data)):this.removeFile(e),t("#bp-video-submit").show(),t("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),t("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show()}),i.video_dropzone_obj.on("removedfile",function(e){if(i.dropzone_video.length)for(var o in i.dropzone_video)if(e.upload.uuid==i.dropzone_video[o].uuid){void 0===i.dropzone_video[o].saved||i.dropzone_video[o].saved||i.removeAttachment(i.dropzone_video[o].id),i.dropzone_video.splice(o,1);break}i.video_dropzone_obj.getAcceptedFiles().length?t("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show():(t("#bp-video-uploader-modal-status-text").text(""),t("#bp-video-submit").hide())}))}},bp.Nouveau.Video.start(),bp.Nouveau.Video.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.videos=[],this.current_video=!1,this.current_video_index=0,this.is_open_video=!1,this.nextVideoLink=t(".bb-next-video"),this.previousVideoLink=t(".bb-prev-video"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id},addListeners:function(){t(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this))},openTheatre:function(e){e.preventDefault();var o,i=t(e.currentTarget),d=this;if(i.closest("#bp-existing-media-content").length)return!1;d.setupGlobals(),d.setMedias(i),o=i.data("id"),d.setCurrentMedia(o),d.showMedia(),d.navigationCommands(),void 0!==BP_Nouveau.activity&&d.current_media&&void 0!==d.current_media.activity_id&&0!=d.current_media.activity_id&&!d.current_media.is_forum?d.getActivity():d.getMediasDescription(),t(".bb-media-model-wrapper.document").hide(),t(".bb-media-model-wrapper.media").show(),d.is_open_media=!0}},bp.Nouveau.Video.Theatre.start())}((bp,jQuery));