window.bp=window.bp||{},function(r){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Video={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.video_dropzone_obj=[],this.dropzone_video=[],this.video_album_id=void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,this.video_group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType},void 0!==BP_Nouveau.video.dropzone_options&&Object.assign(this.options,BP_Nouveau.video.dropzone_options)},addListeners:function(){r(document).on("click","#bp-add-video",this.openUploader.bind(this))},openUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&r("div#video-uploader").length&&(r("#bp-video-uploader").show(),i.video_dropzone_obj=new Dropzone("div#video-uploader",i.videoOptions),i.video_dropzone_obj.on("sending",function(e,t,i){i.append("action","video_upload"),i.append("_wpnonce",BP_Nouveau.nonces.video)}),i.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){i.video_dropzone_obj.getAcceptedFiles().length&&r("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.video_dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&r(e.previewElement).find(".dz-error-message span").text(t.data.feedback):this.removeFile(e)}),i.video_dropzone_obj.on("queuecomplete",function(){r("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),i.video_dropzone_obj.on("processing",function(){r("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),i.video_dropzone_obj.on("success",function(e,t){t.data.id?(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=i.dropzone_media.length,t.data.album_id=i.video_album_id,t.data.group_id=i.video_group_id,t.data.saved=!1,i.dropzone_video.push(t.data)):this.removeFile(e),r("#bp-video-submit").show(),r("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),r("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show()}),i.video_dropzone_obj.on("removedfile",function(e){if(i.dropzone_video.length)for(var t in i.dropzone_video)if(e.upload.uuid==i.dropzone_video[t].uuid){void 0===i.dropzone_video[t].saved||i.dropzone_video[t].saved||i.removeAttachment(i.dropzone_video[t].id),i.dropzone_video.splice(t,1);break}i.video_dropzone_obj.getAcceptedFiles().length?r("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,i.dropzone_video.length,i.video_dropzone_obj.getAcceptedFiles().length)).show():(r("#bp-video-uploader-modal-status-text").text(""),r("#bp-video-submit").hide())}))}},bp.Nouveau.Video.start(),bp.Nouveau.Video.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.videos=[],this.current_video=!1,this.current_video_index=0,this.is_open_video=!1,this.nextVideoLink=r(".bb-next-video"),this.previousVideoLink=r(".bb-prev-video"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id},addListeners:function(){r(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this)),r(document).on("click",".bb-open-document-theatre",this.openDocumentTheatre.bind(this)),r(document).on("click",".document-detail-wrap-description-popup",this.openDocumentTheatre.bind(this)),r(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),r(document).on("click",".bb-close-document-theatre",this.closeDocumentTheatre.bind(this)),r(document).on("click",".bb-prev-media",this.previous.bind(this)),r(document).on("click",".bb-next-media",this.next.bind(this)),r(document).on("click",".bb-prev-document",this.previousDocument.bind(this)),r(document).on("click",".bb-next-document",this.nextDocument.bind(this)),r(document).on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this)),r(document).on("click","#bb-media-model-container .media-privacy>li",this.mediaPrivacyChange.bind(this)),r(document).on("click","#bb-media-model-container .bb-media-section span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),r(document).on("click",".bp-add-media-activity-description",this.openMediaActivityDescription.bind(this)),r(document).on("click","#bp-activity-description-new-reset",this.closeMediaActivityDescription.bind(this)),r(document).on("click","#bp-activity-description-new-submit",this.submitMediaActivityDescription.bind(this)),r(document).click(this.togglePopupDropdown),document.addEventListener("keyup",this.checkPressedKeyDocuments.bind(this)),document.addEventListener("keyup",this.checkPressedKey.bind(this))},checkPressedKey:function(e){var t=this;if(e=e||window.event,!t.is_open_media)return!1;var i=r("#add-activity-description").length&&r("#add-activity-description").is(":focus")||r(".ac-reply-content .ac-textarea > .ac-input").length&&r(".ac-reply-content .ac-textarea > .ac-input").hasClass("focus-visible");switch(e.keyCode){case 27:t.closeTheatre(e);break;case 37:if(void 0===t.medias[t.current_index-1]||i)return!1;t.previous(e);break;case 39:if(void 0===t.medias[t.current_index+1]||i)return!1;t.next(e)}},checkPressedKeyDocuments:function(e){e=e||window.event;var t=this;if(!t.is_open_document)return!1;var i=r("#add-activity-description").length&&r("#add-activity-description").is(":focus")||r(".ac-reply-content .ac-textarea > .ac-input").length&&r(".ac-reply-content .ac-textarea > .ac-input").hasClass("focus-visible");switch(e.keyCode){case 27:t.closeDocumentTheatre(e);break;case 37:if(void 0===t.documents[t.current_document_index-1]||i)return!1;t.previousDocument(e);break;case 39:if(void 0===t.documents[t.current_document_index+1]||i)return!1;t.nextDocument(e)}},openTheatre:function(e){e.preventDefault();var t,i=r(e.currentTarget),a=this;if(i.closest("#bp-existing-media-content").length)return!1;a.setupGlobals(),a.setMedias(i),t=i.data("id"),a.setCurrentMedia(t),a.showMedia(),a.navigationCommands(),void 0!==BP_Nouveau.activity&&a.current_media&&void 0!==a.current_media.activity_id&&0!=a.current_media.activity_id&&!a.current_media.is_forum?a.getActivity():a.getMediasDescription(),r(".bb-media-model-wrapper.document").hide(),r(".bb-media-model-wrapper.media").show(),a.is_open_media=!0},getMediasDescription:function(){var e=this;r(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),0!=e.activity_ajax&&e.activity_ajax.abort(),e.activity_ajax=r.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_media_description",id:e.current_media.id,attachment_id:e.current_media.attachment_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success?(r(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),r(".bb-media-info-section:visible").show(),r(window).scroll()):r(".bb-media-info-section.media").hide()}})},openDocumentTheatre:function(e){e.preventDefault();var t,i=r(e.currentTarget),a=this;if(i.closest("#bp-existing-document-content").length)return!1;i.closest(".document.document-theatre").length&&a.closeDocumentTheatre(e),t=i.data("id"),a.setupGlobals(),a.setDocuments(i),a.setCurrentDocument(t),a.showDocument(),a.navigationDocumentCommands(),void 0!==BP_Nouveau.activity&&a.current_document&&void 0!==a.current_document.activity_id&&0!=a.current_document.activity_id&&!a.current_document.is_forum?a.getDocumentsActivity():a.getDocumentsDescription(),-1!==r.inArray(a.current_document.extension,BP_Nouveau.document.mp3_preview_extension.split(","))&&r(e.currentTarget).closest(".bb-activity-media-elem.document-activity").length&&r(e.currentTarget).closest(".bb-activity-media-elem.document-activity").find(".document-audio-wrap").length&&r(e.currentTarget).closest(".bb-activity-media-elem.document-activity").find(".document-audio-wrap audio")[0].pause(),r(".bb-media-model-wrapper.media").hide(),r(".bb-media-model-wrapper.document").show(),a.is_open_document=!0},resetRemoveActivityCommentsData:function(){var e=this,t=!1,i=!1,a=!1,n=!1,d=!1,o=!1;e.current_media.parent_activity_comments&&((t=(n=r('.bb-media-model-wrapper.media [data-bp-activity-id="'+e.current_media.activity_id+'"]')).find(".activity-comments")).length&&(d=t.html(),o=t.attr("class"),t.remove(),(t=r('[data-bp-activity-id="'+e.current_media.activity_id+'"] .activity-comments')).length&&(t.html(d),t.attr("class",o))),(a=n.find(".activity-state")).length&&(d=a.html(),o=a.attr("class"),a.remove(),(a=r('[data-bp-activity-id="'+e.current_media.activity_id+'"] .activity-state')).length&&(a.html(d),a.attr("class",o))),(i=n.find(".activity-meta")).length&&(d=i.html(),o=i.attr("class"),i.remove(),(i=r('[data-bp-activity-id="'+e.current_media.activity_id+'"] .activity-meta')).length&&(i.html(d),i.attr("class",o))),n.remove()),e.current_document.parent_activity_comments&&((t=(n=r('.bb-media-model-wrapper.document [data-bp-activity-id="'+e.current_document.activity_id+'"]')).find(".activity-comments")).length&&(d=t.html(),o=t.attr("class"),t.remove(),(t=r('[data-bp-activity-id="'+e.current_document.activity_id+'"] .activity-comments')).length&&(t.html(d),t.attr("class",o),t.find(".document-text.loaded").removeClass("loaded").find(".CodeMirror").remove(),jQuery(window).scroll())),(a=n.find(".activity-state")).length&&(d=a.html(),o=a.attr("class"),a.remove(),(a=r('[data-bp-activity-id="'+e.current_document.activity_id+'"] .activity-state')).length&&(a.html(d),a.attr("class",o))),(i=n.find(".activity-meta")).length&&(d=i.html(),o=i.attr("class"),i.remove(),(i=r('[data-bp-activity-id="'+e.current_document.activity_id+'"] .activity-meta')).length&&(i.html(d),i.attr("class",o))),n.remove())},closeTheatre:function(e){e.preventDefault();var t=this;r(".bb-media-model-wrapper").hide(),t.is_open_media=!1,t.resetRemoveActivityCommentsData(),t.current_media=!1},closeDocumentTheatre:function(e){e.preventDefault();var t=this,i=r(document).find(".document-theatre");i.find(".bb-media-section").removeClass("bb-media-no-preview").find(".document-preview").html(""),r(".bb-media-info-section.document").show(),i.hide(),t.is_open_document=!1,t.resetRemoveActivityCommentsData(),t.current_document=!1},setMedias:function(e){var t=r(".bb-open-media-theatre"),i=0;if(r("body").hasClass("activity")&&(t=r(e).closest(".bb-activity-media-wrap").find(".bb-open-media-theatre")),void 0!==t)for(this.medias=[],i=0;i<t.length;i++){var a,n=r(t[i]);n.closest("#bp-existing-media-content").length||(a={id:n.data("id"),attachment:n.data("attachment-full"),activity_id:n.data("activity-id"),attachment_id:n.data("attachment-id"),privacy:n.data("privacy"),parent_activity_id:n.data("parent-activity-id"),album_id:n.data("album-id"),group_id:n.data("group-id"),is_forum:!1},n.closest(".forums-media-wrap").length&&(a.is_forum=!0),void 0!==a.privacy&&"message"==a.privacy?a.is_message=!0:a.is_message=!1,this.medias.push(a))}},setDocuments:function(e){var t=r(".bb-open-document-theatre"),i=0;if(r(e).closest(".bp-search-ac-header").length?t=r(e).closest(".bp-search-ac-header").find(".bb-open-document-theatre"):r("body").hasClass("activity")&&0===r(e).closest(".search-document-list").length&&(t=r(e).closest(".bb-activity-media-wrap").find(".bb-open-document-theatre")),void 0!==t)for(this.documents=[],i=0;i<t.length;i++){var a,n=r(t[i]);t.closest("#bp-existing-document-content").length||(a={id:n.data("id"),attachment:n.data("attachment-full"),activity_id:n.data("activity-id"),attachment_id:n.data("attachment-id"),privacy:n.data("privacy"),parent_activity_id:n.data("parent-activity-id"),album_id:n.data("album-id"),group_id:n.data("group-id"),extension:n.data("extension"),target_text:n.data("document-title"),preview:n.data("preview"),text_preview:n.data("text-preview"),mirror_text:n.data("mirror-text"),target_icon_class:n.data("icon-class"),author:n.data("author"),download:n.attr("href"),mp3:n.data("mp3-preview"),is_forum:!1},n.closest(".forums-media-wrap").length&&(a.is_forum=!0),void 0!==a.privacy&&"message"==a.privacy?a.is_message=!0:a.is_message=!1,this.documents.push(a))}},setCurrentMedia:function(e){for(var t=this,i=0,i=0;i<t.medias.length;i++)if(e===t.medias[i].id){t.current_media=t.medias[i],t.current_index=i;break}},setCurrentDocument:function(e){for(var t=this,i=0,i=0;i<t.documents.length;i++)if(e===t.documents[i].id){t.current_document=t.documents[i],t.current_document_index=i;break}},showMedia:function(){var e=this;if(void 0===e.current_media)return!1;r(".bb-media-model-wrapper.media .bb-media-section").find("img").attr("src",e.current_media.attachment);var t,i=r(".bb-media-section .bb-media-privacy-wrap");i.length&&(i.show(),i.find("ul.media-privacy li").removeClass("selected"),i.find(".bp-tooltip").attr("data-bp-tooltip",""),(t=i.find("ul.media-privacy").find("li[data-value="+e.current_media.privacy+"]")).addClass("selected"),i.find(".bp-tooltip").attr("data-bp-tooltip",t.text()),i.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_media.privacy),(void 0!==BP_Nouveau.activity&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id||e.group_id||e.current_media.is_forum||e.current_media.group_id||e.current_media.album_id||e.current_media.is_message)&&i.hide()),e.navigationCommands()},showDocument:function(){var e=this;if(void 0===e.current_document)return!1;var t=e.current_document.target_text,i=e.current_document.target_icon_class,a=r(document).find(".document-theatre"),n=e.current_document.extension,d=e.current_document.mirror_text;-1!==r.inArray(e.current_document.extension,["css","txt","js","html","htm","csv"])?(a.find(".bb-document-section .document-preview").html('<i class="bb-icon-loader animate-spin"></i>'),a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html("<h3>"+t+'</h3><div class="document-text"><textarea class="document-text-file-data-hidden"></textarea></div>'),a.find(".bb-document-section .document-preview .document-text").attr("data-extension",n),a.find(".bb-document-section .document-preview .document-text textarea").html(d.replace("n","")),setTimeout(function(){bp.Nouveau.Media.documentCodeMirror()},1e3)):-1!==r.inArray(e.current_document.extension,BP_Nouveau.document.mp3_preview_extension.split(","))?(a.find(".bb-document-section .document-preview").html('<i class="bb-icon-loader animate-spin"></i>'),a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html('<div class="img-section"><h3>'+t+'</h3><div class="document-audio"><audio src="'+e.current_document.mp3+'" controls controlsList="nodownload"></audio></div></div>')):e.current_document.preview?(a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html("<h3>"+t+'</h3><div class="img-section"><div class="img-block-wrap"> <img src="'+e.current_document.preview+'" /></div></div>')):(a.find(".bb-document-section").addClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html('<div class="img-section"> <i class="'+i+'"></i><p>'+t+"</p></div>"));var o,c=r(".bb-media-section .bb-media-privacy-wrap");c.length&&(c.show(),c.find("ul.media-privacy li").removeClass("selected"),c.find(".bp-tooltip").attr("data-bp-tooltip",""),(o=c.find("ul.media-privacy").find("li[data-value="+e.current_document.privacy+"]")).addClass("selected"),c.find(".bp-tooltip").attr("data-bp-tooltip",o.text()),c.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_document.privacy),(void 0!==BP_Nouveau.activity&&void 0!==e.current_document.activity_id&&0!=e.current_document.activity_id||e.group_id||e.current_document.is_forum||e.current_document.group_id||e.current_document.album_id||e.current_document.is_message)&&c.hide()),e.navigationDocumentCommands()},next:function(e){e.preventDefault();var t,i=this;i.resetRemoveActivityCommentsData(),void 0!==i.medias[i.current_index+1]?(i.current_index=i.current_index+1,t=i.current_media.activity_id,i.current_media=i.medias[i.current_index],i.showMedia(),t!=i.current_media.activity_id?i.getActivity():i.getMediasDescription()):i.nextLink.hide()},previous:function(e){e.preventDefault();var t,i=this;i.resetRemoveActivityCommentsData(),void 0!==i.medias[i.current_index-1]?(i.current_index=i.current_index-1,t=i.current_media.activity_id,i.current_media=i.medias[i.current_index],i.showMedia(),t!=i.current_media.activity_id?i.getActivity():i.getMediasDescription()):i.previousLink.hide()},nextDocument:function(e){e.preventDefault();var t,i=this;i.resetRemoveActivityCommentsData(),void 0!==i.documents[i.current_document_index+1]?(i.current_document_index=i.current_document_index+1,t=i.current_document.activity_id,i.current_document=i.documents[i.current_document_index],i.showDocument(),t!=i.current_document.activity_id?i.getDocumentsActivity():i.getDocumentsDescription()):i.nextDocumentLink.hide()},previousDocument:function(e){e.preventDefault();var t,i=this;i.resetRemoveActivityCommentsData(),void 0!==i.documents[i.current_document_index-1]?(i.current_document_index=i.current_document_index-1,t=i.current_document.activity_id,i.current_document=i.documents[i.current_document_index],i.showDocument(),t!=i.current_document.activity_id?i.getDocumentsActivity():i.getDocumentsDescription()):i.previousDocumentLink.hide()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.medias.length-1?(e.previousLink.hide(),e.nextLink.show()):0==e.current_index&&e.current_index==e.medias.length-1?(e.previousLink.hide(),e.nextLink.hide()):e.current_index==e.medias.length-1?(e.previousLink.show(),e.nextLink.hide()):(e.previousLink.show(),e.nextLink.show())},navigationDocumentCommands:function(){var e=this;0==e.current_document_index&&e.current_document_index!=e.documents.length-1?(e.previousDocumentLink.hide(),e.nextDocumentLink.show()):0==e.current_document_index&&e.current_document_index==e.documents.length-1?(e.previousDocumentLink.hide(),e.nextDocumentLink.hide()):e.current_document_index==e.documents.length-1?(e.previousDocumentLink.show(),e.nextDocumentLink.hide()):(e.previousDocumentLink.show(),e.nextDocumentLink.show())},getActivity:function(){var e,t=this;r(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),void 0!==BP_Nouveau.activity&&t.current_media&&void 0!==t.current_media.activity_id&&0!=t.current_media.activity_id&&!t.current_media.is_forum?(0!=t.activity_ajax&&t.activity_ajax.abort(),(e=r('[data-bp-activity-id="'+t.current_media.activity_id+'"] .activity-comments')).length&&(t.current_media.parent_activity_comments=!0,e.html("")),t.activity_ajax=r.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_activity",id:t.current_media.activity_id,group_id:_.isUndefined(t.current_media.group_id)?0:t.current_media.group_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(r(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity),r(".bb-media-info-section:visible").show(),jQuery(window).scroll())}})):r(".bb-media-info-section.media").hide()},getDocumentsActivity:function(){var e,t=this;r(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),void 0!==BP_Nouveau.activity&&t.current_document&&void 0!==t.current_document.activity_id&&0!=t.current_document.activity_id&&!t.current_document.is_forum?(0!=t.activity_ajax&&t.activity_ajax.abort(),(e=r('[data-bp-activity-id="'+t.current_document.activity_id+'"] .activity-comments')).length&&(t.current_document.parent_activity_comments=!0,e.html("")),t.activity_ajax=r.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_get_activity",id:t.current_document.activity_id,group_id:_.isUndefined(t.current_document.group_id)?0:t.current_document.group_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(r(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity),r(".bb-media-info-section:visible").show(),jQuery(window).scroll())}})):r(".bb-media-info-section.document").hide()},getDocumentsDescription:function(){var e=this;r(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),0!=e.activity_ajax&&e.activity_ajax.abort(),e.activity_ajax=r.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_get_document_description",id:e.current_document.id,attachment_id:e.current_document.attachment_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success?(r(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),r(".bb-media-info-section:visible").show(),r(window).scroll()):r(".bb-media-info-section.document").hide()}})},activityDeleted:function(e,t){var i=this,a=0;if(i.is_open_media&&void 0!==t&&"delete_activity"===t.action&&i.current_media.activity_id==t.id){for(r(document).find('[data-bp-list="media"] .bb-open-media-theatre[data-id="'+i.current_media.id+'"]').closest("li").remove(),r(document).find('[data-bp-list="activity"] .bb-open-media-theatre[data-id="'+i.current_media.id+'"]').closest(".bb-activity-media-elem").remove(),a=0;a<i.medias.length;a++)if(i.medias[a].activity_id==t.id){i.medias.splice(a,1);break}0==i.current_index&&i.current_index!=i.medias.length?(i.current_index=-1,i.next(e)):0==i.current_index&&i.current_index==i.medias.length?(r(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+i.current_media.activity_id+'"]').remove(),i.closeTheatre(e)):i.current_index==i.medias.length?i.previous(e):(i.current_index=-1,i.next(e))}if(i.is_open_document&&void 0!==t&&"delete_activity"===t.action&&i.current_document.activity_id==t.id){for(r(document).find('[data-bp-list="document"] .bb-open-document-theatre[data-id="'+i.current_document.id+'"]').closest('div.ac-document-list[data-activity-id="'+i.current_document.activity_id+'"]').remove(),r(document).find('[data-bp-list="activity"] .bb-open-document-theatre[data-id="'+i.current_document.id+'"]').closest(".bb-activity-media-elem").remove(),a=0;a<i.documents.length;a++)if(i.documents[a].activity_id==t.id){i.documents.splice(a,1);break}0==i.current_document_index&&i.current_document_index!=i.documents.length?(i.current_document_index=-1,i.nextDocument(e)):0==i.current_document_index&&i.current_document_index==i.documents.length?(r(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+i.current_document.activity_id+'"]').remove(),i.closeDocumentTheatre(e)):i.current_document_index==i.documents.length?i.previousDocument(e):(i.current_document_index=-1,i.nextDocument(e))}},togglePopupDropdown:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||r(t).hasClass("privacy-wrap")||r(t).parent().hasClass("privacy-wrap")?e:void r("ul.media-privacy").removeClass("bb-open")},togglePrivacyDropdown:function(e){var t=r(e.target);e.preventDefault(),t.closest(".bb-media-privacy-wrap").find(".media-privacy").toggleClass("bb-open")},mediaPrivacyChange:function(e){var t,i=r(e.target),a=i.data("value");if(e.preventDefault(),i.hasClass("selected"))return!1;i.closest(".bb-media-privacy-wrap").find(".privacy").addClass("loading"),t=i.closest(".bb-media-privacy-wrap").find("ul.media-privacy li.selected").data("value"),i.closest(".bb-media-privacy-wrap").find("ul.media-privacy li").removeClass("selected"),i.addClass("selected"),r.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_update_privacy",id:this.current_media.id,_wpnonce:BP_Nouveau.nonces.media,privacy:a},success:function(){i.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading").removeClass(t),i.closest(".bb-media-privacy-wrap").find(".privacy").addClass(a),i.closest(".bb-media-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",i.text())},error:function(){i.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading")}})},openMediaActivityDescription:function(e){e.preventDefault();var t=r(e.currentTarget);if(t.parents(".activity-media-description").find(".bp-edit-media-activity-description").length<1)return!1;t.parents(".activity-media-description").find(".bp-edit-media-activity-description").show().addClass("open"),t.parents(".activity-media-description").find(".bp-media-activity-description").hide(),t.hide()},closeMediaActivityDescription:function(e){e.preventDefault();var t=r(e.currentTarget);if(t.parents(".activity-media-description").length<1)return!1;var i=t.parents(".activity-media-description").find("#add-activity-description").get(0).defaultValue;t.parents(".activity-media-description").find(".bp-add-media-activity-description").show(),t.parents(".activity-media-description").find(".bp-media-activity-description").show(),t.parents(".activity-media-description").find("#add-activity-description").val(i),t.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open")},submitMediaActivityDescription:function(e){e.preventDefault();var t=r(e.currentTarget),i=t.parents(".activity-media-description"),a={action:"media_description_save",description:i.find("#add-activity-description").val(),attachment_id:i.find("#bp-attachment-id").val(),_wpnonce:BP_Nouveau.nonces.media};r.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:a,async:!1,success:function(e){e.success?(t.parents(".activity-media-description").find(".bp-media-activity-description").html(e.data.description).show(),t.parents(".activity-media-description").find(".bp-add-media-activity-description").show(),i.find("#add-activity-description").val(e.data.description),i.find("#add-activity-description").get(0).defaultValue=e.data.description,""==e.data.description?t.parents(".activity-media-description").find(".bp-add-media-activity-description").removeClass("show-edit").addClass("show-add"):t.parents(".activity-media-description").find(".bp-add-media-activity-description").addClass("show-edit").removeClass("show-add"),t.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open"),t.parents(".activity-media-description").find(".bp-media-activity-description").show(),t.parents(".activity-media-description").find(".bp-feedback.error").remove()):t.parents(".activity-media-description").prepend(e.data.feedback)}})}},bp.Nouveau.Video.Theatre.start())}((bp,jQuery));