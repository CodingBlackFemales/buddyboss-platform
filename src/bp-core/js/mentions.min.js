window.bp=window.bp||{},function(e,t,n){var i,o,s=[];e.mentions=e.mentions||{},e.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(window.BP_Suggestions.friends&&window.BP_Suggestions.friends.length>0?e.mentions.users=window.BP_Suggestions.friends:window.BP_Suggestions.members&&window.BP_Suggestions.members.length>0?e.mentions.users=window.BP_Suggestions.members:e.mentions.users&&e.mentions.users.length>0&&(e.mentions.users=e.mentions.users)),e.mentions.xhr=null,e.mentions.xhr_scroll=null,t.fn.bp_mentions=function(n,a,r){t.isArray(n)&&(n={data:n}),a||(a={}),r||(r={});var l=navigator.userAgent.toLowerCase(),d=l.indexOf("android")>-1,u=l.indexOf("chrome")>-1,h=t.extend(!0,{},{delay:500,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:100,startWithSpace:!1,callbacks:{filter:function(e,t,n){var i,o,s,a=[],r=new RegExp("^"+e+"| "+e,"ig");for(o=0,s=t.length;o<s;o++)i=t[o],i[n].toLowerCase().match(r)&&a.push(i);return a},highlighter:function(e,t){if(!t)return e;var n=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+t.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return e.replace(n,function(e,t,n,i){return">"+t+"<strong>"+n+"</strong>"+i+"<"})},before_reposition:function(e){var n,i,o,s,a=t("#atwho-ground-"+this.id+" .atwho-view"),r=t("body"),l=this.$inputor.data("atwho");"undefined"!==l&&"undefined"!==l.iframe&&null!==l.iframe?(n=this.$inputor.caret("offset",{iframe:l.iframe}),o=t(l.iframe).offset(),"undefined"!==o&&(n.left+=o.left,n.top+=o.top)):n=this.$inputor.caret("offset"),n.left>r.width()/2?(a.addClass("right"),s=n.left-e.left-this.view.$el.width()):(a.removeClass("right"),s=n.left-e.left+1),r.width()<=400&&t(document).scrollTop(n.top-6),i=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10),(!i||i<5)&&(i=19),e.top=n.top+i,e.left+=s},inserting_wrapper:function(e,t){return""+t}}},a),c=t.extend(!0,{},{callbacks:{remoteFilter:function(n,o){var a={action:"bp_get_suggestions",term:n,type:"members"},r=this.$el,l=this,d=r.find("ul"),u=function(){if(d.scrollTop()+d.innerHeight()>=d[0].scrollHeight&&!0===l.allow_scroll){if(d.hasClass("list-loading")||null!=l.total_pages&&parseInt(l.total_pages)===parseInt(a.page)||e.mentions.xhr_scroll)return;d.addClass("list-loading"),d.find("li:last-child").hasClass("list-loader")||d.append('<li class="list-loader">Loading more results…</li>'),a.term=l.s_query,a.page=r.data("page")+1,r.data("page",a.page),e.mentions.xhr_scroll=t.getJSON(ajaxurl,a).done(function(n){if(n.success){e.mentions.xhr_scroll=null,void 0!==n.data.total_pages&&(l.total_pages=parseInt(n.data.total_pages)),s[l.s_query].page=a.page;var i=t.map(n.data.results,function(e){return e.search=e.search||e.ID+" "+e.name,e});if(0==i.length)return d.find(".list-loader").remove(),d.removeClass("list-loading"),void(l.allow_scroll=!1);l.data=l.data.concat(i),d.find(".list-loader").remove(),l.render_view(l.data),s[l.s_query].data=l.data,d.removeClass("list-loading")}})}};if(l.allow_scroll=!0,l.render_view=o,l.total_pages=1,l.s_query=n,r.data("page",1),e.mentions.xhr&&e.mentions.xhr.abort(),e.mentions.xhr_scroll&&e.mentions.xhr_scroll.abort(),i=s[n],"object"==typeof i&&i.data)return r.data("page",i.page),l.data=i.data,l.render_view(i.data),l.total_pages=i.total_pages,i.page<i.total_pages&&!d.find("li:last-child").hasClass("list-loader")&&d.append('<li class="list-loader">Loading more results…</li>'),e.mentions.xhr_scroll=null,void(r.hasClass("has-events")||(d.on("scroll",function(){u()}),r.addClass("has-events")));d.find("li:last-child").hasClass("list-loader")||d.append('<li class="list-loader">Loading more results…</li>'),r.data("page")?a.page=r.data("page"):(a.page=1,r.data("page",1)),t.isNumeric(this.$inputor.data("suggestions-group-id"))&&(a["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),e.mentions.xhr=t.getJSON(ajaxurl,a).done(function(i){if(i.success){s[n]={},s[n].page=a.page;var o=t.map(i.data.results,function(e){return e.search=e.search||e.ID+" "+e.name,e});void 0!==i.data.total_pages&&(l.total_pages=parseInt(i.data.total_pages),s[n].total_pages=parseInt(i.data.total_pages)),l.data=o,s[n].data=o,d.find(".list-loader").remove(),l.render_view(o),d.removeClass("list-loading"),l.$inputor.trigger("keyup"),e.mentions.xhr_scroll=null}}),r.hasClass("has-events")||(d.on("scroll",function(){u()}),r.addClass("has-events"))},sorter:function(e,t){return t},beforeReposition:function(e){if(t("body.rtl").length>0){var n=this.$el.find(".atwho-view");n.length>0&&(e.left=this.rect().left-n.width())}}},data:t.map(n.data,function(e){return e.search=e.search||e.ID+" "+e.name,e}),at:"@",searchKey:"search",startWithSpace:!0,displayTpl:BP_Mentions_Options.display_tpl},BP_Mentions_Options.extra_options,r);this.on("blur.atwhoInner",function(){jQuery("#atwho-ground-whats-new").data("page",1),jQuery("#atwho-ground-whats-new").find(".list-loader").remove(),jQuery("#atwho-ground-whats-new").find(".list-loading").removeClass("list-loading")}),this.on("inserted.atwho",function(e){if(u&&jQuery(this).on("keyup",function(e){if(o=e.keyCode,13===o){if(jQuery(this).hasClass("medium-editor-element")){var n=jQuery(this).attr("contenteditable");void 0!==n&&!1!==n&&jQuery(this).attr("contenteditable","false")}setTimeout(function(){t.each(BP_Mentions_Options.selectors,function(e,t){if(jQuery(t).hasClass("medium-editor-element")){var n=jQuery(t).attr("contenteditable");void 0!==n&&!1!==n&&(jQuery(t).attr("contenteditable","true"),jQuery(t).find(".atwho-inserted").closest(".medium-editor-element").focus())}})},10)}}),jQuery(this).on("keydown",function(e){d||(8==e.keyCode?jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}):jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).attr("contenteditable",!1)}))}),void 0!==e.currentTarget&&void 0!==e.currentTarget.innerHTML){var n=0;if(void 0!==window.forums_medium_reply_editor){var i=Object.keys(window.forums_medium_reply_editor);if(i.length)for(n=0;n<i.length;n++)window.forums_medium_reply_editor[i[n]].checkContentChanged()}if(void 0!==window.forums_medium_topic_editor){var s=Object.keys(window.forums_medium_topic_editor);if(s.length)for(n=0;n<s.length;n++)window.forums_medium_topic_editor[s[n]].checkContentChanged()}if(void 0!==window.forums_medium_forum_editor){var a=Object.keys(window.forums_medium_forum_editor);if(a.length)for(n=0;n<a.length;n++)window.forums_medium_forum_editor[a[n]].checkContentChanged()}}jQuery("#atwho-ground-whats-new").data("page",1),jQuery("#atwho-ground-whats-new").find(".list-loader").remove(),jQuery("#atwho-ground-whats-new").find(".list-loading").removeClass("list-loading"),jQuery(this).focus()}),this.on("keyup",function(){if(d){var e=jQuery(this).text().length;localStorage.setItem("charCount",e),jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")})}});var f=t.extend(!0,{},h,c,n);return t.fn.atwho.call(this,f)},t(document).ready(function(){localStorage.setItem("charCount",0),t(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){t(this).data("bp_mentions_activated")||void 0!==e&&(t(this).bp_mentions(e.mentions.users),t(this).data("bp_mentions_activated",!0))})}),e.mentions.tinyMCEinit=function(){void 0!==window.tinyMCE&&null!==window.tinyMCE.activeEditor&&void 0!==window.tinyMCE.activeEditor&&t(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",t(".wp-editor-wrap iframe")[0]).bp_mentions(e.mentions.users)}}(bp,jQuery);