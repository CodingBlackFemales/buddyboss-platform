window.bp=window.bp||{},function(a,d){var l,u=[];a.mentions=a.mentions||{},a.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(window.BP_Suggestions.friends&&0<window.BP_Suggestions.friends.length?a.mentions.users=window.BP_Suggestions.friends:window.BP_Suggestions.members&&0<window.BP_Suggestions.members.length?a.mentions.users=window.BP_Suggestions.members:a.mentions.users&&0<a.mentions.users.length&&(a.mentions.users=a.mentions.users)),a.mentions.xhr=null,d.fn.bp_mentions=function(e,t,i){d.isArray(e)&&(e={data:e}),t=t||{},i=i||{};var n=navigator.userAgent.toLowerCase(),s=-1<n.indexOf("android"),r=-1<n.indexOf("chrome"),t=d.extend(!0,{},{delay:500,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:100,startWithSpace:!1,callbacks:{filter:function(e,t,i){for(var n,o=[],s=new RegExp("^"+e+"| "+e,"ig"),r=0,a=t.length;r<a;r++)(n=t[r])[i].toLowerCase().match(s)&&o.push(n);return o},highlighter:function(e,t){if(!t)return e;t=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+t.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return e.replace(t,function(e,t,i,n){return">"+t+"<strong>"+i+"</strong>"+n+"<"})},before_reposition:function(e){var t,i=d("#atwho-ground-"+this.id+" .atwho-view"),n=d("body"),o=this.$inputor.data("atwho");"undefined"!==o&&"undefined"!==o.iframe&&null!==o.iframe?(t=this.$inputor.caret("offset",{iframe:o.iframe}),"undefined"!==(o=d(o.iframe).offset())&&(t.left+=o.left,t.top+=o.top)):t=this.$inputor.caret("offset"),i=t.left>n.width()/2?(i.addClass("right"),t.left-e.left-this.view.$el.width()):(i.removeClass("right"),t.left-e.left+1),n.width()<=400&&d(document).scrollTop(t.top-6),n=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10),e.top=t.top+(n=!n||n<5?19:n),e.left+=i},inserting_wrapper:function(e,t){return""+t}}},t),i=d.extend(!0,{},{callbacks:{remoteFilter:function(i,e){var t={},n=this.$el,o=this,s=n.find("ul");if(o.allow_scroll=!0,o.render_view=e,window.bp_suggestions_page_limit=null,"object"==typeof(l=u[i]))return n.data("page",1),o.data=l,void o.render_view(l);a.mentions.xhr&&a.mentions.xhr.abort(),t={action:"bp_get_suggestions",term:i,type:"members"},n.data("page")?(t.page=n.data("page"),n.data("page",t.page)):(t.page=1,n.data("page",1)),d.isNumeric(this.$inputor.data("suggestions-group-id"))&&(t["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),s.find("li:last-child").hasClass("list-loader")||s.append('<li class="list-loader">Loading more results…</li>'),a.mentions.xhr=d.getJSON(ajaxurl,t).done(function(e){var t;e.success&&(t=d.map(e.data.results,function(e){return e.search=e.search||e.ID+" "+e.name,e}),o.data=t,window.bp_suggestions_page_limit=e.data.total_pages,u[i]=t,s.find(".list-loader").remove(),o.render_view(t),s.removeClass("list-loading"))}),n.hasClass("has-events")||(s.on("scroll",function(){s.scrollTop()+s.innerHeight()>=s[0].scrollHeight&&!0===o.allow_scroll&&(s.hasClass("list-loading")||null!=window.bp_suggestions_page_limit&&window.bp_suggestions_page_limit==t.page||(s.addClass("list-loading"),s.find("li:last-child").hasClass("list-loader")||s.append('<li class="list-loader">Loading more results…</li>'),t.page=n.data("page")+1,n.data("page",t.page),a.mentions.xhr=d.getJSON(ajaxurl,t).done(function(e){if(e.success){e=d.map(e.data.results,function(e){return e.search=e.search||e.ID+" "+e.name,e});if(0==e.length)return s.find(".list-loader").remove(),s.removeClass("list-loading"),void(o.allow_scroll=!1);o.data=o.data.concat(e),s.find(".list-loader").remove(),o.render_view(o.data),s.removeClass("list-loading")}})))}),n.addClass("has-events"))},sorter:function(e,t){return t},beforeReposition:function(e){var t;0<d("body.rtl").length&&(0<(t=this.$el.find(".atwho-view")).length&&(e.left=this.rect().left-t.width()))}},data:d.map(e.data,function(e){return e.search=e.search||e.ID+" "+e.name,e}),at:"@",searchKey:"search",startWithSpace:!0,displayTpl:BP_Mentions_Options.display_tpl},BP_Mentions_Options.extra_options,i);this.on("blur.atwhoInner",function(){jQuery("#atwho-ground-whats-new").data("page",1),jQuery("#atwho-ground-whats-new").find(".list-loader").remove(),jQuery("#atwho-ground-whats-new").find(".list-loading").removeClass("list-loading"),window.bp_suggestions_page_limit=null}),this.on("inserted.atwho",function(e){if(r&&jQuery(this).on("keyup",function(e){13===e.keyCode&&(!jQuery(this).hasClass("medium-editor-element")||void 0!==(e=jQuery(this).attr("contenteditable"))&&!1!==e&&jQuery(this).attr("contenteditable","false"),setTimeout(function(){d.each(BP_Mentions_Options.selectors,function(e,t){var i;!jQuery(t).hasClass("medium-editor-element")||void 0!==(i=jQuery(t).attr("contenteditable"))&&!1!==i&&(jQuery(t).attr("contenteditable","true"),jQuery(t).find(".atwho-inserted").closest(".medium-editor-element").focus())})},10))}),jQuery(this).on("keydown",function(e){s||(8==e.keyCode?jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}):jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).attr("contenteditable",!1)}))}),void 0!==e.currentTarget&&void 0!==e.currentTarget.innerHTML){var t=0;if(void 0!==window.forums_medium_reply_editor){var i=Object.keys(window.forums_medium_reply_editor);if(i.length)for(t=0;t<i.length;t++)window.forums_medium_reply_editor[i[t]].checkContentChanged()}if(void 0!==window.forums_medium_topic_editor){var n=Object.keys(window.forums_medium_topic_editor);if(n.length)for(t=0;t<n.length;t++)window.forums_medium_topic_editor[n[t]].checkContentChanged()}if(void 0!==window.forums_medium_forum_editor){var o=Object.keys(window.forums_medium_forum_editor);if(o.length)for(t=0;t<o.length;t++)window.forums_medium_forum_editor[o[t]].checkContentChanged()}}jQuery("#atwho-ground-whats-new").data("page",1),jQuery("#atwho-ground-whats-new").find(".list-loader").remove(),jQuery("#atwho-ground-whats-new").find(".list-loading").removeClass("list-loading"),window.bp_suggestions_page_limit=null,jQuery(this).focus()}),this.on("keyup",function(){var e;s&&(e=jQuery(this).text().length,localStorage.setItem("charCount",e),jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}))});e=d.extend(!0,{},t,i,e);return d.fn.atwho.call(this,e)},d(document).ready(function(){localStorage.setItem("charCount",0),d(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){d(this).data("bp_mentions_activated")||void 0!==a&&(d(this).bp_mentions(a.mentions.users),d(this).data("bp_mentions_activated",!0))})}),a.mentions.tinyMCEinit=function(){void 0===window.tinyMCE||null===window.tinyMCE.activeEditor||void 0===window.tinyMCE.activeEditor||d(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",d(".wp-editor-wrap iframe")[0]).bp_mentions(a.mentions.users)}}(bp,jQuery);