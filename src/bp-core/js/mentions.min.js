window.bp=window.bp||{},function(d,l){var u,h=[];d.mentions=d.mentions||{},d.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(window.BP_Suggestions.friends&&0<window.BP_Suggestions.friends.length?d.mentions.users=window.BP_Suggestions.friends:window.BP_Suggestions.members&&0<window.BP_Suggestions.members.length?d.mentions.users=window.BP_Suggestions.members:d.mentions.users&&0<d.mentions.users.length&&(d.mentions.users=d.mentions.users)),d.mentions.xhr=null,l.fn.bp_mentions=function(t,e,i){l.isArray(t)&&(t={data:t}),e=e||{},i=i||{};var n=navigator.userAgent.toLowerCase(),s=-1<n.indexOf("android"),a=-1<n.indexOf("chrome"),e=l.extend(!0,{},{delay:500,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:100,startWithSpace:!1,callbacks:{filter:function(t,e,i){for(var n,o=[],s=new RegExp("^"+t+"| "+t,"ig"),a=0,r=e.length;a<r;a++)(n=e[a])[i].toLowerCase().match(s)&&o.push(n);return o},highlighter:function(t,e){if(!e)return t;e=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+e.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return t.replace(e,function(t,e,i,n){return">"+e+"<strong>"+i+"</strong>"+n+"<"})},before_reposition:function(t){var e,i=l("#atwho-ground-"+this.id+" .atwho-view"),n=l("body"),o=this.$inputor.data("atwho");"undefined"!==o&&"undefined"!==o.iframe&&null!==o.iframe?(e=this.$inputor.caret("offset",{iframe:o.iframe}),"undefined"!==(o=l(o.iframe).offset())&&(e.left+=o.left,e.top+=o.top)):e=this.$inputor.caret("offset"),i=e.left>n.width()/2?(i.addClass("right"),e.left-t.left-this.view.$el.width()):(i.removeClass("right"),e.left-t.left+1),n.width()<=400&&l(document).scrollTop(e.top-6),n=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10),t.top=e.top+(n=!n||n<5?19:n),t.left+=i},inserting_wrapper:function(t,e){return""+e}}},e),i=l.extend(!0,{},{callbacks:{remoteFilter:function(t,s){var e=this.$el,i=e.find("ul"),n=this;if(n.data,"object"==typeof(u=h[t]))return e.data("page",1),e.data("page_limit",u.total_pages),s(u.results),n.data=u.results,void(e.hasClass("has-events")||(i.on("scroll",r(i,e,n,t,o)),e.addClass("has-events")));function o(e,t,i,n){var o={action:"bp_get_suggestions",term:e,type:"members",page:t||1};l.isNumeric(i)&&(o["group-id"]=parseInt(i,10)),d.mentions.xhr=l.getJSON(ajaxurl,o).done(function(t){t.success&&(1===o.page&&(h[e]=t.data),n(t.data))})}function a(t){var e=this,i=e.$el,n=i.find("ul"),o=l.map(t.results,function(t){return t.search=t.search||t.ID+" "+t.name,t});e.data=e.data?e.data.concat(o):o,i.data("page_limit",t.total_pages),n.find(".list-loader").remove(),s(e.data),n.removeClass("list-loading")}function r(e,i,n,o,s){return function(){var t;e.scrollTop()+e.innerHeight()>=e[0].scrollHeight&&(e.hasClass("list-loading")||i.data("page_limit")===i.data("page")||(e.addClass("list-loading"),e.find("li:last-child").hasClass("list-loader")||e.append('<li class="list-loader">Loading more results…</li>'),t=i.data("page")+1,i.data("page",t),s(o,t,n.$inputor.data("suggestions-group-id"),function(t){a.call(n,t)})))}}d.mentions.xhr&&d.mentions.xhr.abort(),i.find("li:last-child").hasClass("list-loader")||i.append('<li class="list-loader">Loading more results…</li>'),o(t,e.data("page"),this.$inputor.data("suggestions-group-id"),function(t){a.call(n,t)}),e.hasClass("has-events")||(i.on("scroll",r(i,e,n,t,o)),e.addClass("has-events"))},beforeReposition:function(t){var e;0<l("body.rtl").length&&(0<(e=this.$el.find(".atwho-view")).length&&(t.left=this.rect().left-e.width()))}},data:l.map(t.data,function(t){return t.search=t.search||t.ID+" "+t.name,t}),at:"@",searchKey:"search",startWithSpace:!0,displayTpl:BP_Mentions_Options.display_tpl},BP_Mentions_Options.extra_options,i);this.on("blur.atwhoInner",function(){jQuery("#atwho-ground-whats-new").data("page",1).removeData("page_limit"),jQuery("#atwho-ground-whats-new").find(".list-loader").remove(),jQuery("#atwho-ground-whats-new").find(".list-loading").removeClass("list-loading")}),this.on("inserted.atwho",function(t){if(a&&jQuery(this).on("keyup",function(t){13===t.keyCode&&(!jQuery(this).hasClass("medium-editor-element")||void 0!==(t=jQuery(this).attr("contenteditable"))&&!1!==t&&jQuery(this).attr("contenteditable","false"),setTimeout(function(){l.each(BP_Mentions_Options.selectors,function(t,e){var i;!jQuery(e).hasClass("medium-editor-element")||void 0!==(i=jQuery(e).attr("contenteditable"))&&!1!==i&&(jQuery(e).attr("contenteditable","true"),jQuery(e).find(".atwho-inserted").closest(".medium-editor-element").focus())})},10))}),jQuery(this).on("keydown",function(t){s||(8==t.keyCode?jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}):jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).attr("contenteditable",!1)}))}),void 0!==t.currentTarget&&void 0!==t.currentTarget.innerHTML){var e=0;if(void 0!==window.forums_medium_reply_editor){var i=Object.keys(window.forums_medium_reply_editor);if(i.length)for(e=0;e<i.length;e++)window.forums_medium_reply_editor[i[e]].checkContentChanged()}if(void 0!==window.forums_medium_topic_editor){var n=Object.keys(window.forums_medium_topic_editor);if(n.length)for(e=0;e<n.length;e++)window.forums_medium_topic_editor[n[e]].checkContentChanged()}if(void 0!==window.forums_medium_forum_editor){var o=Object.keys(window.forums_medium_forum_editor);if(o.length)for(e=0;e<o.length;e++)window.forums_medium_forum_editor[o[e]].checkContentChanged()}}jQuery("#atwho-ground-whats-new").data("page",1).removeData("page_limit"),jQuery("#atwho-ground-whats-new").find(".list-loader").remove(),jQuery("#atwho-ground-whats-new").find(".list-loading").removeClass("list-loading"),jQuery(this).focus()}),this.on("keyup",function(){var t;s&&(t=jQuery(this).text().length,localStorage.setItem("charCount",t),jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}))});t=l.extend(!0,{},e,i,t);return l.fn.atwho.call(this,t)},l(document).ready(function(){localStorage.setItem("charCount",0),l(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){l(this).data("bp_mentions_activated")||void 0!==d&&(l(this).bp_mentions(d.mentions.users),l(this).data("bp_mentions_activated",!0))})}),d.mentions.tinyMCEinit=function(){void 0===window.tinyMCE||null===window.tinyMCE.activeEditor||void 0===window.tinyMCE.activeEditor||l(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",l(".wp-editor-wrap iframe")[0]).bp_mentions(d.mentions.users)}}(bp,jQuery);