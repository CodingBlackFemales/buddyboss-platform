window.bp=window.bp||{},function(d,c){var m,f=[];d.mentions=d.mentions||{},d.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(window.BP_Suggestions.friends&&0<window.BP_Suggestions.friends.length?d.mentions.users=window.BP_Suggestions.friends:window.BP_Suggestions.members&&0<window.BP_Suggestions.members.length?d.mentions.users=window.BP_Suggestions.members:d.mentions.users&&0<d.mentions.users.length&&(d.mentions.users=d.mentions.users)),d.mentions.xhr=null,c.fn.bp_mentions=function(e,t,n){c.isArray(e)&&(e={data:e}),t=t||{},n=n||{};var i=navigator.userAgent.toLowerCase(),r=-1<i.indexOf("android"),s=-1<i.indexOf("chrome"),o=c.extend(!0,{},{delay:200,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:10,startWithSpace:!1,callbacks:{filter:function(e,t,n){for(var i,o=[],r=new RegExp("^"+e+"| "+e,"ig"),s=0,a=t.length;s<a;s++)(i=t[s])[n].toLowerCase().match(r)&&o.push(i);return o},highlighter:function(e,t){if(!t)return e;var n=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+t.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return e.replace(n,function(e,t,n,i){return">"+t+"<strong>"+n+"</strong>"+i+"<"})},before_reposition:function(e){var t,n,i,o,r=c("#atwho-ground-"+this.id+" .atwho-view"),s=c("body"),a=this.$inputor.data("atwho");"undefined"!==a&&"undefined"!==a.iframe&&null!==a.iframe?(t=this.$inputor.caret("offset",{iframe:a.iframe}),"undefined"!==(i=c(a.iframe).offset())&&(t.left+=i.left,t.top+=i.top)):t=this.$inputor.caret("offset"),o=t.left>s.width()/2?(r.addClass("right"),t.left-e.left-this.view.$el.width()):(r.removeClass("right"),t.left-e.left+1),s.width()<=400&&c(document).scrollTop(t.top-6),(!(n=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10))||n<5)&&(n=19),e.top=t.top+n,e.left+=o},inserting_wrapper:function(e,t){return""+t}}},t),a=c.extend(!0,{},{callbacks:{remoteFilter:function(n,i){var e={};"object"!=typeof(m=f[n])?(d.mentions.xhr&&d.mentions.xhr.abort(),e={action:"bp_get_suggestions",term:n,type:"members"},c.isNumeric(this.$inputor.data("suggestions-group-id"))&&(e["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),d.mentions.xhr=c.getJSON(ajaxurl,e).done(function(e){var t;e.success&&(t=c.map(e.data,function(e){return e.search=e.search||e.ID+" "+e.name,e}),f[n]=t,i(t))})):i(m)},beforeInsert:function(e){return e+=" "}},data:c.map(e.data,function(e){return e.search=e.search||e.ID+" "+e.name,e}),at:"@",searchKey:"search",startWithSpace:!0,displayTpl:BP_Mentions_Options.display_tpl},BP_Mentions_Options.extra_options,n);this.on("inserted.atwho",function(e){if(s&&jQuery(this).on("keyup",function(e){var t;13===e.keyCode&&(!jQuery(this).hasClass("medium-editor-element")||void 0!==(t=jQuery(this).attr("contenteditable"))&&!1!==t&&jQuery(this).attr("contenteditable","false"),setTimeout(function(){c.each(BP_Mentions_Options.selectors,function(e,t){var n;!jQuery(t).hasClass("medium-editor-element")||void 0!==(n=jQuery(t).attr("contenteditable"))&&!1!==n&&(jQuery(t).attr("contenteditable","true"),jQuery(t).find(".atwho-inserted").closest(".medium-editor-element").focus())})},10))}),jQuery(this).on("keydown",function(e){r||(8==e.keyCode?jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}):jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).attr("contenteditable",!1)}))}),void 0!==e.currentTarget&&void 0!==e.currentTarget.innerHTML){var t=0;if(void 0!==window.forums_medium_reply_editor){var n=Object.keys(window.forums_medium_reply_editor);if(n.length)for(t=0;t<n.length;t++)window.forums_medium_reply_editor[n[t]].checkContentChanged()}if(void 0!==window.forums_medium_topic_editor){var i=Object.keys(window.forums_medium_topic_editor);if(i.length)for(t=0;t<i.length;t++)window.forums_medium_topic_editor[i[t]].checkContentChanged()}if(void 0!==window.forums_medium_forum_editor){var o=Object.keys(window.forums_medium_forum_editor);if(o.length)for(t=0;t<o.length;t++)window.forums_medium_forum_editor[o[t]].checkContentChanged()}}jQuery(this).focus()}),this.on("keyup",function(){var e;r&&(e=jQuery(this).text().length,localStorage.setItem("charCount",e),jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}))});var u=c.extend(!0,{},o,a,e);return c.fn.atwho.call(this,u)},c(document).ready(function(){localStorage.setItem("charCount",0),c(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){c(this).data("bp_mentions_activated")||void 0!==d&&(c(this).bp_mentions(d.mentions.users),c(this).data("bp_mentions_activated",!0))})}),d.mentions.tinyMCEinit=function(){void 0!==window.tinyMCE&&null!==window.tinyMCE.activeEditor&&void 0!==window.tinyMCE.activeEditor&&c(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",c(".wp-editor-wrap iframe")[0]).bp_mentions(d.mentions.users)}}(bp,jQuery);